<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PlantUML TeaVM demo</title>
  </head>
  <body>
    <textarea id="src" rows="16" cols="80">@startuml
class a
class b
class c
a --> b
a --> c
@enduml</textarea>
    <div id="out"></div>

    <script src="viz-global.js"></script>
    <script src="classes.js"></script>
    <script>
      // Initialize PlantUML TeaVM
      main();

      // ============================================
      // All UI logic is in JavaScript
      // ============================================

      const textarea = document.getElementById("src");
      const DEBOUNCE_MS = 150;

      let debounceTimer = null;
      let lastRendered = null;

      function splitLines(text) {
        return text.split(/\r\n|\r|\n/);
      }

      function render() {
        const source = textarea.value;

        // Skip if unchanged
        if (source === lastRendered) {
          return;
        }
        lastRendered = source;

        // Split lines in JS, pass array to Java
        const lines = splitLines(source);
        plantumlRequestRender(lines, "out");
      }

      function onInput() {
        // Debounce: wait for typing to stabilize
        if (debounceTimer) {
          clearTimeout(debounceTimer);
        }
        debounceTimer = setTimeout(render, DEBOUNCE_MS);
      }

      textarea.addEventListener("input", onInput);

      // Initial render
      render();
    </script>
  </body>
</html>
