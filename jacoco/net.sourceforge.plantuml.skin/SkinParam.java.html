<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SkinParam.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">plantuml</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.plantuml.skin</a> &gt; <span class="el_source">SkinParam.java</span></div><h1>SkinParam.java</h1><pre class="source lang-java linenums">/* ========================================================================
 * PlantUML : a free UML diagram generator
 * ========================================================================
 *
 * (C) Copyright 2009-2024, Arnaud Roques
 *
 * Project Info:  https://plantuml.com
 * 
 * If you like this project or if you find it useful, you can support us at:
 * 
 * https://plantuml.com/patreon (only 1$ per month!)
 * https://plantuml.com/paypal
 * 
 * This file is part of PlantUML.
 *
 * PlantUML is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * PlantUML distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
 * License for more details.
 *
 * You should have received a copy of the GNU General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
 * USA.
 *
 *
 * Original Author:  Arnaud Roques
 *
 *
 */
package net.sourceforge.plantuml.skin;

import java.awt.Font;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Collections;
import java.util.EnumSet;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Objects;
import java.util.Set;
import java.util.TreeSet;
import java.util.regex.Pattern;

import net.sourceforge.plantuml.Previous;
import net.sourceforge.plantuml.StringUtils;
import net.sourceforge.plantuml.TikzFontDistortion;
import net.sourceforge.plantuml.activitydiagram3.ftile.ArrowsRegular;
import net.sourceforge.plantuml.activitydiagram3.ftile.ArrowsTriangle;
import net.sourceforge.plantuml.decoration.LinkStyle;
import net.sourceforge.plantuml.dot.DotSplines;
import net.sourceforge.plantuml.klimt.Arrows;
import net.sourceforge.plantuml.klimt.LineBreakStrategy;
import net.sourceforge.plantuml.klimt.UStroke;
import net.sourceforge.plantuml.klimt.color.Colors;
import net.sourceforge.plantuml.klimt.color.HColor;
import net.sourceforge.plantuml.klimt.color.HColorSet;
import net.sourceforge.plantuml.klimt.color.HColors;
import net.sourceforge.plantuml.klimt.color.NoSuchColorException;
import net.sourceforge.plantuml.klimt.creole.CreoleMode;
import net.sourceforge.plantuml.klimt.creole.Parser;
import net.sourceforge.plantuml.klimt.creole.SheetBuilder;
import net.sourceforge.plantuml.klimt.creole.legacy.CreoleParser;
import net.sourceforge.plantuml.klimt.drawing.svg.LengthAdjust;
import net.sourceforge.plantuml.klimt.font.FontConfiguration;
import net.sourceforge.plantuml.klimt.font.FontParam;
import net.sourceforge.plantuml.klimt.font.UFont;
import net.sourceforge.plantuml.klimt.geom.HorizontalAlignment;
import net.sourceforge.plantuml.klimt.geom.Rankdir;
import net.sourceforge.plantuml.klimt.sprite.Sprite;
import net.sourceforge.plantuml.klimt.sprite.SpriteImage;
import net.sourceforge.plantuml.log.Logme;
import net.sourceforge.plantuml.preproc.ConfigurationStore;
import net.sourceforge.plantuml.preproc.OptionKey;
import net.sourceforge.plantuml.regex.Matcher2;
import net.sourceforge.plantuml.regex.Pattern2;
import net.sourceforge.plantuml.stereo.Stereotype;
import net.sourceforge.plantuml.style.FromSkinparamToStyle;
import net.sourceforge.plantuml.style.ISkinParam;
import net.sourceforge.plantuml.style.Style;
import net.sourceforge.plantuml.style.StyleBuilder;
import net.sourceforge.plantuml.style.StyleLoader;
import net.sourceforge.plantuml.style.parser.StyleParser;
import net.sourceforge.plantuml.style.parser.StyleParsingException;
import net.sourceforge.plantuml.svek.ConditionEndStyle;
import net.sourceforge.plantuml.svek.ConditionStyle;
import net.sourceforge.plantuml.svek.PackageStyle;
import net.sourceforge.plantuml.text.Guillemet;
import net.sourceforge.plantuml.utils.BlocLines;

public class SkinParam implements ISkinParam {

	public static boolean isDark(ISkinParam skinParam) {
<span class="fc" id="L105">		return &quot;dark&quot;.equalsIgnoreCase(skinParam.getValue(&quot;mode&quot;));</span>
	}

	// TODO not clear whether SkinParam or ImageBuilder is responsible for defaults
	public static final String DEFAULT_PRESERVE_ASPECT_RATIO = &quot;none&quot;;

	// private String skin = &quot;debug.skin&quot;;
<span class="fc" id="L112">	private String skin = &quot;plantuml.skin&quot;;</span>
	private StyleBuilder styleBuilder;
	private final Pragma pragma;
	private final ConfigurationStore&lt;OptionKey&gt; option;

<span class="fc" id="L117">	private SkinParam(UmlDiagramType type, Pragma pragma, ConfigurationStore&lt;OptionKey&gt; option) {</span>
<span class="fc" id="L118">		this.type = type;</span>
<span class="fc" id="L119">		this.pragma = pragma;</span>
<span class="fc" id="L120">		this.option = option;</span>
<span class="fc" id="L121">	}</span>

	@Override
	public StyleBuilder getCurrentStyleBuilder() {
<span class="fc bfc" id="L125" title="All 2 branches covered.">		if (styleBuilder == null)</span>
			try {
<span class="fc" id="L127">				this.styleBuilder = getCurrentStyleBuilderInternal();</span>
<span class="nc" id="L128">			} catch (StyleParsingException e) {</span>
<span class="nc" id="L129">				Logme.error(e);</span>
<span class="nc" id="L130">			} catch (IOException e) {</span>
<span class="nc" id="L131">				Logme.error(e);</span>
<span class="pc" id="L132">			}</span>

<span class="fc" id="L134">		return styleBuilder;</span>
	}

	@Override
	public void muteStyle(Collection&lt;Style&gt; modifiedStyles) {
<span class="fc" id="L139">		styleBuilder = getCurrentStyleBuilder().muteStyle(modifiedStyles);</span>
<span class="fc" id="L140">	}</span>

	@Override
	public String getDefaultSkin() {
<span class="fc" id="L144">		return skin;</span>
	}

	@Override
	public void setDefaultSkin(String newSkin) {
<span class="fc" id="L149">		this.skin = newSkin;</span>
<span class="fc" id="L150">	}</span>

	private StyleBuilder getCurrentStyleBuilderInternal() throws IOException, StyleParsingException {
<span class="fc" id="L153">		StyleBuilder result = StyleLoader.loadSkin(this.getDefaultSkin());</span>
<span class="pc bpc" id="L154" title="1 of 2 branches missed.">		if (result == null)</span>
<span class="nc" id="L155">			result = StyleLoader.loadSkin(&quot;plantuml.skin&quot;);</span>

<span class="fc" id="L157">		return result;</span>
	}

	public static int zeroMargin(int defaultValue) {
<span class="nc" id="L161">		return defaultValue;</span>
	}

	private static final String stereoPatternString = &quot;\\&lt;\\&lt;(.*?)\\&gt;\\&gt;&quot;;
<span class="fc" id="L165">	private static final Pattern2 stereoPattern = Pattern2.cmpile(stereoPatternString);</span>

<span class="fc" id="L167">	private final Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L168">	private final Map&lt;String, String&gt; paramsPendingForStyleMigration = new LinkedHashMap&lt;String, String&gt;();</span>
<span class="fc" id="L169">	private final Map&lt;String, String&gt; svgCharSizes = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L170">	private Rankdir rankdir = Rankdir.TOP_TO_BOTTOM;</span>
	private final UmlDiagramType type;
	private boolean useVizJs;

	@Override
	public void copyAllFrom(Map&lt;String, String&gt; other) {
<span class="nc" id="L176">		this.params.putAll(other);</span>
<span class="nc" id="L177">	}</span>

	public void copyAllFrom(Previous previous) {
<span class="fc" id="L180">		this.params.putAll(previous.values());</span>

<span class="fc" id="L182">	}</span>

	@Override
	public Map&lt;String, String&gt; values() {
<span class="fc" id="L186">		return Collections.unmodifiableMap(params);</span>
	}

	public void setParam(String key, String value) {
<span class="fc bfc" id="L190" title="All 2 branches covered.">		for (String key2 : cleanForKey(key)) {</span>
<span class="fc" id="L191">			params.put(key2, StringUtils.trin(value));</span>
<span class="fc" id="L192">			applyPendingStyleMigration();</span>
<span class="fc" id="L193">			final FromSkinparamToStyle convertor = new FromSkinparamToStyle(key2);</span>
<span class="fc" id="L194">			convertor.convertNow(value, getCurrentStyleBuilder());</span>
<span class="fc" id="L195">			muteStyle(convertor.getStyles());</span>
<span class="fc" id="L196">		}</span>
<span class="fc bfc" id="L197" title="All 4 branches covered.">		if (&quot;style&quot;.equalsIgnoreCase(key) &amp;&amp; &quot;strictuml&quot;.equalsIgnoreCase(value)) {</span>
<span class="fc" id="L198">			final InputStream internalIs = StyleLoader.class.getResourceAsStream(&quot;/skin/strictuml.skin&quot;);</span>
<span class="fc" id="L199">			final StyleBuilder styleBuilder = this.getCurrentStyleBuilder();</span>
			try {
<span class="fc" id="L201">				final BlocLines lines = BlocLines.load(internalIs, null);</span>
<span class="fc" id="L202">				this.muteStyle(StyleParser.parse(lines, styleBuilder));</span>

<span class="nc" id="L204">			} catch (StyleParsingException e) {</span>
<span class="nc" id="L205">				Logme.error(e);</span>
<span class="nc" id="L206">			} catch (IOException e) {</span>
<span class="nc" id="L207">				Logme.error(e);</span>
<span class="pc" id="L208">			}</span>
		}
<span class="fc" id="L210">	}</span>

	public void applyPendingStyleMigration() {
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">		for (Entry&lt;String, String&gt; ent : paramsPendingForStyleMigration.entrySet()) {</span>
<span class="nc" id="L214">			final FromSkinparamToStyle convertor = new FromSkinparamToStyle(ent.getKey());</span>
<span class="nc" id="L215">			convertor.convertNow(ent.getValue(), getCurrentStyleBuilder());</span>
<span class="nc" id="L216">			muteStyle(convertor.getStyles());</span>
<span class="nc" id="L217">		}</span>
<span class="fc" id="L218">		paramsPendingForStyleMigration.clear();</span>
<span class="fc" id="L219">	}</span>

	public static SkinParam create(UmlDiagramType type, Pragma pragma, ConfigurationStore&lt;OptionKey&gt; option) {
<span class="fc" id="L222">		return new SkinParam(type, pragma, option);</span>
	}

<span class="fc" id="L225">	private final Map&lt;String, List&lt;String&gt;&gt; cacheCleanForKey = new HashMap&lt;String, List&lt;String&gt;&gt;();</span>

	List&lt;String&gt; cleanForKey(String key) {
<span class="fc" id="L228">		List&lt;String&gt; result = cacheCleanForKey.get(key);</span>
<span class="fc bfc" id="L229" title="All 2 branches covered.">		if (result == null) {</span>
<span class="fc" id="L230">			result = cleanForKeySlow(key);</span>
<span class="fc" id="L231">			cacheCleanForKey.put(key, result);</span>
		}
<span class="fc" id="L233">		return result;</span>
	}

<span class="fc" id="L236">	private static final Pattern patternCleanUnderscoreDot = Pattern.compile(&quot;_|\\.&quot;);</span>
<span class="fc" id="L237">	private static final Pattern patternCleanSequence = Pattern.compile(&quot;sequence(participant|actor)&quot;);</span>
<span class="fc" id="L238">	private static final Pattern patternCleanArrow = Pattern</span>
<span class="fc" id="L239">			.compile(&quot;(activity|class|component|object|sequence|state|usecase)arrow&quot;);</span>
<span class="fc" id="L240">	private static final Pattern patternCleanAlign = Pattern.compile(&quot;align$&quot;);</span>

	List&lt;String&gt; cleanForKeySlow(String key) {
<span class="fc" id="L243">		key = StringUtils.trin(StringUtils.goLowerCase(key));</span>
<span class="fc" id="L244">		key = patternCleanUnderscoreDot.matcher(key).replaceAll(&quot;&quot;);</span>
<span class="fc" id="L245">		key = patternCleanSequence.matcher(key).replaceAll(&quot;$1&quot;);</span>
<span class="fc" id="L246">		key = patternCleanArrow.matcher(key).replaceAll(&quot;arrow&quot;);</span>
<span class="fc" id="L247">		key = patternCleanAlign.matcher(key).replaceAll(&quot;alignment&quot;);</span>

<span class="fc" id="L249">		final Matcher2 mm = stereoPattern.matcher(key);</span>
<span class="fc" id="L250">		final List&lt;String&gt; result = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L251" title="All 2 branches covered.">		while (mm.find()) {</span>
<span class="fc" id="L252">			final String s = mm.group(1);</span>
<span class="fc" id="L253">			result.add(key.replaceAll(stereoPatternString, &quot;&quot;) + &quot;&lt;&lt;&quot; + s + &quot;&gt;&gt;&quot;);</span>
<span class="fc" id="L254">		}</span>
<span class="fc bfc" id="L255" title="All 2 branches covered.">		if (result.size() == 0)</span>
<span class="fc" id="L256">			result.add(key);</span>

<span class="fc" id="L258">		return Collections.unmodifiableList(result);</span>
	}

	@Override
	public HColor getHyperlinkColor() {
<span class="fc" id="L263">		final HColor result = getHtmlColor(ColorParam.hyperlink, null, false);</span>
<span class="pc bpc" id="L264" title="1 of 2 branches missed.">		if (result == null)</span>
<span class="fc" id="L265">			return HColors.BLUE;</span>

<span class="nc" id="L267">		return result;</span>
	}

	@Override
	public HColor getBackgroundColor() {
<span class="fc" id="L272">		final HColor result = getHtmlColor(ColorParam.background, null, false);</span>
<span class="pc bpc" id="L273" title="1 of 2 branches missed.">		return result != null ? result : HColors.WHITE;</span>
	}

	@Override
	public String getValue(String key) {
<span class="fc" id="L278">		applyPendingStyleMigration();</span>
<span class="fc bfc" id="L279" title="All 2 branches covered.">		for (String key2 : cleanForKey(key)) {</span>
<span class="fc" id="L280">			final String result = params.get(key2);</span>
<span class="fc bfc" id="L281" title="All 2 branches covered.">			if (result != null)</span>
<span class="fc" id="L282">				return result;</span>

<span class="fc" id="L284">		}</span>
<span class="fc" id="L285">		return null;</span>
	}

	public String getValue(String key, String defaultValue) {
<span class="fc" id="L289">		final String result = getValue(key);</span>
<span class="fc bfc" id="L290" title="All 2 branches covered.">		return result == null ? defaultValue : result;</span>
	}

	private boolean valueIs(String key, String expected) {
<span class="fc" id="L294">		return expected.equalsIgnoreCase(getValue(key));</span>
	}

	private boolean isTrue(String key) {
<span class="fc" id="L298">		return valueIs(key, &quot;true&quot;);</span>
	}

	static String humanName(String key) {
<span class="fc" id="L302">		final StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L303">		boolean upper = true;</span>
<span class="fc bfc" id="L304" title="All 2 branches covered.">		for (int i = 0; i &lt; key.length(); i++) {</span>
<span class="fc" id="L305">			final char c = key.charAt(i);</span>
<span class="fc bfc" id="L306" title="All 2 branches covered.">			if (c == '_') {</span>
<span class="fc" id="L307">				upper = true;</span>
			} else {
<span class="fc bfc" id="L309" title="All 2 branches covered.">				sb.append(upper ? StringUtils.goUpperCase(c) : StringUtils.goLowerCase(c));</span>
<span class="fc" id="L310">				upper = false;</span>
			}
		}
<span class="fc" id="L313">		return sb.toString();</span>
	}

	@Override
	public HColor getHtmlColor(ColorParam param, Stereotype stereotype, boolean clickable) {
<span class="pc bpc" id="L318" title="1 of 2 branches missed.">		if (stereotype != null) {</span>
<span class="nc" id="L319">			checkStereotype(stereotype);</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">			for (String s : stereotype.getMultipleLabels()) {</span>
<span class="nc" id="L321">				final String value2 = getValue(param.name() + &quot;color&quot; + &quot;&lt;&lt;&quot; + s + &quot;&gt;&gt;&quot;);</span>
<span class="nc bnc" id="L322" title="All 4 branches missed.">				if (value2 != null &amp;&amp; getIHtmlColorSet().getColorOrWhite(value2) != null)</span>
<span class="nc" id="L323">					return getIHtmlColorSet().getColorOrWhite(value2);</span>

<span class="nc" id="L325">			}</span>
		}
<span class="fc" id="L327">		final String value = getValue(getParamName(param, clickable));</span>
<span class="pc bpc" id="L328" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="fc" id="L329">			return null;</span>

<span class="nc bnc" id="L331" title="All 4 branches missed.">		if ((param == ColorParam.background || param == ColorParam.arrowHead)</span>
<span class="nc bnc" id="L332" title="All 4 branches missed.">				&amp;&amp; (value.equalsIgnoreCase(&quot;transparent&quot;) || value.equalsIgnoreCase(&quot;none&quot;)))</span>
<span class="nc" id="L333">			return HColors.transparent();</span>

<span class="nc bnc" id="L335" title="All 2 branches missed.">		if (param == ColorParam.background)</span>
<span class="nc" id="L336">			return getIHtmlColorSet().getColorOrWhite(value);</span>

<span class="nc bnc" id="L338" title="All 2 branches missed.">		assert param != ColorParam.background;</span>

<span class="nc" id="L340">		return getIHtmlColorSet().getColorOrWhite(value);</span>
	}

	@Override
	public char getCircledCharacter(Stereotype stereotype) {
<span class="fc" id="L345">		final String value2 = getValue(</span>
<span class="fc" id="L346">				&quot;spotchar&quot; + Objects.requireNonNull(stereotype).getLabel(Guillemet.DOUBLE_COMPARATOR));</span>
<span class="pc bpc" id="L347" title="3 of 4 branches missed.">		if (value2 != null &amp;&amp; value2.length() &gt; 0)</span>
<span class="nc" id="L348">			return value2.charAt(0);</span>

<span class="fc" id="L350">		return 0;</span>
	}

	@Override
	public Colors getColors(ColorParam param, Stereotype stereotype) throws NoSuchColorException {
<span class="nc bnc" id="L355" title="All 2 branches missed.">		if (stereotype != null) {</span>
<span class="nc" id="L356">			checkStereotype(stereotype);</span>
<span class="nc" id="L357">			final String value2 = getValue(param.name() + &quot;color&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR));</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">			if (value2 != null)</span>
<span class="nc" id="L359">				return new Colors(value2, getIHtmlColorSet(), param.getColorType());</span>

		}
<span class="nc" id="L362">		final String value = getValue(getParamName(param, false));</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">		if (value == null)</span>
<span class="nc" id="L364">			return Colors.empty();</span>

<span class="nc" id="L366">		return new Colors(value, getIHtmlColorSet(), param.getColorType());</span>
	}

	private String getParamName(ColorParam param, boolean clickable) {
<span class="fc" id="L370">		String n = param.name();</span>
<span class="pc bpc" id="L371" title="3 of 4 branches missed.">		if (clickable &amp;&amp; n.endsWith(&quot;Background&quot;))</span>
<span class="nc" id="L372">			n = n.replaceAll(&quot;Background&quot;, &quot;ClickableBackground&quot;);</span>
<span class="pc bpc" id="L373" title="3 of 4 branches missed.">		else if (clickable &amp;&amp; n.endsWith(&quot;Border&quot;))</span>
<span class="nc" id="L374">			n = n.replaceAll(&quot;Border&quot;, &quot;ClickableBorder&quot;);</span>

<span class="fc" id="L376">		return n + &quot;color&quot;;</span>
	}

	private void checkStereotype(Stereotype stereotype) {
		// if (stereotype.startsWith(&quot;&lt;&lt;&quot;) == false || stereotype.endsWith(&quot;&gt;&gt;&quot;) ==
		// false) {
		// throw new IllegalArgumentException();
		// }
<span class="fc" id="L384">	}</span>

	private int getFontSize(Stereotype stereotype, FontParam... param) {
<span class="fc bfc" id="L387" title="All 2 branches covered.">		if (stereotype != null) {</span>
<span class="fc" id="L388">			checkStereotype(stereotype);</span>
<span class="fc" id="L389">			final String value2 = getFirstValueNonNullWithSuffix(</span>
<span class="fc" id="L390">					&quot;fontsize&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR), param);</span>
<span class="pc bpc" id="L391" title="3 of 4 branches missed.">			if (value2 != null &amp;&amp; value2.matches(&quot;\\d+&quot;))</span>
<span class="nc" id="L392">				return Integer.parseInt(value2);</span>

		}
<span class="fc" id="L395">		String value = getFirstValueNonNullWithSuffix(&quot;fontsize&quot;, param);</span>
<span class="pc bpc" id="L396" title="3 of 4 branches missed.">		if (value == null || value.matches(&quot;\\d+&quot;) == false)</span>
<span class="fc" id="L397">			value = getValue(&quot;defaultfontsize&quot;);</span>

<span class="pc bpc" id="L399" title="3 of 4 branches missed.">		if (value == null || value.matches(&quot;\\d+&quot;) == false)</span>
<span class="fc" id="L400">			return param[0].getDefaultSize(this);</span>

<span class="nc" id="L402">		return Integer.parseInt(value);</span>
	}

	private String getFontFamily(Stereotype stereotype, FontParam... param) {
<span class="fc bfc" id="L406" title="All 2 branches covered.">		if (stereotype != null) {</span>
<span class="fc" id="L407">			checkStereotype(stereotype);</span>
<span class="fc" id="L408">			final String value2 = getFirstValueNonNullWithSuffix(</span>
<span class="fc" id="L409">					&quot;fontname&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR), param);</span>
<span class="pc bpc" id="L410" title="1 of 2 branches missed.">			if (value2 != null)</span>
<span class="nc" id="L411">				return StringUtils.eventuallyRemoveStartingAndEndingDoubleQuote(value2);</span>

		}
		// Times, Helvetica, Courier or Symbol
<span class="fc" id="L415">		String value = getFirstValueNonNullWithSuffix(&quot;fontname&quot;, param);</span>
<span class="pc bpc" id="L416" title="1 of 2 branches missed.">		if (value != null)</span>
<span class="nc" id="L417">			return StringUtils.eventuallyRemoveStartingAndEndingDoubleQuote(value);</span>

<span class="fc bfc" id="L419" title="All 2 branches covered.">		if (param[0] != FontParam.CIRCLED_CHARACTER) {</span>
<span class="fc" id="L420">			value = getValue(&quot;defaultfontname&quot;);</span>
<span class="pc bpc" id="L421" title="1 of 2 branches missed.">			if (value != null)</span>
<span class="nc" id="L422">				return StringUtils.eventuallyRemoveStartingAndEndingDoubleQuote(value);</span>

		}
<span class="fc" id="L425">		return param[0].getDefaultFamily();</span>
	}

	@Override
	public HColor getFontHtmlColor(Stereotype stereotype, FontParam... param) {
<span class="fc" id="L430">		String value = null;</span>
<span class="fc bfc" id="L431" title="All 2 branches covered.">		if (stereotype != null) {</span>
<span class="fc" id="L432">			checkStereotype(stereotype);</span>
<span class="fc" id="L433">			value = getFirstValueNonNullWithSuffix(&quot;fontcolor&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR),</span>
					param);
		}

<span class="pc bpc" id="L437" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="fc" id="L438">			value = getFirstValueNonNullWithSuffix(&quot;fontcolor&quot;, param);</span>

<span class="pc bpc" id="L440" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="fc" id="L441">			value = getValue(&quot;defaultfontcolor&quot;);</span>

<span class="pc bpc" id="L443" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="fc" id="L444">			value = param[0].getDefaultColor();</span>

<span class="pc bpc" id="L446" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="nc" id="L447">			return null;</span>

<span class="fc" id="L449">		return getIHtmlColorSet().getColorOrWhite(value);</span>
	}

	private String getFirstValueNonNullWithSuffix(String suffix, FontParam... param) {
<span class="fc bfc" id="L453" title="All 2 branches covered.">		for (FontParam p : param) {</span>
<span class="fc" id="L454">			final String v = getValue(p.name() + suffix);</span>
<span class="pc bpc" id="L455" title="1 of 2 branches missed.">			if (v != null)</span>
<span class="nc" id="L456">				return v;</span>

		}
<span class="fc" id="L459">		return null;</span>
	}

	private int getFontStyle(Stereotype stereotype, boolean inPackageTitle, FontParam... param) {
<span class="fc" id="L463">		String value = null;</span>
<span class="fc bfc" id="L464" title="All 2 branches covered.">		if (stereotype != null) {</span>
<span class="fc" id="L465">			checkStereotype(stereotype);</span>
<span class="fc" id="L466">			value = getFirstValueNonNullWithSuffix(&quot;fontstyle&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR),</span>
					param);
		}
<span class="pc bpc" id="L469" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="fc" id="L470">			value = getFirstValueNonNullWithSuffix(&quot;fontstyle&quot;, param);</span>

<span class="pc bpc" id="L472" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="fc" id="L473">			value = getValue(&quot;defaultfontstyle&quot;);</span>

<span class="pc bpc" id="L475" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="fc" id="L476">			return param[0].getDefaultFontStyle(this, inPackageTitle);</span>

<span class="nc" id="L478">		int result = Font.PLAIN;</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">		if (StringUtils.goLowerCase(value).contains(&quot;bold&quot;))</span>
<span class="nc" id="L480">			result = result | Font.BOLD;</span>

<span class="nc bnc" id="L482" title="All 2 branches missed.">		if (StringUtils.goLowerCase(value).contains(&quot;italic&quot;))</span>
<span class="nc" id="L483">			result = result | Font.ITALIC;</span>

<span class="nc" id="L485">		return result;</span>
	}

	@Override
	public UFont getFont(Stereotype stereotype, boolean inPackageTitle, FontParam... fontParam) {
<span class="fc bfc" id="L490" title="All 2 branches covered.">		if (stereotype != null)</span>
<span class="fc" id="L491">			checkStereotype(stereotype);</span>

<span class="fc" id="L493">		final String fontFamily = getFontFamily(stereotype, fontParam);</span>
<span class="fc" id="L494">		final int fontStyle = getFontStyle(stereotype, inPackageTitle, fontParam);</span>
<span class="fc" id="L495">		final int fontSize = getFontSize(stereotype, fontParam);</span>
<span class="fc" id="L496">		return UFont.build(fontFamily, fontStyle, fontSize);</span>
	}

	@Override
	public int getCircledCharacterRadius() {
<span class="fc" id="L501">		final int value = getAsInt(&quot;circledCharacterRadius&quot;, -1);</span>
<span class="fc bfc" id="L502" title="All 2 branches covered.">		return value == -1 ? getFontSize(null, FontParam.CIRCLED_CHARACTER) / 3 + 6 : value;</span>
	}

	@Override
	public int classAttributeIconSize() {
<span class="fc" id="L507">		return getAsInt(&quot;classAttributeIconSize&quot;, 10);</span>
	}

	public static Collection&lt;String&gt; getPossibleValues() {
<span class="fc" id="L511">		final Set&lt;String&gt; result = new TreeSet&lt;&gt;();</span>
<span class="fc" id="L512">		result.add(&quot;Monochrome&quot;);</span>
		// result.add(&quot;BackgroundColor&quot;);
<span class="fc" id="L514">		result.add(&quot;CircledCharacterRadius&quot;);</span>
<span class="fc" id="L515">		result.add(&quot;ClassAttributeIconSize&quot;);</span>
<span class="fc" id="L516">		result.add(&quot;DefaultFontName&quot;);</span>
<span class="fc" id="L517">		result.add(&quot;DefaultFontStyle&quot;);</span>
<span class="fc" id="L518">		result.add(&quot;DefaultFontSize&quot;);</span>
<span class="fc" id="L519">		result.add(&quot;DefaultFontColor&quot;);</span>
<span class="fc" id="L520">		result.add(&quot;MinClassWidth&quot;);</span>
<span class="fc" id="L521">		result.add(&quot;MinClassWidth&quot;);</span>
<span class="fc" id="L522">		result.add(&quot;Dpi&quot;);</span>
<span class="fc" id="L523">		result.add(&quot;DefaultTextAlignment&quot;);</span>
<span class="fc" id="L524">		result.add(&quot;Shadowing&quot;);</span>
<span class="fc" id="L525">		result.add(&quot;NoteShadowing&quot;);</span>
<span class="fc" id="L526">		result.add(&quot;Handwritten&quot;);</span>
<span class="fc" id="L527">		result.add(&quot;CircledCharacterRadius&quot;);</span>
<span class="fc" id="L528">		result.add(&quot;ClassAttributeIconSize&quot;);</span>
<span class="fc" id="L529">		result.add(&quot;Linetype&quot;);</span>
<span class="fc" id="L530">		result.add(&quot;PackageStyle&quot;);</span>
<span class="fc" id="L531">		result.add(&quot;ComponentStyle&quot;);</span>
<span class="fc" id="L532">		result.add(&quot;StereotypePosition&quot;);</span>
<span class="fc" id="L533">		result.add(&quot;Nodesep&quot;);</span>
<span class="fc" id="L534">		result.add(&quot;Ranksep&quot;);</span>
<span class="fc" id="L535">		result.add(&quot;RoundCorner&quot;);</span>
<span class="fc" id="L536">		result.add(&quot;TitleBorderRoundCorner&quot;);</span>
<span class="fc" id="L537">		result.add(&quot;MaxMessageSize&quot;);</span>
<span class="fc" id="L538">		result.add(&quot;Style&quot;);</span>
<span class="fc" id="L539">		result.add(&quot;SequenceParticipant&quot;);</span>
<span class="fc" id="L540">		result.add(&quot;ConditionStyle&quot;);</span>
<span class="fc" id="L541">		result.add(&quot;ConditionEndStyle&quot;);</span>
<span class="fc" id="L542">		result.add(&quot;SameClassWidth&quot;);</span>
<span class="fc" id="L543">		result.add(&quot;HyperlinkUnderline&quot;);</span>
<span class="fc" id="L544">		result.add(&quot;Padding&quot;);</span>
<span class="fc" id="L545">		result.add(&quot;BoxPadding&quot;);</span>
<span class="fc" id="L546">		result.add(&quot;ParticipantPadding&quot;);</span>
<span class="fc" id="L547">		result.add(&quot;Guillemet&quot;);</span>
<span class="fc" id="L548">		result.add(&quot;SvglinkTarget&quot;);</span>
<span class="fc" id="L549">		result.add(&quot;DefaultMonospacedFontName&quot;);</span>
<span class="fc" id="L550">		result.add(&quot;TabSize&quot;);</span>
<span class="fc" id="L551">		result.add(&quot;MaxAsciiMessageLength&quot;);</span>
<span class="fc" id="L552">		result.add(&quot;ColorArrowSeparationSpace&quot;);</span>
<span class="fc" id="L553">		result.add(&quot;ResponseMessageBelowArrow&quot;);</span>
<span class="fc" id="L554">		result.add(&quot;GenericDisplay&quot;);</span>
<span class="fc" id="L555">		result.add(&quot;PathHoverColor&quot;);</span>
<span class="fc" id="L556">		result.add(&quot;SwimlaneWidth&quot;);</span>
<span class="fc" id="L557">		result.add(&quot;PageBorderColor&quot;);</span>
<span class="fc" id="L558">		result.add(&quot;PageExternalColor&quot;);</span>
<span class="fc" id="L559">		result.add(&quot;PageMargin&quot;);</span>
<span class="fc" id="L560">		result.add(&quot;WrapWidth&quot;);</span>
<span class="fc" id="L561">		result.add(&quot;SwimlaneWidth&quot;);</span>
<span class="fc" id="L562">		result.add(&quot;SwimlaneWrapTitleWidth&quot;);</span>
<span class="fc" id="L563">		result.add(&quot;FixCircleLabelOverlapping&quot;);</span>
		// result.add(&quot;LifelineStrategy&quot;);

<span class="fc bfc" id="L566" title="All 2 branches covered.">		for (FontParam p : EnumSet.allOf(FontParam.class)) {</span>
<span class="fc" id="L567">			final String h = humanName(p.name());</span>
<span class="fc" id="L568">			result.add(h + &quot;FontStyle&quot;);</span>
<span class="fc" id="L569">			result.add(h + &quot;FontName&quot;);</span>
<span class="fc" id="L570">			result.add(h + &quot;FontSize&quot;);</span>
<span class="fc" id="L571">			result.add(h + &quot;FontColor&quot;);</span>
<span class="fc" id="L572">		}</span>
<span class="fc bfc" id="L573" title="All 2 branches covered.">		for (ColorParam p : EnumSet.allOf(ColorParam.class)) {</span>
<span class="fc" id="L574">			final String h = capitalize(p.name());</span>
<span class="fc" id="L575">			result.add(h + &quot;Color&quot;);</span>
<span class="fc" id="L576">		}</span>
<span class="fc bfc" id="L577" title="All 2 branches covered.">		for (LineParam p : EnumSet.allOf(LineParam.class)) {</span>
<span class="fc" id="L578">			final String h = capitalize(p.name());</span>
<span class="fc" id="L579">			result.add(h + &quot;Thickness&quot;);</span>
<span class="fc" id="L580">		}</span>
<span class="fc bfc" id="L581" title="All 2 branches covered.">		for (AlignmentParam p : EnumSet.allOf(AlignmentParam.class)) {</span>
<span class="fc" id="L582">			final String h = capitalize(p.name());</span>
<span class="fc" id="L583">			result.add(h);</span>
<span class="fc" id="L584">		}</span>
<span class="fc" id="L585">		return Collections.unmodifiableSet(result);</span>
	}

	private static String capitalize(String name) {
<span class="fc" id="L589">		return StringUtils.goUpperCase(name.substring(0, 1)) + name.substring(1);</span>
	}

	@Override
	public int getDpi() {
<span class="fc" id="L594">		final int defaultValue = 96;</span>
<span class="fc" id="L595">		final int dpi = getAsInt(&quot;dpi&quot;, defaultValue);</span>
<span class="pc bpc" id="L596" title="1 of 2 branches missed.">		if (dpi &lt;= 0)</span>
<span class="nc" id="L597">			return defaultValue;</span>
<span class="fc" id="L598">		return dpi;</span>
	}

	@Override
	public DotSplines getDotSplines() {
<span class="fc" id="L603">		final String value = getValue(&quot;linetype&quot;);</span>
<span class="pc bpc" id="L604" title="1 of 2 branches missed.">		if (&quot;polyline&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L605">			return DotSplines.POLYLINE;</span>

<span class="pc bpc" id="L607" title="1 of 2 branches missed.">		if (&quot;ortho&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L608">			return DotSplines.ORTHO;</span>

<span class="fc" id="L610">		return DotSplines.SPLINES;</span>
	}

	@Override
	public HorizontalAlignment getHorizontalAlignment(AlignmentParam param, ArrowDirection arrowDirection,
			boolean isReverseDefine, HorizontalAlignment overrideDefault) {
		final String value;
<span class="pc bpc" id="L617" title="2 of 3 branches missed.">		switch (param) {</span>
		case sequenceMessageAlignment:
<span class="nc" id="L619">			value = getArg(getValue(AlignmentParam.sequenceMessageAlignment.name()), 0);</span>
<span class="nc" id="L620">			break;</span>
		case sequenceMessageTextAlignment:
<span class="nc" id="L622">			value = getArg(getValue(AlignmentParam.sequenceMessageAlignment.name()), 1);</span>
<span class="nc" id="L623">			break;</span>
		default:
<span class="fc" id="L625">			value = getValue(param.name());</span>
		}
<span class="pc bpc" id="L627" title="1 of 2 branches missed.">		if (&quot;first&quot;.equalsIgnoreCase(value)) {</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">			if (arrowDirection == ArrowDirection.RIGHT_TO_LEFT_REVERSE) {</span>
<span class="nc bnc" id="L629" title="All 2 branches missed.">				if (isReverseDefine)</span>
<span class="nc" id="L630">					return HorizontalAlignment.LEFT;</span>

<span class="nc" id="L632">				return HorizontalAlignment.RIGHT;</span>
			} else {
<span class="nc bnc" id="L634" title="All 2 branches missed.">				if (isReverseDefine)</span>
<span class="nc" id="L635">					return HorizontalAlignment.RIGHT;</span>

<span class="nc" id="L637">				return HorizontalAlignment.LEFT;</span>
			}
		}
<span class="pc bpc" id="L640" title="1 of 2 branches missed.">		if (&quot;direction&quot;.equalsIgnoreCase(value)) {</span>
<span class="nc bnc" id="L641" title="All 2 branches missed.">			if (arrowDirection == ArrowDirection.LEFT_TO_RIGHT_NORMAL)</span>
<span class="nc" id="L642">				return HorizontalAlignment.LEFT;</span>

<span class="nc bnc" id="L644" title="All 2 branches missed.">			if (arrowDirection == ArrowDirection.RIGHT_TO_LEFT_REVERSE)</span>
<span class="nc" id="L645">				return HorizontalAlignment.RIGHT;</span>

<span class="nc bnc" id="L647" title="All 2 branches missed.">			if (arrowDirection == ArrowDirection.BOTH_DIRECTION)</span>
<span class="nc" id="L648">				return HorizontalAlignment.CENTER;</span>

		}
<span class="pc bpc" id="L651" title="1 of 2 branches missed.">		if (&quot;reversedirection&quot;.equalsIgnoreCase(value)) {</span>
<span class="nc bnc" id="L652" title="All 2 branches missed.">			if (arrowDirection == ArrowDirection.LEFT_TO_RIGHT_NORMAL)</span>
<span class="nc" id="L653">				return HorizontalAlignment.RIGHT;</span>

<span class="nc bnc" id="L655" title="All 2 branches missed.">			if (arrowDirection == ArrowDirection.RIGHT_TO_LEFT_REVERSE)</span>
<span class="nc" id="L656">				return HorizontalAlignment.LEFT;</span>

<span class="nc bnc" id="L658" title="All 2 branches missed.">			if (arrowDirection == ArrowDirection.BOTH_DIRECTION)</span>
<span class="nc" id="L659">				return HorizontalAlignment.CENTER;</span>

		}
<span class="fc" id="L662">		final HorizontalAlignment result = HorizontalAlignment.fromString(value);</span>
<span class="pc bpc" id="L663" title="1 of 4 branches missed.">		if (result == null &amp;&amp; param == AlignmentParam.noteTextAlignment)</span>
<span class="pc bpc" id="L664" title="1 of 2 branches missed.">			return getDefaultTextAlignment(overrideDefault == null ? HorizontalAlignment.LEFT : overrideDefault);</span>
<span class="pc bpc" id="L665" title="2 of 4 branches missed.">		else if (result == null &amp;&amp; param == AlignmentParam.stateMessageAlignment)</span>
<span class="nc" id="L666">			return getDefaultTextAlignment(HorizontalAlignment.CENTER);</span>
<span class="pc bpc" id="L667" title="1 of 2 branches missed.">		else if (result == null)</span>
<span class="fc" id="L668">			return param.getDefaultValue();</span>

<span class="nc" id="L670">		return result;</span>
	}

	@Override
	public HorizontalAlignment getDefaultTextAlignment(HorizontalAlignment defaultValue) {
<span class="fc" id="L675">		final String value = getValue(&quot;defaulttextalignment&quot;);</span>
<span class="fc" id="L676">		final HorizontalAlignment result = HorizontalAlignment.fromString(value);</span>
<span class="fc bfc" id="L677" title="All 2 branches covered.">		if (result == null)</span>
<span class="fc" id="L678">			return defaultValue;</span>

<span class="fc" id="L680">		return result;</span>
	}

	@Override
	public HorizontalAlignment getStereotypeAlignment() {
<span class="fc" id="L685">		final String value = getValue(&quot;stereotypealignment&quot;);</span>
<span class="fc" id="L686">		final HorizontalAlignment result = HorizontalAlignment.fromString(value);</span>
<span class="pc bpc" id="L687" title="1 of 2 branches missed.">		if (result == null)</span>
<span class="fc" id="L688">			return HorizontalAlignment.CENTER;</span>

<span class="nc" id="L690">		return result;</span>
	}

	private String getArg(String value, int i) {
<span class="nc bnc" id="L694" title="All 2 branches missed.">		if (value == null)</span>
<span class="nc" id="L695">			return null;</span>

<span class="nc" id="L697">		final String[] split = value.split(&quot;:&quot;);</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">		if (i &gt;= split.length)</span>
<span class="nc" id="L699">			return split[0];</span>

<span class="nc" id="L701">		return split[i];</span>
	}

	@Override
	public boolean shadowing(Stereotype stereotype) {
<span class="fc bfc" id="L706" title="All 2 branches covered.">		if (stereotype != null) {</span>
<span class="fc" id="L707">			checkStereotype(stereotype);</span>
<span class="fc" id="L708">			final String value2 = getValue(&quot;shadowing&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR));</span>
<span class="pc bpc" id="L709" title="1 of 2 branches missed.">			if (value2 != null)</span>
<span class="nc" id="L710">				return value2.equalsIgnoreCase(&quot;true&quot;);</span>

		}
<span class="fc" id="L713">		final String value = getValue(&quot;shadowing&quot;);</span>
<span class="fc bfc" id="L714" title="All 2 branches covered.">		if (&quot;false&quot;.equalsIgnoreCase(value))</span>
<span class="fc" id="L715">			return false;</span>

<span class="pc bpc" id="L717" title="1 of 2 branches missed.">		if (&quot;true&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L718">			return true;</span>

<span class="pc bpc" id="L720" title="1 of 2 branches missed.">		if (strictUmlStyle())</span>
<span class="nc" id="L721">			return false;</span>

<span class="fc" id="L723">		return true;</span>
	}

	@Override
	public boolean shadowingForNote(Stereotype stereotype) {
<span class="fc bfc" id="L728" title="All 2 branches covered.">		if (stereotype != null) {</span>
<span class="fc" id="L729">			checkStereotype(stereotype);</span>
<span class="fc" id="L730">			final String value2 = getValue(&quot;note&quot; + &quot;shadowing&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR));</span>
<span class="pc bpc" id="L731" title="1 of 2 branches missed.">			if (value2 != null)</span>
<span class="nc" id="L732">				return value2.equalsIgnoreCase(&quot;true&quot;);</span>

		}
<span class="fc" id="L735">		final String value2 = getValue(&quot;note&quot; + &quot;shadowing&quot;);</span>
<span class="pc bpc" id="L736" title="1 of 2 branches missed.">		if (value2 != null)</span>
<span class="nc" id="L737">			return value2.equalsIgnoreCase(&quot;true&quot;);</span>

<span class="fc" id="L739">		return shadowing(stereotype);</span>
	}

<span class="fc" id="L742">	private final Map&lt;String, Sprite&gt; sprites = new HashMap&lt;String, Sprite&gt;();</span>

	@Override
	public Collection&lt;String&gt; getAllSpriteNames() {
<span class="fc" id="L746">		return Collections.unmodifiableCollection(new TreeSet&lt;&gt;(sprites.keySet()));</span>
	}

	public void addSprite(String name, Sprite sprite) {
<span class="fc" id="L750">		sprites.put(name, sprite);</span>
<span class="fc" id="L751">	}</span>

	@Override
	public Sprite getSprite(String name) {
<span class="fc" id="L755">		Sprite result = sprites.get(name);</span>
<span class="pc bpc" id="L756" title="1 of 2 branches missed.">		if (result == null)</span>
<span class="nc" id="L757">			result = SpriteImage.fromInternal(name);</span>

<span class="fc" id="L759">		return result;</span>
	}

	@Override
	public PackageStyle packageStyle() {
<span class="fc" id="L764">		final String value = getValue(&quot;packageStyle&quot;);</span>
<span class="fc" id="L765">		final PackageStyle p = PackageStyle.fromString(value);</span>
<span class="pc bpc" id="L766" title="1 of 2 branches missed.">		if (p == null)</span>
<span class="fc" id="L767">			return PackageStyle.FOLDER;</span>

<span class="nc" id="L769">		return p;</span>
	}

	@Override
	public ComponentStyle componentStyle() {
<span class="pc bpc" id="L774" title="1 of 2 branches missed.">		if (strictUmlStyle())</span>
<span class="nc" id="L775">			return ComponentStyle.UML2;</span>

<span class="fc" id="L777">		final String value = getValue(&quot;componentstyle&quot;);</span>
<span class="pc bpc" id="L778" title="1 of 2 branches missed.">		if (&quot;uml1&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L779">			return ComponentStyle.UML1;</span>
<span class="pc bpc" id="L780" title="1 of 2 branches missed.">		if (&quot;uml2&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L781">			return ComponentStyle.UML2;</span>
<span class="pc bpc" id="L782" title="1 of 2 branches missed.">		if (&quot;rectangle&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L783">			return ComponentStyle.RECTANGLE;</span>
<span class="fc" id="L784">		return ComponentStyle.UML2;</span>
	}

	@Override
	public boolean stereotypePositionTop() {
<span class="fc bfc" id="L789" title="All 2 branches covered.">		return !valueIs(&quot;stereotypePosition&quot;, &quot;bottom&quot;);</span>
	}

	@Override
	public boolean useSwimlanes(UmlDiagramType type) {
<span class="fc bfc" id="L794" title="All 2 branches covered.">		if (type != UmlDiagramType.ACTIVITY)</span>
<span class="fc" id="L795">			return false;</span>

<span class="fc" id="L797">		return swimlanes();</span>
	}

	public boolean swimlanes() {
<span class="fc bfc" id="L801" title="All 4 branches covered.">		return isTrue(&quot;swimlane&quot;) || isTrue(&quot;swimlanes&quot;);</span>
	}

	@Override
	public double getNodesep() {
		// TODO strange, this returns a double but only accepts integer values
<span class="fc" id="L807">		return getAsInt(&quot;nodesep&quot;, 0);</span>
	}

	@Override
	public double getRanksep() {
		// TODO strange, this returns a double but only accepts integer values
<span class="fc" id="L813">		return getAsInt(&quot;ranksep&quot;, 0);</span>
	}

	@Override

	public double getDiagonalCorner(CornerParam param, Stereotype stereotype) {
<span class="fc" id="L819">		final String key = param.getDiagonalKey();</span>
<span class="fc" id="L820">		Double result = getCornerInternal(key, param, stereotype);</span>
<span class="pc bpc" id="L821" title="1 of 2 branches missed.">		if (result != null)</span>
<span class="nc" id="L822">			return result;</span>

<span class="fc" id="L824">		result = getCornerInternal(key, param, null);</span>
<span class="pc bpc" id="L825" title="1 of 2 branches missed.">		if (result != null)</span>
<span class="nc" id="L826">			return result;</span>

<span class="fc bfc" id="L828" title="All 2 branches covered.">		if (param == CornerParam.DEFAULT)</span>
<span class="fc" id="L829">			return 0;</span>

<span class="fc" id="L831">		return getDiagonalCorner(CornerParam.DEFAULT, stereotype);</span>
	}

	@Override
	public double getRoundCorner(CornerParam param, Stereotype stereotype) {
<span class="fc" id="L836">		final String key = param.getRoundKey();</span>
<span class="fc" id="L837">		Double result = getCornerInternal(key, param, stereotype);</span>
<span class="pc bpc" id="L838" title="1 of 2 branches missed.">		if (result != null)</span>
<span class="nc" id="L839">			return result;</span>

<span class="fc" id="L841">		result = getCornerInternal(key, param, null);</span>
<span class="pc bpc" id="L842" title="1 of 2 branches missed.">		if (result != null)</span>
<span class="nc" id="L843">			return result;</span>

<span class="fc bfc" id="L845" title="All 2 branches covered.">		if (param == CornerParam.DEFAULT)</span>
<span class="fc" id="L846">			return 0;</span>

<span class="fc" id="L848">		return getRoundCorner(CornerParam.DEFAULT, stereotype);</span>
	}

	private Double getCornerInternal(String key, CornerParam param, Stereotype stereotype) {
<span class="fc bfc" id="L852" title="All 2 branches covered.">		if (stereotype != null)</span>
<span class="fc" id="L853">			key += stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR);</span>

<span class="fc" id="L855">		final String value = getValue(key);</span>
<span class="pc bpc" id="L856" title="3 of 4 branches missed.">		if (value != null &amp;&amp; value.matches(&quot;\\d+&quot;))</span>
<span class="nc" id="L857">			return Double.parseDouble(value);</span>

<span class="fc" id="L859">		return null;</span>
	}

	@Override
	public UStroke getThickness(LineParam param, Stereotype stereotype) {
<span class="fc" id="L864">		LinkStyle style = null;</span>
<span class="fc bfc" id="L865" title="All 2 branches covered.">		if (stereotype != null) {</span>
<span class="fc" id="L866">			checkStereotype(stereotype);</span>

<span class="fc" id="L868">			final String styleValue = getValue(</span>
<span class="fc" id="L869">					param.name() + &quot;style&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR));</span>
<span class="pc bpc" id="L870" title="1 of 2 branches missed.">			if (styleValue != null)</span>
<span class="nc" id="L871">				style = LinkStyle.fromString2(styleValue);</span>

<span class="fc" id="L873">			final String value2 = getValue(</span>
<span class="fc" id="L874">					param.name() + &quot;thickness&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR));</span>
<span class="pc bpc" id="L875" title="3 of 4 branches missed.">			if (value2 != null &amp;&amp; value2.matches(&quot;[\\d.]+&quot;)) {</span>
<span class="nc bnc" id="L876" title="All 2 branches missed.">				if (style == null)</span>
<span class="nc" id="L877">					style = LinkStyle.NORMAL();</span>

<span class="nc" id="L879">				return style.goThickness(Double.parseDouble(value2)).getStroke3();</span>
			}
		}
<span class="fc" id="L882">		final String value = getValue(param.name() + &quot;thickness&quot;);</span>
<span class="pc bpc" id="L883" title="3 of 4 branches missed.">		if (value != null &amp;&amp; value.matches(&quot;[\\d.]+&quot;)) {</span>
<span class="nc bnc" id="L884" title="All 2 branches missed.">			if (style == null)</span>
<span class="nc" id="L885">				style = LinkStyle.NORMAL();</span>

<span class="nc" id="L887">			return style.goThickness(Double.parseDouble(value)).getStroke3();</span>
		}
<span class="pc bpc" id="L889" title="1 of 2 branches missed.">		if (style == null) {</span>
<span class="fc" id="L890">			final String styleValue = getValue(param.name() + &quot;style&quot;);</span>
<span class="pc bpc" id="L891" title="1 of 2 branches missed.">			if (styleValue != null)</span>
<span class="nc" id="L892">				style = LinkStyle.fromString2(styleValue);</span>

		}
<span class="pc bpc" id="L895" title="3 of 4 branches missed.">		if (style != null &amp;&amp; style.isNormal() == false)</span>
<span class="nc" id="L896">			return style.getStroke3();</span>

<span class="fc" id="L898">		return null;</span>
	}

	@Override
	public LineBreakStrategy maxMessageSize() {
<span class="fc" id="L903">		String value = getValue(&quot;wrapmessagewidth&quot;);</span>
<span class="pc bpc" id="L904" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="fc" id="L905">			value = getValue(&quot;maxmessagesize&quot;);</span>

<span class="fc" id="L907">		return new LineBreakStrategy(value);</span>
	}

	@Override
	public LineBreakStrategy swimlaneWrapTitleWidth() {
<span class="fc" id="L912">		final String value = getValue(&quot;swimlanewraptitlewidth&quot;);</span>
<span class="fc" id="L913">		return new LineBreakStrategy(value);</span>
	}

	@Override
	public boolean strictUmlStyle() {
<span class="fc" id="L918">		return valueIs(&quot;style&quot;, &quot;strictuml&quot;);</span>
	}

	@Override
	public boolean forceSequenceParticipantUnderlined() {
<span class="fc" id="L923">		return valueIs(&quot;sequenceParticipant&quot;, &quot;underline&quot;);</span>
	}

	@Override
	public ConditionStyle getConditionStyle() {
<span class="fc" id="L928">		final String value = getValue(&quot;conditionStyle&quot;);</span>
<span class="fc" id="L929">		final ConditionStyle p = ConditionStyle.fromString(value);</span>
<span class="pc bpc" id="L930" title="1 of 2 branches missed.">		if (p == null)</span>
<span class="fc" id="L931">			return ConditionStyle.INSIDE_HEXAGON;</span>

<span class="nc" id="L933">		return p;</span>
	}

	@Override
	public ConditionEndStyle getConditionEndStyle() {
<span class="fc" id="L938">		final String value = getValue(&quot;conditionEndStyle&quot;);</span>
<span class="fc" id="L939">		final ConditionEndStyle p = ConditionEndStyle.fromString(value);</span>
<span class="pc bpc" id="L940" title="1 of 2 branches missed.">		if (p == null)</span>
<span class="fc" id="L941">			return ConditionEndStyle.DIAMOND;</span>

<span class="nc" id="L943">		return p;</span>
	}

	@Override
	public boolean sameClassWidth() {
<span class="fc" id="L948">		return isTrue(&quot;sameclasswidth&quot;);</span>
	}

	@Override
	public final Rankdir getRankdir() {
<span class="fc" id="L953">		return rankdir;</span>
	}

	public final void setRankdir(Rankdir rankdir) {
<span class="fc" id="L957">		this.rankdir = rankdir;</span>
<span class="fc" id="L958">	}</span>

	@Override
	public boolean useOctagonForActivity(Stereotype stereotype) {
<span class="fc" id="L962">		String value = getValue(&quot;activityshape&quot;);</span>
<span class="fc bfc" id="L963" title="All 2 branches covered.">		if (stereotype != null) {</span>
<span class="fc" id="L964">			checkStereotype(stereotype);</span>
<span class="fc" id="L965">			final String value2 = getValue(&quot;activityshape&quot; + stereotype.getLabel(Guillemet.DOUBLE_COMPARATOR));</span>
<span class="pc bpc" id="L966" title="1 of 2 branches missed.">			if (value2 != null)</span>
<span class="nc" id="L967">				value = value2;</span>

		}
<span class="pc bpc" id="L970" title="1 of 2 branches missed.">		if (&quot;roundedbox&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L971">			return false;</span>

<span class="pc bpc" id="L973" title="1 of 2 branches missed.">		if (&quot;octagon&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L974">			return true;</span>

<span class="fc" id="L976">		return false;</span>
	}

<span class="fc" id="L979">	private final HColorSet htmlColorSet = HColorSet.instance();</span>

	@Override
	public HColorSet getIHtmlColorSet() {
<span class="fc" id="L983">		return htmlColorSet;</span>
	}

	@Override
	public UStroke useUnderlineForHyperlink() {
<span class="fc bfc" id="L988" title="All 2 branches covered.">		if (valueIs(&quot;hyperlinkunderline&quot;, &quot;false&quot;) == false)</span>
<span class="fc" id="L989">			return UStroke.simple();</span>
<span class="fc" id="L990">		return null;</span>
	}

	@Override
	public int groupInheritance() {
<span class="fc" id="L995">		final int value = getAsInt(&quot;groupinheritance&quot;, Integer.MAX_VALUE);</span>
<span class="fc bfc" id="L996" title="All 2 branches covered.">		return value &lt;= 1 ? Integer.MAX_VALUE : value;</span>
	}

	@Override
	public Guillemet guillemet() {
<span class="fc" id="L1001">		final String value = getValue(&quot;guillemet&quot;);</span>
<span class="fc" id="L1002">		return Guillemet.GUILLEMET.fromDescription(value);</span>
	}

	@Override
	public boolean handwritten() {
<span class="fc" id="L1007">		return isTrue(&quot;handwritten&quot;);</span>
	}

	@Override
	public String getSvgLinkTarget() {
<span class="fc" id="L1012">		return getValue(&quot;svglinktarget&quot;, &quot;_top&quot;);</span>
	}

	@Override
	public String getPreserveAspectRatio() {
<span class="fc" id="L1017">		return getValue(&quot;preserveaspectratio&quot;, DEFAULT_PRESERVE_ASPECT_RATIO);</span>
	}

	@Override
	public String getMonospacedFamily() {
<span class="fc" id="L1022">		return getValue(&quot;defaultMonospacedFontName&quot;, Parser.MONOSPACED);</span>
	}

	@Override
	public int getTabSize() {
<span class="fc" id="L1027">		return getAsInt(&quot;tabsize&quot;, 8);</span>
	}

	@Override
	public int maxAsciiMessageLength() {
<span class="fc" id="L1032">		return getAsInt(&quot;maxasciimessagelength&quot;, -1);</span>
	}

	@Override
	public int colorArrowSeparationSpace() {
<span class="fc" id="L1037">		return getAsInt(&quot;colorarrowseparationspace&quot;, 0);</span>
	}

	@Override
	public SplitParam getSplitParam() {
<span class="fc" id="L1042">		final String border = getValue(&quot;pageBorderColor&quot;);</span>
<span class="fc" id="L1043">		final String external = getValue(&quot;pageExternalColor&quot;);</span>
<span class="fc bfc" id="L1044" title="All 2 branches covered.">		final HColor borderColor = border == null ? null : getIHtmlColorSet().getColorOrWhite(border);</span>
<span class="fc bfc" id="L1045" title="All 2 branches covered.">		final HColor externalColor = external == null ? null : getIHtmlColorSet().getColorOrWhite(external);</span>
<span class="fc" id="L1046">		int margin = getAsInt(&quot;pageMargin&quot;, 0);</span>
<span class="fc" id="L1047">		return new SplitParam(borderColor, externalColor, margin);</span>
	}

	@Override
	public int swimlaneWidth() {
<span class="fc" id="L1052">		final String value = getValue(&quot;swimlanewidth&quot;);</span>
<span class="pc bpc" id="L1053" title="1 of 2 branches missed.">		if (&quot;same&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L1054">			return SWIMLANE_WIDTH_SAME;</span>

<span class="pc bpc" id="L1056" title="3 of 4 branches missed.">		if (value != null &amp;&amp; value.matches(&quot;\\d+&quot;))</span>
<span class="nc" id="L1057">			return Integer.parseInt(value);</span>

<span class="fc" id="L1059">		return 0;</span>
	}

	@Override
	public UmlDiagramType getUmlDiagramType() {
<span class="fc" id="L1064">		return type;</span>
	}

	@Override
	public HColor hoverPathColor() {
<span class="fc" id="L1069">		final String value = getValue(&quot;pathhovercolor&quot;);</span>
<span class="pc bpc" id="L1070" title="1 of 2 branches missed.">		if (value == null)</span>
<span class="fc" id="L1071">			return null;</span>

<span class="nc" id="L1073">		return getIHtmlColorSet().getColorOrWhite(value);</span>
	}

	@Override
	public double getPadding() {
<span class="fc" id="L1078">		final String name = &quot;padding&quot;;</span>
<span class="fc" id="L1079">		return getAsDouble(name);</span>
	}

	@Override
	public double getPadding(PaddingParam param) {
<span class="fc" id="L1084">		final String name = param.getSkinName();</span>
<span class="fc" id="L1085">		return getAsDouble(name);</span>
	}

	private double getAsDouble(final String name) {
<span class="fc" id="L1089">		final String value = getValue(name);</span>
<span class="pc bpc" id="L1090" title="1 of 4 branches missed.">		if (value != null &amp;&amp; value.matches(&quot;\\d+(\\.\\d+)?&quot;))</span>
<span class="fc" id="L1091">			return Double.parseDouble(value);</span>

<span class="fc" id="L1093">		return 0;</span>
	}

	private int getAsInt(String key, int defaultValue) {
<span class="fc" id="L1097">		final String value = getValue(key);</span>
<span class="pc bpc" id="L1098" title="1 of 4 branches missed.">		if (value != null &amp;&amp; value.matches(&quot;\\d+&quot;))</span>
<span class="fc" id="L1099">			return Integer.parseInt(value);</span>

<span class="fc" id="L1101">		return defaultValue;</span>
	}

	@Override
	public boolean useRankSame() {
<span class="fc" id="L1106">		return false;</span>
	}

	@Override
	public boolean displayGenericWithOldFashion() {
<span class="fc" id="L1111">		return valueIs(&quot;genericDisplay&quot;, &quot;old&quot;);</span>
	}

	@Override
	public boolean responseMessageBelowArrow() {
<span class="fc" id="L1116">		return isTrue(&quot;responsemessagebelowarrow&quot;);</span>
	}

	@Override
	public TikzFontDistortion getTikzFontDistortion() {
<span class="fc" id="L1121">		final String value = getValue(&quot;tikzFont&quot;);</span>
<span class="fc" id="L1122">		return TikzFontDistortion.fromValue(value);</span>
	}

	@Override
	public boolean svgDimensionStyle() {
<span class="fc bfc" id="L1127" title="All 2 branches covered.">		return !valueIs(&quot;svgdimensionstyle&quot;, &quot;false&quot;);</span>
	}

	@Override
	public boolean fixCircleLabelOverlapping() {
<span class="fc" id="L1132">		return isTrue(&quot;fixcirclelabeloverlapping&quot;);</span>
	}

	@Override
	public void setUseVizJs(boolean useVizJs) {
<span class="nc" id="L1137">		this.useVizJs = useVizJs;</span>
<span class="nc" id="L1138">	}</span>

	@Override
	public boolean isUseVizJs() {
<span class="fc" id="L1142">		return useVizJs;</span>
	}

	@Override
	public Padder sequenceDiagramPadder() {
<span class="fc" id="L1147">		final double padding = getAsDouble(&quot;SequenceMessagePadding&quot;);</span>
<span class="fc" id="L1148">		final double margin = getAsDouble(&quot;SequenceMessageMargin&quot;);</span>
<span class="fc" id="L1149">		final String borderColor = getValue(&quot;SequenceMessageBorderColor&quot;);</span>
<span class="fc" id="L1150">		final String backgroundColor = getValue(&quot;SequenceMessageBackGroundColor&quot;);</span>
<span class="pc bpc" id="L1151" title="4 of 8 branches missed.">		if (padding == 0 &amp;&amp; margin == 0 &amp;&amp; borderColor == null &amp;&amp; backgroundColor == null)</span>
<span class="fc" id="L1152">			return Padder.NONE;</span>

<span class="nc bnc" id="L1154" title="All 2 branches missed.">		final HColor border = borderColor == null ? null : getIHtmlColorSet().getColorOrWhite(borderColor);</span>
<span class="nc bnc" id="L1155" title="All 2 branches missed.">		final HColor background = backgroundColor == null ? null : getIHtmlColorSet().getColorOrWhite(backgroundColor);</span>
<span class="nc" id="L1156">		final double roundCorner = getRoundCorner(CornerParam.DEFAULT, null);</span>
<span class="nc" id="L1157">		return Padder.NONE.withMargin(margin).withPadding(padding).withBackgroundColor(background)</span>
<span class="nc" id="L1158">				.withBorderColor(border).withRoundCorner(roundCorner);</span>
	}

	@Override
	public ActorStyle actorStyle() {
<span class="fc" id="L1163">		final String value = getValue(&quot;actorstyle&quot;);</span>
<span class="fc bfc" id="L1164" title="All 2 branches covered.">		if (&quot;awesome&quot;.equalsIgnoreCase(value))</span>
<span class="fc" id="L1165">			return ActorStyle.AWESOME;</span>

<span class="pc bpc" id="L1167" title="1 of 2 branches missed.">		if (&quot;hollow&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L1168">			return ActorStyle.HOLLOW;</span>

<span class="fc" id="L1170">		return ActorStyle.STICKMAN;</span>
	}

	@Override
	public void setSvgSize(String origin, String sizeToUse) {
<span class="nc" id="L1175">		svgCharSizes.put(StringUtils.manageUnicodeNotationUplus(origin),</span>
<span class="nc" id="L1176">				StringUtils.manageUnicodeNotationUplus(sizeToUse));</span>
<span class="nc" id="L1177">	}</span>

	@Override
	public String transformStringForSizeHack(String s) {
<span class="pc bpc" id="L1181" title="1 of 2 branches missed.">		for (Entry&lt;String, String&gt; ent : svgCharSizes.entrySet())</span>
<span class="nc" id="L1182">			s = s.replace(ent.getKey(), ent.getValue());</span>

<span class="fc" id="L1184">		return s;</span>
	}

	@Override
	public LengthAdjust getlengthAdjust() {
<span class="fc" id="L1189">		final String value = getValue(&quot;lengthAdjust&quot;);</span>
<span class="pc bpc" id="L1190" title="1 of 2 branches missed.">		if (&quot;spacingAndGlyphs&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L1191">			return LengthAdjust.SPACING_AND_GLYPHS;</span>

<span class="pc bpc" id="L1193" title="1 of 2 branches missed.">		if (&quot;spacing&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L1194">			return LengthAdjust.SPACING;</span>

<span class="pc bpc" id="L1196" title="1 of 2 branches missed.">		if (&quot;none&quot;.equalsIgnoreCase(value))</span>
<span class="nc" id="L1197">			return LengthAdjust.NONE;</span>

<span class="fc" id="L1199">		return LengthAdjust.defaultValue();</span>
	}

	private double paramSameClassWidth;

	public void setParamSameClassWidth(double width) {
<span class="nc" id="L1205">		this.paramSameClassWidth = width;</span>

<span class="nc" id="L1207">	}</span>

	@Override
	public final double getParamSameClassWidth() {
<span class="fc" id="L1211">		return paramSameClassWidth;</span>
	}

	@Override
	public SheetBuilder sheet(FontConfiguration fontConfiguration, HorizontalAlignment horizontalAlignment,
			CreoleMode creoleMode) {
<span class="fc" id="L1217">		final FontConfiguration stereotype = fontConfiguration.forceFont(null, null);</span>
<span class="fc" id="L1218">		return sheet(fontConfiguration, horizontalAlignment, creoleMode, stereotype);</span>
	}

<span class="fc" id="L1221">	private final Map&lt;Object, CreoleParser&gt; cache = new HashMap&lt;&gt;();</span>

	@Override
	public SheetBuilder sheet(FontConfiguration fontConfiguration, HorizontalAlignment horizontalAlignment,
			CreoleMode creoleMode, FontConfiguration stereo) {
<span class="fc" id="L1226">		final Object key = Arrays.asList(horizontalAlignment, creoleMode, fontConfiguration, stereo);</span>
<span class="fc" id="L1227">		CreoleParser result = cache.get(key);</span>
<span class="fc bfc" id="L1228" title="All 2 branches covered.">		if (result == null) {</span>
<span class="fc" id="L1229">			result = new CreoleParser(fontConfiguration, horizontalAlignment, this, creoleMode, stereo);</span>
<span class="fc" id="L1230">			cache.put(key, result);</span>
		}
<span class="fc" id="L1232">		return result;</span>
	}

	@Override
	public Arrows arrows() {
<span class="pc bpc" id="L1237" title="1 of 2 branches missed.">		if (strictUmlStyle())</span>
<span class="nc" id="L1238">			return new ArrowsTriangle();</span>
<span class="fc" id="L1239">		return new ArrowsRegular();</span>
	}

	@Override
	public final Pragma getPragma() {
<span class="fc" id="L1244">		return pragma;</span>
	}

	@Override
	public ConfigurationStore&lt;OptionKey&gt; options() {
<span class="fc" id="L1249">		return option;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>