<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Json.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">plantuml</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.plantuml.json</a> &gt; <span class="el_source">Json.java</span></div><h1>Json.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright (c) 2016 EclipseSource.
 *
 * Distributed under MIT license
 * See https://github.com/ralfstx/minimal-json/blob/master/LICENSE
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 ******************************************************************************/
package net.sourceforge.plantuml.json;

import java.io.IOException;
import java.io.Reader;

/**
 * This class serves as the entry point to the minimal-json API.
 * &lt;p&gt;
 * To &lt;strong&gt;parse&lt;/strong&gt; a given JSON input, use the &lt;code&gt;parse()&lt;/code&gt;
 * methods like in this example:
 * &lt;/p&gt;
 * 
 * &lt;pre&gt;
 * JsonObject object = Json.parse(string).asObject();
 * &lt;/pre&gt;
 * &lt;p&gt;
 * To &lt;strong&gt;create&lt;/strong&gt; a JSON data structure to be serialized, use the
 * methods &lt;code&gt;value()&lt;/code&gt;, &lt;code&gt;array()&lt;/code&gt;, and
 * &lt;code&gt;object()&lt;/code&gt;. For example, the following snippet will produce the
 * JSON string &lt;em&gt;{&quot;foo&quot;: 23, &quot;bar&quot;: true}&lt;/em&gt;:
 * &lt;/p&gt;
 * 
 * &lt;pre&gt;
 * String string = Json.object().add(&quot;foo&quot;, 23).add(&quot;bar&quot;, true).toString();
 * &lt;/pre&gt;
 * &lt;p&gt;
 * To create a JSON array from a given Java array, you can use one of the
 * &lt;code&gt;array()&lt;/code&gt; methods with varargs parameters:
 * &lt;/p&gt;
 * 
 * &lt;pre&gt;
 * String[] names = ...
 * JsonArray array = Json.array(names);
 * &lt;/pre&gt;
 */
public final class Json {

	private Json() {
		// not meant to be instantiated
	}

	/**
	 * Represents the JSON literal &lt;code&gt;null&lt;/code&gt;.
	 */
<span class="fc" id="L69">	public static final JsonValue NULL = new JsonLiteral(&quot;null&quot;);</span>

	/**
	 * Represents the JSON literal &lt;code&gt;true&lt;/code&gt;.
	 */
<span class="fc" id="L74">	public static final JsonValue TRUE = new JsonLiteral(&quot;true&quot;);</span>

	/**
	 * Represents the JSON literal &lt;code&gt;false&lt;/code&gt;.
	 */
<span class="fc" id="L79">	public static final JsonValue FALSE = new JsonLiteral(&quot;false&quot;);</span>

	/**
	 * Returns a JsonValue instance that represents the given &lt;code&gt;int&lt;/code&gt;
	 * value.
	 *
	 * @param value the value to get a JSON representation for
	 * @return a JSON value that represents the given value
	 */
	public static JsonValue value(int value) {
<span class="fc" id="L89">		return new JsonNumber(Integer.toString(value, 10));</span>
	}

	/**
	 * Returns a JsonValue instance that represents the given &lt;code&gt;long&lt;/code&gt;
	 * value.
	 *
	 * @param value the value to get a JSON representation for
	 * @return a JSON value that represents the given value
	 */
	public static JsonValue value(long value) {
<span class="nc" id="L100">		return new JsonNumber(Long.toString(value, 10));</span>
	}

	/**
	 * Returns a JsonValue instance that represents the given &lt;code&gt;float&lt;/code&gt;
	 * value.
	 *
	 * @param value the value to get a JSON representation for
	 * @return a JSON value that represents the given value
	 */
	public static JsonValue value(float value) {
<span class="nc bnc" id="L111" title="All 4 branches missed.">		if (Float.isInfinite(value) || Float.isNaN(value)) {</span>
<span class="nc" id="L112">			throw new IllegalArgumentException(&quot;Infinite and NaN values not permitted in JSON&quot;);</span>
		}
<span class="nc" id="L114">		return new JsonNumber(cutOffPointZero(Float.toString(value)));</span>
	}

	/**
	 * Returns a JsonValue instance that represents the given &lt;code&gt;double&lt;/code&gt;
	 * value.
	 *
	 * @param value the value to get a JSON representation for
	 * @return a JSON value that represents the given value
	 */
	public static JsonValue value(double value) {
<span class="nc bnc" id="L125" title="All 4 branches missed.">		if (Double.isInfinite(value) || Double.isNaN(value)) {</span>
<span class="nc" id="L126">			throw new IllegalArgumentException(&quot;Infinite and NaN values not permitted in JSON&quot;);</span>
		}
<span class="nc" id="L128">		return new JsonNumber(cutOffPointZero(Double.toString(value)));</span>
	}

	/**
	 * Returns a JsonValue instance that represents the given string.
	 *
	 * @param string the string to get a JSON representation for
	 * @return a JSON value that represents the given string
	 */
	public static JsonValue value(String string) {
<span class="fc bfc" id="L138" title="All 2 branches covered.">		return string == null ? NULL : new JsonString(string);</span>
	}

	/**
	 * Returns a JsonValue instance that represents the given &lt;code&gt;boolean&lt;/code&gt;
	 * value.
	 *
	 * @param value the value to get a JSON representation for
	 * @return a JSON value that represents the given value
	 */
	public static JsonValue value(boolean value) {
<span class="nc bnc" id="L149" title="All 2 branches missed.">		return value ? TRUE : FALSE;</span>
	}

	/**
	 * Creates a new empty JsonArray. This is equivalent to creating a new JsonArray
	 * using the constructor.
	 *
	 * @return a new empty JSON array
	 */
	public static JsonArray array() {
<span class="nc" id="L159">		return new JsonArray();</span>
	}

	/**
	 * Creates a new JsonArray that contains the JSON representations of the given
	 * &lt;code&gt;int&lt;/code&gt; values.
	 *
	 * @param values the values to be included in the new JSON array
	 * @return a new JSON array that contains the given values
	 */
	public static JsonArray array(int... values) {
<span class="nc bnc" id="L170" title="All 2 branches missed.">		if (values == null) {</span>
<span class="nc" id="L171">			throw new NullPointerException(&quot;values is null&quot;);</span>
		}
<span class="nc" id="L173">		JsonArray array = new JsonArray();</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">		for (int value : values) {</span>
<span class="nc" id="L175">			array.add(value);</span>
		}
<span class="nc" id="L177">		return array;</span>
	}

	/**
	 * Creates a new JsonArray that contains the JSON representations of the given
	 * &lt;code&gt;long&lt;/code&gt; values.
	 *
	 * @param values the values to be included in the new JSON array
	 * @return a new JSON array that contains the given values
	 */
	public static JsonArray array(long... values) {
<span class="nc bnc" id="L188" title="All 2 branches missed.">		if (values == null) {</span>
<span class="nc" id="L189">			throw new NullPointerException(&quot;values is null&quot;);</span>
		}
<span class="nc" id="L191">		JsonArray array = new JsonArray();</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">		for (long value : values) {</span>
<span class="nc" id="L193">			array.add(value);</span>
		}
<span class="nc" id="L195">		return array;</span>
	}

	/**
	 * Creates a new JsonArray that contains the JSON representations of the given
	 * &lt;code&gt;float&lt;/code&gt; values.
	 *
	 * @param values the values to be included in the new JSON array
	 * @return a new JSON array that contains the given values
	 */
	public static JsonArray array(float... values) {
<span class="nc bnc" id="L206" title="All 2 branches missed.">		if (values == null) {</span>
<span class="nc" id="L207">			throw new NullPointerException(&quot;values is null&quot;);</span>
		}
<span class="nc" id="L209">		JsonArray array = new JsonArray();</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">		for (float value : values) {</span>
<span class="nc" id="L211">			array.add(value);</span>
		}
<span class="nc" id="L213">		return array;</span>
	}

	/**
	 * Creates a new JsonArray that contains the JSON representations of the given
	 * &lt;code&gt;double&lt;/code&gt; values.
	 *
	 * @param values the values to be included in the new JSON array
	 * @return a new JSON array that contains the given values
	 */
	public static JsonArray array(double... values) {
<span class="nc bnc" id="L224" title="All 2 branches missed.">		if (values == null) {</span>
<span class="nc" id="L225">			throw new NullPointerException(&quot;values is null&quot;);</span>
		}
<span class="nc" id="L227">		JsonArray array = new JsonArray();</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">		for (double value : values) {</span>
<span class="nc" id="L229">			array.add(value);</span>
		}
<span class="nc" id="L231">		return array;</span>
	}

	/**
	 * Creates a new JsonArray that contains the JSON representations of the given
	 * &lt;code&gt;boolean&lt;/code&gt; values.
	 *
	 * @param values the values to be included in the new JSON array
	 * @return a new JSON array that contains the given values
	 */
	public static JsonArray array(boolean... values) {
<span class="nc bnc" id="L242" title="All 2 branches missed.">		if (values == null) {</span>
<span class="nc" id="L243">			throw new NullPointerException(&quot;values is null&quot;);</span>
		}
<span class="nc" id="L245">		JsonArray array = new JsonArray();</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">		for (boolean value : values) {</span>
<span class="nc" id="L247">			array.add(value);</span>
		}
<span class="nc" id="L249">		return array;</span>
	}

	/**
	 * Creates a new JsonArray that contains the JSON representations of the given
	 * strings.
	 *
	 * @param strings the strings to be included in the new JSON array
	 * @return a new JSON array that contains the given strings
	 */
	public static JsonArray array(String... strings) {
<span class="nc bnc" id="L260" title="All 2 branches missed.">		if (strings == null) {</span>
<span class="nc" id="L261">			throw new NullPointerException(&quot;values is null&quot;);</span>
		}
<span class="nc" id="L263">		JsonArray array = new JsonArray();</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">		for (String value : strings) {</span>
<span class="nc" id="L265">			array.add(value);</span>
		}
<span class="nc" id="L267">		return array;</span>
	}

	/**
	 * Creates a new empty JsonObject. This is equivalent to creating a new
	 * JsonObject using the constructor.
	 *
	 * @return a new empty JSON object
	 */
	public static JsonObject object() {
<span class="fc" id="L277">		return new JsonObject();</span>
	}

	/**
	 * Parses the given input string as JSON. The input must contain a valid JSON
	 * value, optionally padded with whitespace.
	 *
	 * @param string the input string, must be valid JSON
	 * @return a value that represents the parsed JSON
	 * @throws ParseException if the input is not valid JSON
	 */
	public static JsonValue parse(String string) {
<span class="pc bpc" id="L289" title="1 of 2 branches missed.">		if (string == null) {</span>
<span class="nc" id="L290">			throw new NullPointerException(&quot;string is null&quot;);</span>
		}
<span class="fc" id="L292">		DefaultHandler handler = new DefaultHandler();</span>
<span class="fc" id="L293">		new JsonParser(handler).parse(string);</span>
<span class="fc" id="L294">		return handler.getValue();</span>
	}

	/**
	 * Reads the entire input from the given reader and parses it as JSON. The input
	 * must contain a valid JSON value, optionally padded with whitespace.
	 * &lt;p&gt;
	 * Characters are read in chunks into an input buffer. Hence, wrapping a reader
	 * in an additional &lt;code&gt;BufferedReader&lt;/code&gt; likely won't improve reading
	 * performance.
	 * &lt;/p&gt;
	 *
	 * @param reader the reader to read the JSON value from
	 * @return a value that represents the parsed JSON
	 * @throws IOException    if an I/O error occurs in the reader
	 * @throws ParseException if the input is not valid JSON
	 */
	public static JsonValue parse(Reader reader) throws IOException {
<span class="pc bpc" id="L312" title="1 of 2 branches missed.">		if (reader == null) {</span>
<span class="nc" id="L313">			throw new NullPointerException(&quot;reader is null&quot;);</span>
		}
<span class="fc" id="L315">		DefaultHandler handler = new DefaultHandler();</span>
<span class="fc" id="L316">		new JsonParser(handler).parse(reader);</span>
<span class="fc" id="L317">		return handler.getValue();</span>
	}

	private static String cutOffPointZero(String string) {
<span class="nc bnc" id="L321" title="All 2 branches missed.">		if (string.endsWith(&quot;.0&quot;)) {</span>
<span class="nc" id="L322">			return string.substring(0, string.length() - 2);</span>
		}
<span class="nc" id="L324">		return string;</span>
	}

<span class="fc" id="L327">	public static class DefaultHandler extends JsonHandler&lt;JsonArray, JsonObject&gt; {</span>

		protected JsonValue value;

		@Override
		public JsonArray startArray() {
<span class="fc" id="L333">			return new JsonArray();</span>
		}

		@Override
		public JsonObject startObject() {
<span class="fc" id="L338">			return new JsonObject();</span>
		}

		@Override
		public void endNull() {
<span class="fc" id="L343">			value = NULL;</span>
<span class="fc" id="L344">		}</span>

		@Override
		public void endBoolean(boolean bool) {
<span class="fc bfc" id="L348" title="All 2 branches covered.">			value = bool ? TRUE : FALSE;</span>
<span class="fc" id="L349">		}</span>

		@Override
		public void endString(String string) {
<span class="fc" id="L353">			value = new JsonString(string);</span>
<span class="fc" id="L354">		}</span>

		@Override
		public void endNumber(String string) {
<span class="fc" id="L358">			value = new JsonNumber(string);</span>
<span class="fc" id="L359">		}</span>

		@Override
		public void endArray(JsonArray array) {
<span class="fc" id="L363">			value = array;</span>
<span class="fc" id="L364">		}</span>

		@Override
		public void endObject(JsonObject object) {
<span class="fc" id="L368">			value = object;</span>
<span class="fc" id="L369">		}</span>

		@Override
		public void endArrayValue(JsonArray array) {
<span class="fc" id="L373">			array.add(value);</span>
<span class="fc" id="L374">		}</span>

		@Override
		public void endObjectValue(JsonObject object, String name) {
<span class="fc" id="L378">			object.add(name, value);</span>
<span class="fc" id="L379">		}</span>

		public JsonValue getValue() {
<span class="fc" id="L382">			return value;</span>
		}

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>