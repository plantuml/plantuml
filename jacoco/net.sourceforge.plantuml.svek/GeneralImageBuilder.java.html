<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GeneralImageBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">plantuml</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.plantuml.svek</a> &gt; <span class="el_source">GeneralImageBuilder.java</span></div><h1>GeneralImageBuilder.java</h1><pre class="source lang-java linenums">/* ========================================================================
 * PlantUML : a free UML diagram generator
 * ========================================================================
 *
 * (C) Copyright 2009-2024, Arnaud Roques
 *
 * Project Info:  https://plantuml.com
 * 
 * If you like this project or if you find it useful, you can support us at:
 * 
 * https://plantuml.com/patreon (only 1$ per month!)
 * https://plantuml.com/paypal
 * 
 * This file is part of PlantUML.
 *
 * PlantUML is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * PlantUML distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
 * License for more details.
 *
 * You should have received a copy of the GNU General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
 * USA.
 *
 *
 * Original Author:  Arnaud Roques
 * Contribution :  Hisashi Miyashita
 * Contribution :  Serge Wenger
 * 
 *
 */
package net.sourceforge.plantuml.svek;

import java.util.Collection;

import net.sourceforge.plantuml.abel.Entity;
import net.sourceforge.plantuml.abel.EntityPosition;
import net.sourceforge.plantuml.abel.LeafType;
import net.sourceforge.plantuml.abel.Link;
import net.sourceforge.plantuml.cli.GlobalConfig;
import net.sourceforge.plantuml.cucadiagram.PortionShower;
import net.sourceforge.plantuml.decoration.symbol.USymbolInterface;
import net.sourceforge.plantuml.descdiagram.EntityImageDesignedDomain;
import net.sourceforge.plantuml.descdiagram.EntityImageDomain;
import net.sourceforge.plantuml.descdiagram.EntityImageMachine;
import net.sourceforge.plantuml.descdiagram.EntityImageRequirement;
import net.sourceforge.plantuml.dot.GraphvizVersion;
import net.sourceforge.plantuml.dot.Neighborhood;
import net.sourceforge.plantuml.klimt.UStroke;
import net.sourceforge.plantuml.skin.LineParam;
import net.sourceforge.plantuml.stereo.Stereotype;
import net.sourceforge.plantuml.style.ISkinParam;
import net.sourceforge.plantuml.svek.image.EntityImageActivity;
import net.sourceforge.plantuml.svek.image.EntityImageArcCircle;
import net.sourceforge.plantuml.svek.image.EntityImageAssociation;
import net.sourceforge.plantuml.svek.image.EntityImageAssociationPoint;
import net.sourceforge.plantuml.svek.image.EntityImageBranch;
import net.sourceforge.plantuml.svek.image.EntityImageChenAttribute;
import net.sourceforge.plantuml.svek.image.EntityImageChenCircle;
import net.sourceforge.plantuml.svek.image.EntityImageChenEntity;
import net.sourceforge.plantuml.svek.image.EntityImageChenRelationship;
import net.sourceforge.plantuml.svek.image.EntityImageCircleEnd;
import net.sourceforge.plantuml.svek.image.EntityImageCircleStart;
import net.sourceforge.plantuml.svek.image.EntityImageClass;
import net.sourceforge.plantuml.svek.image.EntityImageDeepHistory;
import net.sourceforge.plantuml.svek.image.EntityImageDescription;
import net.sourceforge.plantuml.svek.image.EntityImageEmptyPackage;
import net.sourceforge.plantuml.svek.image.EntityImageGroup;
import net.sourceforge.plantuml.svek.image.EntityImageJson;
import net.sourceforge.plantuml.svek.image.EntityImageLollipopInterface;
import net.sourceforge.plantuml.svek.image.EntityImageLollipopInterfaceEye1;
import net.sourceforge.plantuml.svek.image.EntityImageLollipopInterfaceEye2;
import net.sourceforge.plantuml.svek.image.EntityImageMap;
import net.sourceforge.plantuml.svek.image.EntityImageNote;
import net.sourceforge.plantuml.svek.image.EntityImageObject;
import net.sourceforge.plantuml.svek.image.EntityImagePort;
import net.sourceforge.plantuml.svek.image.EntityImagePseudoState;
import net.sourceforge.plantuml.svek.image.EntityImageState;
import net.sourceforge.plantuml.svek.image.EntityImageState2;
import net.sourceforge.plantuml.svek.image.EntityImageStateBorder;
import net.sourceforge.plantuml.svek.image.EntityImageStateEmptyDescription;
import net.sourceforge.plantuml.svek.image.EntityImageSynchroBar;
import net.sourceforge.plantuml.svek.image.EntityImageTips;
import net.sourceforge.plantuml.svek.image.EntityImageTransitionLabel;
import net.sourceforge.plantuml.text.Guillemet;

<span class="nc" id="L93">public final class GeneralImageBuilder {</span>

	public static IEntityImage createEntityImageBlock(Entity leaf, boolean isHideEmptyDescriptionForState,
			PortionShower portionShower, Bibliotekon bibliotekon, GraphvizVersion graphvizVersion,
			Collection&lt;Link&gt; links) {
<span class="fc" id="L98">		final IEntityImage result = createEntityImageBlockInternal(leaf, isHideEmptyDescriptionForState, portionShower,</span>
				bibliotekon, graphvizVersion, links);
		// System.err.println(&quot;leaf &quot; + leaf + &quot; &quot; + result.getClass());
<span class="fc" id="L101">		return result;</span>
	}

	private static IEntityImage createEntityImageBlockInternal(Entity leaf, boolean isHideEmptyDescriptionForState,
			PortionShower portionShower, Bibliotekon bibliotekon, GraphvizVersion graphvizVersion,
			Collection&lt;Link&gt; links) {
<span class="pc bpc" id="L107" title="1 of 2 branches missed.">		if (leaf.isRemoved())</span>
<span class="nc" id="L108">			throw new IllegalStateException();</span>

<span class="fc bfc" id="L110" title="All 2 branches covered.">		if (leaf.getLeafType().isLikeClass()) {</span>
<span class="fc" id="L111">			final EntityImageClass entityImageClass = new EntityImageClass(leaf, portionShower);</span>
<span class="fc" id="L112">			final Neighborhood neighborhood = leaf.getNeighborhood();</span>
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">			if (neighborhood != null)</span>
<span class="nc" id="L114">				return new EntityImageProtected(entityImageClass, 20, neighborhood, bibliotekon);</span>

<span class="fc" id="L116">			return entityImageClass;</span>
		}
<span class="fc bfc" id="L118" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.NOTE)</span>
<span class="fc" id="L119">			return new EntityImageNote(leaf);</span>

<span class="fc bfc" id="L121" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.ACTIVITY)</span>
<span class="fc" id="L122">			return new EntityImageActivity(leaf, bibliotekon);</span>

<span class="fc bfc" id="L124" title="All 2 branches covered.">		if (/* (leaf.getLeafType() == LeafType.PORT) || */leaf.getLeafType() == LeafType.PORTIN</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">				|| leaf.getLeafType() == LeafType.PORTOUT) {</span>
<span class="fc" id="L126">			final Cluster parent = bibliotekon.getCluster(leaf.getParentContainer());</span>
<span class="fc" id="L127">			return new EntityImagePort(leaf, parent, bibliotekon);</span>
		}

<span class="fc bfc" id="L130" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.STATE) {</span>
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">			if (leaf.getEntityPosition() != EntityPosition.NORMAL) {</span>
<span class="nc" id="L132">				final Cluster stateParent = bibliotekon.getCluster(leaf.getParentContainer());</span>
<span class="nc" id="L133">				return new EntityImageStateBorder(leaf, stateParent, bibliotekon);</span>
			}
<span class="pc bpc" id="L135" title="3 of 4 branches missed.">			if (isHideEmptyDescriptionForState &amp;&amp; leaf.getBodier().getRawBody().size() == 0)</span>
<span class="nc" id="L136">				return new EntityImageStateEmptyDescription(leaf);</span>

<span class="pc bpc" id="L138" title="1 of 2 branches missed.">			if (leaf.getStereotype() != null</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">					&amp;&amp; &quot;&lt;&lt;sdlreceive&gt;&gt;&quot;.equals(leaf.getStereotype().getLabel(Guillemet.DOUBLE_COMPARATOR)))</span>
<span class="nc" id="L140">				return new EntityImageState2(leaf);</span>

<span class="fc" id="L142">			return new EntityImageState(leaf);</span>

		}
<span class="fc bfc" id="L145" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.CIRCLE_START)</span>
<span class="fc" id="L146">			return new EntityImageCircleStart(leaf);</span>

<span class="fc bfc" id="L148" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.CIRCLE_END)</span>
<span class="fc" id="L149">			return new EntityImageCircleEnd(leaf);</span>

<span class="pc bpc" id="L151" title="1 of 4 branches missed.">		if (leaf.getLeafType() == LeafType.BRANCH || leaf.getLeafType() == LeafType.STATE_CHOICE)</span>
<span class="fc" id="L152">			return new EntityImageBranch(leaf);</span>

<span class="pc bpc" id="L154" title="2 of 4 branches missed.">		if (leaf.getLeafType() == LeafType.LOLLIPOP_FULL || leaf.getLeafType() == LeafType.LOLLIPOP_HALF)</span>
<span class="nc" id="L155">			return new EntityImageLollipopInterface(leaf);</span>

<span class="pc bpc" id="L157" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.CIRCLE)</span>
<span class="nc" id="L158">			return new EntityImageDescription(leaf, portionShower, links, bibliotekon);</span>

<span class="fc bfc" id="L160" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.DESCRIPTION) {</span>
			if (GlobalConfig.USE_INTERFACE_EYE1 &amp;&amp; leaf.getUSymbol() instanceof USymbolInterface) {
				return new EntityImageLollipopInterfaceEye1(leaf, bibliotekon);
			} else if (GlobalConfig.USE_INTERFACE_EYE2 &amp;&amp; leaf.getUSymbol() instanceof USymbolInterface) {
				return new EntityImageLollipopInterfaceEye2(leaf, portionShower);
			} else {
<span class="fc" id="L166">				return new EntityImageDescription(leaf, portionShower, links, bibliotekon);</span>
			}
		}
<span class="pc bpc" id="L169" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.USECASE)</span>
<span class="nc" id="L170">			return new EntityImageDescription(leaf, portionShower, links, bibliotekon);</span>
			// return new EntityImageUseCase(leaf, portionShower);

<span class="pc bpc" id="L173" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.USECASE_BUSINESS)</span>
<span class="nc" id="L174">			return new EntityImageDescription(leaf, portionShower, links, bibliotekon);</span>
			// return new EntityImageUseCase(leaf, portionShower);

		// if (leaf.getEntityType() == LeafType.CIRCLE_INTERFACE) {
		// return new EntityImageCircleInterface(leaf, skinParam);
		// }
<span class="pc bpc" id="L180" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.OBJECT)</span>
<span class="nc" id="L181">			return new EntityImageObject(leaf, portionShower);</span>

<span class="pc bpc" id="L183" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.MAP)</span>
<span class="nc" id="L184">			return new EntityImageMap(leaf, portionShower);</span>

<span class="pc bpc" id="L186" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.JSON)</span>
<span class="nc" id="L187">			return new EntityImageJson(leaf, portionShower);</span>

<span class="pc bpc" id="L189" title="1 of 4 branches missed.">		if (leaf.getLeafType() == LeafType.SYNCHRO_BAR || leaf.getLeafType() == LeafType.STATE_FORK_JOIN)</span>
<span class="fc" id="L190">			return new EntityImageSynchroBar(leaf);</span>

<span class="pc bpc" id="L192" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.ARC_CIRCLE)</span>
<span class="nc" id="L193">			return new EntityImageArcCircle(leaf);</span>

<span class="pc bpc" id="L195" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.POINT_FOR_ASSOCIATION)</span>
<span class="nc" id="L196">			return new EntityImageAssociationPoint(leaf);</span>

<span class="pc bpc" id="L198" title="1 of 2 branches missed.">		if (leaf.isGroup())</span>
<span class="nc" id="L199">			return new EntityImageGroup(leaf);</span>

<span class="fc bfc" id="L201" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.EMPTY_PACKAGE) {</span>
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">			if (leaf.getUSymbol() != null)</span>
<span class="fc" id="L203">				return new EntityImageDescription(leaf, portionShower, links, bibliotekon);</span>

<span class="nc" id="L205">			return new EntityImageEmptyPackage(leaf, portionShower);</span>
		}
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.ASSOCIATION)</span>
<span class="nc" id="L208">			return new EntityImageAssociation(leaf);</span>

<span class="pc bpc" id="L210" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.PSEUDO_STATE)</span>
<span class="nc" id="L211">			return new EntityImagePseudoState(leaf);</span>

<span class="pc bpc" id="L213" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.STATE_TRANSITION_LABEL)</span>
<span class="nc" id="L214">			return new EntityImageTransitionLabel(leaf);</span>

<span class="pc bpc" id="L216" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.DEEP_HISTORY)</span>
<span class="nc" id="L217">			return new EntityImageDeepHistory(leaf);</span>

<span class="pc bpc" id="L219" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.TIPS)</span>
<span class="nc" id="L220">			return new EntityImageTips(leaf, bibliotekon);</span>

<span class="fc bfc" id="L222" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.CHEN_ENTITY)</span>
<span class="fc" id="L223">			return new EntityImageChenEntity(leaf);</span>

<span class="fc bfc" id="L225" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.CHEN_RELATIONSHIP)</span>
<span class="fc" id="L226">			return new EntityImageChenRelationship(leaf);</span>

<span class="fc bfc" id="L228" title="All 2 branches covered.">		if (leaf.getLeafType() == LeafType.CHEN_ATTRIBUTE)</span>
<span class="fc" id="L229">			return new EntityImageChenAttribute(leaf);</span>

<span class="pc bpc" id="L231" title="1 of 2 branches missed.">		if (leaf.getLeafType() == LeafType.CHEN_CIRCLE)</span>
<span class="fc" id="L232">			return new EntityImageChenCircle(leaf);</span>

		// TODO Clean
<span class="nc bnc" id="L235" title="All 4 branches missed.">		if (leaf.getLeafType() == LeafType.DOMAIN &amp;&amp; leaf.getStereotype() != null</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">				&amp;&amp; leaf.getStereotype().isMachineOrSpecification())</span>
<span class="nc" id="L237">			return new EntityImageMachine(leaf);</span>
<span class="nc bnc" id="L238" title="All 4 branches missed.">		else if (leaf.getLeafType() == LeafType.DOMAIN &amp;&amp; leaf.getStereotype() != null</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">				&amp;&amp; leaf.getStereotype().isDesignedOrSolved())</span>
<span class="nc" id="L240">			return new EntityImageDesignedDomain(leaf);</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">		else if (leaf.getLeafType() == LeafType.REQUIREMENT)</span>
<span class="nc" id="L242">			return new EntityImageRequirement(leaf);</span>
<span class="nc bnc" id="L243" title="All 4 branches missed.">		else if (leaf.getLeafType() == LeafType.DOMAIN &amp;&amp; leaf.getStereotype() != null</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">				&amp;&amp; leaf.getStereotype().isLexicalOrGiven())</span>
<span class="nc" id="L245">			return new EntityImageDomain(leaf, 'X');</span>
<span class="nc bnc" id="L246" title="All 4 branches missed.">		else if (leaf.getLeafType() == LeafType.DOMAIN &amp;&amp; leaf.getStereotype() != null</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">				&amp;&amp; leaf.getStereotype().isCausal())</span>
<span class="nc" id="L248">			return new EntityImageDomain(leaf, 'C');</span>
<span class="nc bnc" id="L249" title="All 4 branches missed.">		else if (leaf.getLeafType() == LeafType.DOMAIN &amp;&amp; leaf.getStereotype() != null</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">				&amp;&amp; leaf.getStereotype().isBiddableOrUncertain())</span>
<span class="nc" id="L251">			return new EntityImageDomain(leaf, 'B');</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">		else if (leaf.getLeafType() == LeafType.DOMAIN)</span>
<span class="nc" id="L253">			return new EntityImageDomain(leaf, 'P');</span>
		else
<span class="nc" id="L255">			throw new UnsupportedOperationException(leaf.getLeafType().toString());</span>
	}

	public static UStroke getForcedStroke(Stereotype stereotype, ISkinParam skinParam) {
<span class="nc" id="L259">		UStroke stroke = skinParam.getThickness(LineParam.packageBorder, stereotype);</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">		if (stroke == null)</span>
<span class="nc" id="L261">			stroke = UStroke.withThickness(1.5);</span>

<span class="nc" id="L263">		return stroke;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>