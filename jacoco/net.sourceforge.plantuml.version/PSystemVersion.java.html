<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PSystemVersion.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">plantuml</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.plantuml.version</a> &gt; <span class="el_source">PSystemVersion.java</span></div><h1>PSystemVersion.java</h1><pre class="source lang-java linenums">/* ========================================================================
 * PlantUML : a free UML diagram generator
 * ========================================================================
 *
 * (C) Copyright 2009-2024, Arnaud Roques
 *
 * Project Info:  https://plantuml.com
 * 
 * If you like this project or if you find it useful, you can support us at:
 * 
 * https://plantuml.com/patreon (only 1$ per month!)
 * https://plantuml.com/paypal
 * 
 * This file is part of PlantUML.
 *
 * PlantUML is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * PlantUML distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
 * License for more details.
 *
 * You should have received a copy of the GNU General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
 * USA.
 *
 *
 * Original Author:  Arnaud Roques
 *
 */
package net.sourceforge.plantuml.version;

import static net.sourceforge.plantuml.klimt.geom.GraphicPosition.BACKGROUND_CORNER_BOTTOM_RIGHT;

import java.awt.image.BufferedImage;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import net.sourceforge.plantuml.OptionFlags;
import net.sourceforge.plantuml.OptionPrint;
import net.sourceforge.plantuml.PlainStringsDiagram;
import net.sourceforge.plantuml.Run;
import net.sourceforge.plantuml.core.DiagramDescription;
import net.sourceforge.plantuml.core.UmlSource;
import net.sourceforge.plantuml.crash.ReportLog;
import net.sourceforge.plantuml.dot.GraphvizUtils;
import net.sourceforge.plantuml.log.Logme;
import net.sourceforge.plantuml.preproc.PreprocessingArtifact;
import net.sourceforge.plantuml.preproc.Stdlib;
import net.sourceforge.plantuml.preproc2.PreprocessorUtils;
import net.sourceforge.plantuml.security.SFile;
import net.sourceforge.plantuml.security.SImageIO;
import net.sourceforge.plantuml.security.SecurityProfile;
import net.sourceforge.plantuml.security.SecurityUtils;

public class PSystemVersion extends PlainStringsDiagram {

	PSystemVersion(UmlSource source, boolean withImage, List&lt;String&gt; args, PreprocessingArtifact preprocessing) {
<span class="fc" id="L66">		super(source, preprocessing);</span>
<span class="fc" id="L67">		this.strings.addAll(args);</span>
		try {
<span class="pc bpc" id="L69" title="1 of 2 branches missed.">			if (withImage) {</span>
<span class="fc" id="L70">				this.image = getPlantumlImage();</span>
<span class="fc" id="L71">				this.imagePosition = BACKGROUND_CORNER_BOTTOM_RIGHT;</span>
			}
<span class="nc" id="L73">		} catch (Exception e) {</span>
<span class="nc" id="L74">			e.printStackTrace();</span>
<span class="fc" id="L75">		}</span>
<span class="fc" id="L76">	}</span>

	private PSystemVersion(UmlSource source, List&lt;String&gt; args, BufferedImage image, PreprocessingArtifact preprocessing) {
<span class="nc" id="L79">		super(source, preprocessing);</span>
<span class="nc" id="L80">		this.strings.addAll(args);</span>
<span class="nc" id="L81">		this.image = image;</span>
<span class="nc" id="L82">		this.imagePosition = BACKGROUND_CORNER_BOTTOM_RIGHT;</span>
<span class="nc" id="L83">	}</span>

	public static BufferedImage getPlantumlImage() {
<span class="fc" id="L86">		return getImage(&quot;logo.png&quot;);</span>
	}

	public static BufferedImage getTime01() {
<span class="nc" id="L90">		return getImage(&quot;time01.png&quot;);</span>
	}

	public static BufferedImage getTime15() {
<span class="nc" id="L94">		return getImage(&quot;time15.png&quot;);</span>
	}

	public static BufferedImage getCharlieImage() {
<span class="nc" id="L98">		return getImage(&quot;charlie.png&quot;);</span>
	}

	public static BufferedImage getPlantumlSmallIcon() {
<span class="nc" id="L102">		return getImage(&quot;favicon.png&quot;);</span>
	}

	// ::comment when __CORE__
	public static BufferedImage getArecibo() {
<span class="nc" id="L107">		return getImage(&quot;arecibo.png&quot;);</span>
	}

	public static BufferedImage getDotc() {
<span class="nc" id="L111">		return getImage(&quot;dotc.png&quot;);</span>
	}

	public static BufferedImage getDotd() {
<span class="nc" id="L115">		return getImage(&quot;dotd.png&quot;);</span>
	}

	public static BufferedImage getApple2Image() {
<span class="nc" id="L119">		return getImageWebp(&quot;apple2.png&quot;);</span>
	}
	// ::done

	private static BufferedImage getImage(final String name) {
		try {
<span class="fc" id="L125">			final InputStream is = PSystemVersion.class.getResourceAsStream(name);</span>
<span class="fc" id="L126">			final BufferedImage image = SImageIO.read(is);</span>
<span class="fc" id="L127">			is.close();</span>
<span class="fc" id="L128">			return image;</span>
<span class="nc" id="L129">		} catch (IOException e) {</span>
<span class="nc" id="L130">			Logme.error(e);</span>
		}
<span class="nc" id="L132">		return new BufferedImage(10, 10, BufferedImage.TYPE_INT_ARGB);</span>
	}

	// ::comment when __CORE__
	private static BufferedImage getImageWebp(final String name) {
<span class="nc" id="L137">		try (InputStream is = PSystemVersion.class.getResourceAsStream(name)) {</span>
<span class="nc" id="L138">			return SFile.getBufferedImageFromWebpButHeader(is);</span>
<span class="nc" id="L139">		} catch (IOException e) {</span>
<span class="nc" id="L140">			Logme.error(e);</span>
		}
<span class="nc" id="L142">		return new BufferedImage(10, 10, BufferedImage.TYPE_INT_ARGB);</span>
	}
	// ::done

	private static BufferedImage transparentIcon;

	public static BufferedImage getPlantumlSmallIcon2() {
<span class="nc bnc" id="L149" title="All 2 branches missed.">		if (transparentIcon != null) {</span>
<span class="nc" id="L150">			return transparentIcon;</span>
		}
<span class="nc" id="L152">		final BufferedImage ico = getPlantumlSmallIcon();</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">		if (ico == null) {</span>
<span class="nc" id="L154">			return new BufferedImage(10, 10, BufferedImage.TYPE_INT_ARGB);</span>
		}
<span class="nc" id="L156">		transparentIcon = new BufferedImage(ico.getWidth(), ico.getHeight(), BufferedImage.TYPE_INT_ARGB_PRE);</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">		for (int i = 0; i &lt; ico.getWidth(); i++) {</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">			for (int j = 0; j &lt; ico.getHeight(); j++) {</span>
<span class="nc" id="L159">				final int col = ico.getRGB(i, j);</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">				if (col != ico.getRGB(0, 0)) {</span>
<span class="nc" id="L161">					transparentIcon.setRGB(i, j, col);</span>
				}
			}
		}
<span class="nc" id="L165">		return transparentIcon;</span>
	}

	public static PSystemVersion createShowVersion2(UmlSource source, PreprocessingArtifact preprocessing) {
<span class="nc" id="L169">		final ReportLog strings = new ReportLog();</span>
<span class="nc" id="L170">		strings.add(&quot;&lt;b&gt;PlantUML version &quot; + Version.versionString() + &quot;&lt;/b&gt; (&quot; + Version.compileTimeString() + &quot;)&quot;);</span>
<span class="nc" id="L171">		strings.add(&quot;(&quot; + License.getCurrent() + &quot; source distribution)&quot;);</span>
		// :: uncomment when __CORE__
//		strings.add(&quot; &quot;);
//		strings.add(&quot;Compiled with CheerpJ 2.3&quot;);
//		strings.add(&quot;Powered by CheerpJ, a Leaning Technologies Java tool&quot;);
		// :: done
		// :: comment when __CORE__
<span class="nc" id="L178">		strings.checkOldVersionWarning();</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">		if (SecurityUtils.getSecurityProfile() == SecurityProfile.UNSECURE) {</span>
<span class="nc" id="L180">			strings.add(&quot;Loaded from &quot; + Version.getJarPath());</span>

<span class="nc bnc" id="L182" title="All 2 branches missed.">			if (OptionFlags.getInstance().isWord()) {</span>
<span class="nc" id="L183">				strings.add(&quot;Word Mode&quot;);</span>
<span class="nc" id="L184">				strings.add(&quot;Command Line: &quot; + Run.getCommandLine());</span>
<span class="nc" id="L185">				strings.add(&quot;Current Dir: &quot; + new SFile(&quot;.&quot;).getAbsolutePath());</span>
<span class="nc" id="L186">				strings.add(&quot;plantuml.include.path: &quot; + PreprocessorUtils.getenv(SecurityUtils.PATHS_INCLUDES));</span>
			}
		}
<span class="nc" id="L189">		strings.add(&quot; &quot;);</span>

<span class="nc" id="L191">		GraphvizUtils.addDotStatus(strings, true);</span>
<span class="nc" id="L192">		strings.add(&quot; &quot;);</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">		for (String name : OptionPrint.interestingProperties())</span>
<span class="nc" id="L194">			strings.add(name);</span>

<span class="nc bnc" id="L196" title="All 2 branches missed.">		for (String v : OptionPrint.interestingValues())</span>
<span class="nc" id="L197">			strings.add(v);</span>

		// ::done

<span class="nc" id="L201">		return new PSystemVersion(source, true, strings.asList(), preprocessing);</span>
	}

	// :: comment when __CORE__
	public static PSystemVersion createStdLib(UmlSource source, PreprocessingArtifact preprocessing) {
<span class="fc" id="L206">		final List&lt;String&gt; strings = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L207">		Stdlib.addInfoVersion(strings, true);</span>
<span class="fc" id="L208">		strings.add(&quot; &quot;);</span>

<span class="fc" id="L210">		return new PSystemVersion(source, true, strings, preprocessing);</span>
	}
	// ::done

	public static PSystemVersion createShowAuthors2(UmlSource source, PreprocessingArtifact preprocessing) {
		// Duplicate in OptionPrint
<span class="nc" id="L216">		final List&lt;String&gt; strings = getAuthorsStrings(true);</span>
<span class="nc" id="L217">		return new PSystemVersion(source, true, strings, preprocessing);</span>
	}

	public static List&lt;String&gt; getAuthorsStrings(boolean withTag) {
<span class="nc" id="L221">		final List&lt;String&gt; strings = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L222">		add(strings, &quot;&lt;b&gt;PlantUML version &quot; + Version.versionString() + &quot;&lt;/b&gt; (&quot; + Version.compileTimeString() + &quot;)&quot;,</span>
				withTag);
<span class="nc" id="L224">		add(strings, &quot;(&quot; + License.getCurrent() + &quot; source distribution)&quot;, withTag);</span>
<span class="nc" id="L225">		add(strings, &quot; &quot;, withTag);</span>
<span class="nc" id="L226">		add(strings, &quot;&lt;u&gt;Original idea&lt;/u&gt;: Arnaud Roques&quot;, withTag);</span>
<span class="nc" id="L227">		add(strings, &quot;&lt;u&gt;Word Macro&lt;/u&gt;: Alain Bertucat &amp; Matthieu Sabatier&quot;, withTag);</span>
<span class="nc" id="L228">		add(strings, &quot;&lt;u&gt;Word Add-in&lt;/u&gt;: Adriaan van den Brand&quot;, withTag);</span>
<span class="nc" id="L229">		add(strings, &quot;&lt;u&gt;J2V8 &amp; viz.js integration&lt;/u&gt;: Andreas Studer&quot;, withTag);</span>
<span class="nc" id="L230">		add(strings, &quot;&lt;u&gt;Official Eclipse Plugin&lt;/u&gt;: Hallvard Tr\u00E6tteberg&quot;, withTag);</span>
<span class="nc" id="L231">		add(strings, &quot;&lt;u&gt;Original Eclipse Plugin&lt;/u&gt;: Claude Durif &amp; Anne Pecoil&quot;, withTag);</span>
<span class="nc" id="L232">		add(strings, &quot;&lt;u&gt;Servlet &amp; XWiki&lt;/u&gt;: Maxime Sinclair&quot;, withTag);</span>
<span class="nc" id="L233">		add(strings, &quot;&lt;u&gt;Docker&lt;/u&gt;: David Ducatel&quot;, withTag);</span>
<span class="nc" id="L234">		add(strings, &quot;&lt;u&gt;AWS lib&lt;/u&gt;: Chris Passarello&quot;, withTag);</span>
<span class="nc" id="L235">		add(strings, &quot;&lt;u&gt;Stdlib Icons&lt;/u&gt;: tupadr3&quot;, withTag);</span>
<span class="nc" id="L236">		add(strings, &quot;&lt;u&gt;Site design&lt;/u&gt;: Raphael Cotisson&quot;, withTag);</span>
<span class="nc" id="L237">		add(strings, &quot;&lt;u&gt;Logo&lt;/u&gt;: Benjamin Croizet&quot;, withTag);</span>
<span class="nc" id="L238">		add(strings, &quot;&lt;u&gt;Web Assembly&lt;/u&gt;: Sakir Temel&quot;, withTag);</span>

<span class="nc" id="L240">		add(strings, &quot; &quot;, withTag);</span>
<span class="nc" id="L241">		add(strings, &quot;https://plantuml.com&quot;, withTag);</span>
<span class="nc" id="L242">		add(strings, &quot; &quot;, withTag);</span>
<span class="nc" id="L243">		return strings;</span>
	}

	private static void add(List&lt;String&gt; result, String s, boolean withTag) {
<span class="nc bnc" id="L247" title="All 2 branches missed.">		if (withTag == false)</span>
<span class="nc" id="L248">			s = s.replaceAll(&quot;\\&lt;/?\\w+\\&gt;&quot;, &quot;&quot;);</span>

<span class="nc" id="L250">		result.add(s);</span>

<span class="nc" id="L252">	}</span>

	// ::comment when __CORE__
	public static PSystemVersion createTestDot(UmlSource source, PreprocessingArtifact preprocessing) throws IOException {
<span class="nc" id="L256">		final ReportLog strings = new ReportLog();</span>
<span class="nc" id="L257">		strings.add(Version.fullDescription());</span>
<span class="nc" id="L258">		GraphvizUtils.addDotStatus(strings, true);</span>
<span class="nc" id="L259">		return new PSystemVersion(source, false, strings.asList(), preprocessing);</span>
	}
	// ::done

//	public static PSystemVersion createDumpStackTrace() throws IOException {
//		final List&lt;String&gt; strings = new ArrayList&lt;&gt;();
//		final Throwable creationPoint = new Throwable();
//		creationPoint.fillInStackTrace();
//		for (StackTraceElement ste : creationPoint.getStackTrace()) {
//			strings.add(ste.toString());
//		}
//		return new PSystemVersion(false, strings);
//	}

	// ::comment when __CORE__
	public static PSystemVersion createKeyDistributor(UmlSource source, PreprocessingArtifact preprocessing) throws IOException {
<span class="nc" id="L275">		final LicenseInfo license = LicenseInfo.retrieveDistributor();</span>
<span class="nc" id="L276">		BufferedImage im = null;</span>
<span class="nc" id="L277">		final List&lt;String&gt; strings = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (license == null) {</span>
<span class="nc" id="L279">			strings.add(&quot;No license found&quot;);</span>
		} else {
<span class="nc" id="L281">			strings.add(license.getOwner());</span>
<span class="nc" id="L282">			strings.add(license.getContext());</span>
<span class="nc" id="L283">			strings.add(license.getGenerationDate().toString());</span>
<span class="nc" id="L284">			strings.add(license.getExpirationDate().toString());</span>
<span class="nc" id="L285">			im = LicenseInfo.retrieveDistributorImage(license);</span>
		}
<span class="nc" id="L287">		return new PSystemVersion(source, strings, im, preprocessing);</span>
	}
	// ::done

//	public static PSystemVersion createPath(UmlSource source) throws IOException {
//		final List&lt;String&gt; strings = new ArrayList&lt;&gt;();
//		strings.add(&quot;&lt;u&gt;Current Dir&lt;/u&gt;: &quot; + new SFile(&quot;.&quot;).getPrintablePath());
//		strings.add(&quot; &quot;);
//		strings.add(&quot;&lt;u&gt;Default path&lt;/u&gt;:&quot;);
//		for (SFile f : ImportedFiles.createImportedFiles(null).getPath()) {
//			strings.add(f.getPrintablePath());
//		}
//		return new PSystemVersion(source, true, strings);
//	}

	public DiagramDescription getDescription() {
<span class="fc" id="L303">		return new DiagramDescription(&quot;(Version)&quot;);</span>
	}

	public List&lt;String&gt; getLines() {
<span class="nc" id="L307">		return Collections.unmodifiableList(strings);</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>