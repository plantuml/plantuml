<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DrawableSetInitializer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">plantuml</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.plantuml.sequencediagram.graphic</a> &gt; <span class="el_source">DrawableSetInitializer.java</span></div><h1>DrawableSetInitializer.java</h1><pre class="source lang-java linenums">/* ========================================================================
 * PlantUML : a free UML diagram generator
 * ========================================================================
 *
 * (C) Copyright 2009-2024, Arnaud Roques
 *
 * Project Info:  https://plantuml.com
 * 
 * If you like this project or if you find it useful, you can support us at:
 * 
 * https://plantuml.com/patreon (only 1$ per month!)
 * https://plantuml.com/paypal
 * 
 * This file is part of PlantUML.
 *
 * PlantUML is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * PlantUML distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
 * License for more details.
 *
 * You should have received a copy of the GNU General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
 * USA.
 *
 *
 * Original Author:  Arnaud Roques
 * 
 *
 */
package net.sourceforge.plantuml.sequencediagram.graphic;

import java.util.ArrayList;
import java.util.List;
import java.util.Objects;
import java.util.concurrent.atomic.AtomicInteger;

import net.sourceforge.plantuml.cli.GlobalConfig;
import net.sourceforge.plantuml.klimt.creole.Display;
import net.sourceforge.plantuml.klimt.font.StringBounder;
import net.sourceforge.plantuml.klimt.geom.XDimension2D;
import net.sourceforge.plantuml.sequencediagram.AbstractMessage;
import net.sourceforge.plantuml.sequencediagram.Delay;
import net.sourceforge.plantuml.sequencediagram.Divider;
import net.sourceforge.plantuml.sequencediagram.Doll;
import net.sourceforge.plantuml.sequencediagram.Event;
import net.sourceforge.plantuml.sequencediagram.GroupingLeaf;
import net.sourceforge.plantuml.sequencediagram.GroupingStart;
import net.sourceforge.plantuml.sequencediagram.GroupingType;
import net.sourceforge.plantuml.sequencediagram.HSpace;
import net.sourceforge.plantuml.sequencediagram.InGroupableList;
import net.sourceforge.plantuml.sequencediagram.LifeEvent;
import net.sourceforge.plantuml.sequencediagram.LifeEventType;
import net.sourceforge.plantuml.sequencediagram.Message;
import net.sourceforge.plantuml.sequencediagram.MessageExo;
import net.sourceforge.plantuml.sequencediagram.Newpage;
import net.sourceforge.plantuml.sequencediagram.Note;
import net.sourceforge.plantuml.sequencediagram.NotePosition;
import net.sourceforge.plantuml.sequencediagram.Notes;
import net.sourceforge.plantuml.sequencediagram.Participant;
import net.sourceforge.plantuml.sequencediagram.ParticipantEnglober;
import net.sourceforge.plantuml.sequencediagram.ParticipantType;
import net.sourceforge.plantuml.sequencediagram.Reference;
import net.sourceforge.plantuml.skin.Component;
import net.sourceforge.plantuml.skin.ComponentType;
import net.sourceforge.plantuml.skin.PaddingParam;
import net.sourceforge.plantuml.skin.SkinParamBackcolored;
import net.sourceforge.plantuml.skin.SkinParamBackcoloredReference;
import net.sourceforge.plantuml.skin.rose.Rose;
import net.sourceforge.plantuml.style.ISkinParam;
import net.sourceforge.plantuml.style.Style;

class DrawableSetInitializer {

	// private ComponentType defaultLineType;
	private final DrawableSet drawableSet;
	private final boolean showTail;

<span class="fc" id="L84">	private double freeX = 0;</span>
<span class="fc" id="L85">	private Frontier freeY2 = null;</span>
<span class="fc" id="L86">	private Frontier lastFreeY2 = null;</span>

	// private final double autonewpage;

	private ConstraintSet constraintSet;

	public DrawableSetInitializer(Rose skin, ISkinParam skinParam, boolean showTail, /* double autonewpage, */
<span class="fc" id="L93">			AtomicInteger counter) {</span>
<span class="fc" id="L94">		this.drawableSet = new DrawableSet(skin, skinParam, counter);</span>
<span class="fc" id="L95">		this.showTail = showTail;</span>
		// this.autonewpage = autonewpage;

<span class="fc" id="L98">	}</span>

	private ParticipantRange getFullParticipantRange() {
<span class="fc" id="L101">		return new ParticipantRange(0, drawableSet.getAllParticipants().size());</span>
	}

	private ParticipantRange getParticipantRange(Event ev) {
<span class="fc" id="L105">		return getFullParticipantRange();</span>
	}

	// private int getParticipantRangeIndex(Participant participant) {
	// int r = 0;
	// for (Participant p : drawableSet.getAllParticipants()) {
	// r++;
	// if (p == participant) {
	// return r;
	// }
	// }
	// throw new IllegalArgumentException();
	// }

	public DrawableSet createDrawableSet(StringBounder stringBounder) {
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">		if (freeY2 != null)</span>
<span class="nc" id="L121">			throw new IllegalStateException();</span>

//		this.defaultLineType = useContinueLineBecauseOfDelay() ? ComponentType.CONTINUE_LINE
//				: ComponentType.PARTICIPANT_LINE;

<span class="fc bfc" id="L126" title="All 2 branches covered.">		for (Participant p : drawableSet.getAllParticipants())</span>
<span class="fc" id="L127">			prepareParticipant(stringBounder, p);</span>

<span class="fc" id="L129">		this.freeY2 = new FrontierStackImpl(drawableSet.getHeadHeight(stringBounder),</span>
<span class="fc" id="L130">				drawableSet.getAllParticipants().size());</span>

<span class="fc" id="L132">		this.lastFreeY2 = this.freeY2;</span>

<span class="fc" id="L134">		drawableSet.setTopStartingY(this.freeY2.getFreeY(getFullParticipantRange()));</span>

<span class="fc bfc" id="L136" title="All 2 branches covered.">		for (Participant p : drawableSet.getAllParticipants()) {</span>
<span class="fc" id="L137">			final LivingParticipantBox living = drawableSet.getLivingParticipantBox(p);</span>
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">			for (int i = 0; i &lt; p.getInitialLife(); i++)</span>
<span class="nc" id="L139">				living.getLifeLine().addSegmentVariation(LifeSegmentVariation.LARGER,</span>
<span class="nc" id="L140">						freeY2.getFreeY(getFullParticipantRange()), p.getLiveSpecificBackColors(i), null);</span>

<span class="fc" id="L142">		}</span>

<span class="fc" id="L144">		final List&lt;ParticipantBox&gt; col = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L145" title="All 2 branches covered.">		for (LivingParticipantBox livingParticipantBox : drawableSet.getAllLivingParticipantBox())</span>
<span class="fc" id="L146">			col.add(livingParticipantBox.getParticipantBox());</span>

<span class="fc" id="L148">		constraintSet = new ConstraintSet(col, freeX);</span>

<span class="fc bfc" id="L150" title="All 2 branches covered.">		for (Event ev : new ArrayList&lt;&gt;(drawableSet.getAllEvents())) {</span>
<span class="fc" id="L151">			final ParticipantRange range = getParticipantRange(ev);</span>
<span class="fc" id="L152">			final double diffY = freeY2.getFreeY(range) - lastFreeY2.getFreeY(range);</span>
			// final double diffY = freeY2.diff(lastFreeY2);

//			if (autonewpage &gt; 0 &amp;&amp; diffY &gt; 0 &amp;&amp; diffY + getTotalHeight(0, stringBounder) &gt; autonewpage)
//				// We create a temporary Newpage object used internally by the
//				// getPreferredHeight() method,
//				// which is hardcoded in ComponentRoseNewpage. The title is irrelevant in this
//				// context.
//				prepareNewpageSpecial(stringBounder,
//						new Newpage(null, drawableSet.getSkinParam().getCurrentStyleBuilder()), ev, range);

<span class="pc bpc" id="L163" title="1 of 2 branches missed.">			if (ev instanceof MessageExo)</span>
<span class="nc" id="L164">				prepareMessageExo(stringBounder, (MessageExo) ev, range);</span>
<span class="fc bfc" id="L165" title="All 2 branches covered.">			else if (ev instanceof Message)</span>
<span class="fc" id="L166">				prepareMessage(stringBounder, (Message) ev, range);</span>
<span class="pc bpc" id="L167" title="1 of 2 branches missed.">			else if (ev instanceof Note)</span>
<span class="nc" id="L168">				prepareNote(stringBounder, (Note) ev, range);</span>
<span class="pc bpc" id="L169" title="1 of 2 branches missed.">			else if (ev instanceof Notes)</span>
<span class="nc" id="L170">				prepareNotes(stringBounder, (Notes) ev, range);</span>
<span class="fc bfc" id="L171" title="All 2 branches covered.">			else if (ev instanceof LifeEvent)</span>
<span class="fc" id="L172">				prepareLiveEvent(stringBounder, (LifeEvent) ev, range);</span>
<span class="fc bfc" id="L173" title="All 2 branches covered.">			else if (ev instanceof GroupingLeaf)</span>
<span class="fc" id="L174">				prepareGroupingLeaf(stringBounder, (GroupingLeaf) ev, range);</span>
<span class="fc bfc" id="L175" title="All 2 branches covered.">			else if (ev instanceof GroupingStart)</span>
<span class="fc" id="L176">				prepareGroupingStart(stringBounder, (GroupingStart) ev, range);</span>
<span class="pc bpc" id="L177" title="1 of 2 branches missed.">			else if (ev instanceof Newpage)</span>
<span class="fc" id="L178">				prepareNewpage(stringBounder, (Newpage) ev, range);</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">			else if (ev instanceof Divider)</span>
<span class="nc" id="L180">				prepareDivider(stringBounder, (Divider) ev, range);</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">			else if (ev instanceof HSpace)</span>
<span class="nc" id="L182">				prepareHSpace(stringBounder, (HSpace) ev, range);</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">			else if (ev instanceof Delay)</span>
<span class="nc" id="L184">				prepareDelay(stringBounder, (Delay) ev, col, range);</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">			else if (ev instanceof Reference)</span>
<span class="nc" id="L186">				prepareReference(stringBounder, (Reference) ev, range);</span>
			else
<span class="nc" id="L188">				throw new IllegalStateException();</span>

<span class="fc" id="L190">		}</span>

<span class="fc" id="L192">		takeParticipantEngloberPadding(stringBounder);</span>
<span class="fc" id="L193">		constraintSet.takeConstraintIntoAccount(stringBounder);</span>
<span class="fc" id="L194">		takeParticipantEngloberTitleWidth(stringBounder);</span>

<span class="fc" id="L196">		prepareMissingSpace(stringBounder);</span>

<span class="fc" id="L198">		drawableSet.setDimension(</span>
<span class="fc" id="L199">				new XDimension2D(freeX, getTotalHeight(freeY2.getFreeY(getFullParticipantRange()), stringBounder)));</span>
<span class="fc" id="L200">		return drawableSet;</span>
	}

	private void takeParticipantEngloberPadding(StringBounder stringBounder) {
<span class="fc" id="L204">		final double padding = drawableSet.getSkinParam().getPadding(PaddingParam.BOX);</span>
<span class="fc bfc" id="L205" title="All 2 branches covered.">		if (padding == 0)</span>
<span class="fc" id="L206">			return;</span>

<span class="pc bpc" id="L208" title="1 of 2 branches missed.">		for (Doll pe : drawableSet.getExistingParticipantEnglober(stringBounder)) {</span>
<span class="nc" id="L209">			final ParticipantBox first = drawableSet.getLivingParticipantBox(pe.getFirst2TOBEPRIVATE())</span>
<span class="nc" id="L210">					.getParticipantBox();</span>
<span class="nc" id="L211">			final ParticipantBox last = drawableSet.getLivingParticipantBox(pe.getLast2TOBEPRIVATE())</span>
<span class="nc" id="L212">					.getParticipantBox();</span>
<span class="nc" id="L213">			constraintSet.pushToLeftParticipantBox(padding, first, true);</span>
<span class="nc" id="L214">			constraintSet.pushToLeftParticipantBox(padding, last, false);</span>
<span class="nc" id="L215">		}</span>
<span class="fc" id="L216">	}</span>

	private void takeParticipantEngloberTitleWidth(StringBounder stringBounder) {
<span class="pc bpc" id="L219" title="1 of 2 branches missed.">		for (Doll doll : drawableSet.getExistingParticipantEnglober(stringBounder)) {</span>
<span class="nc" id="L220">			final double preferredWidth = drawableSet.getEngloberPreferedWidth(stringBounder, doll);</span>
<span class="nc" id="L221">			final ParticipantBox first = drawableSet.getLivingParticipantBox(doll.getFirst2TOBEPRIVATE())</span>
<span class="nc" id="L222">					.getParticipantBox();</span>
<span class="nc" id="L223">			final ParticipantBox last = drawableSet.getLivingParticipantBox(doll.getLast2TOBEPRIVATE())</span>
<span class="nc" id="L224">					.getParticipantBox();</span>
<span class="nc" id="L225">			final double x1 = drawableSet.getX1(doll);</span>
<span class="nc" id="L226">			final double x2 = drawableSet.getX2(stringBounder, doll);</span>
<span class="nc" id="L227">			final double missing = preferredWidth - (x2 - x1);</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">			if (missing &gt; 0) {</span>
<span class="nc" id="L229">				constraintSet.pushToLeftParticipantBox(missing / 2, first, true);</span>
<span class="nc" id="L230">				constraintSet.pushToLeftParticipantBox(missing / 2, last, false);</span>
			}
<span class="nc" id="L232">		}</span>
<span class="fc" id="L233">	}</span>

	private double getTotalHeight(double y, StringBounder stringBounder) {
<span class="fc" id="L236">		final double signature = 0;</span>
<span class="fc" id="L237">		return y + drawableSet.getTailHeight(stringBounder, showTail) + signature;</span>
	}

	public double getYposition(StringBounder stringBounder, Newpage newpage) {
<span class="fc" id="L241">		final GraphicalNewpage graphicalNewpage = (GraphicalNewpage) drawableSet</span>
<span class="fc" id="L242">				.getEvent(Objects.requireNonNull(newpage));</span>
<span class="fc" id="L243">		return graphicalNewpage.getStartingY();</span>
	}

	private void prepareMissingSpace(StringBounder stringBounder) {
<span class="fc" id="L247">		freeX = constraintSet.getMaxX();</span>

<span class="fc" id="L249">		double missingSpace1 = 0;</span>
<span class="fc" id="L250">		double missingSpace2 = 0;</span>

<span class="fc bfc" id="L252" title="All 2 branches covered.">		for (GraphicalElement ev : drawableSet.getAllGraphicalElements()) {</span>
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">			if (ev instanceof GraphicalDelayText) {</span>
<span class="nc" id="L254">				final double missing = ev.getPreferredWidth(stringBounder) - freeX;</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">				if (missing &gt; 0) {</span>
<span class="nc" id="L256">					missingSpace1 = Math.max(missingSpace1, missing / 2);</span>
<span class="nc" id="L257">					missingSpace2 = Math.max(missingSpace2, missing / 2);</span>
				}
				continue;
			}
<span class="fc" id="L261">			final double startX = ev.getStartingX(stringBounder);</span>
<span class="fc" id="L262">			final double delta1 = -startX;</span>
<span class="fc bfc" id="L263" title="All 2 branches covered.">			if (delta1 &gt; missingSpace1)</span>
<span class="fc" id="L264">				missingSpace1 = delta1;</span>

<span class="fc bfc" id="L266" title="All 2 branches covered.">			if (ev instanceof Arrow) {</span>
<span class="fc" id="L267">				final Arrow a = (Arrow) ev;</span>
<span class="fc" id="L268">				a.setMaxX(freeX);</span>
			}
<span class="fc" id="L270">			double width = ev.getPreferredWidth(stringBounder);</span>
<span class="fc bfc" id="L271" title="All 2 branches covered.">			if (ev instanceof Arrow) {</span>
<span class="fc" id="L272">				final Arrow a = (Arrow) ev;</span>
<span class="fc bfc" id="L273" title="All 2 branches covered.">				if (width &lt; a.getActualWidth(stringBounder))</span>
<span class="fc" id="L274">					width = a.getActualWidth(stringBounder);</span>

			}
<span class="fc bfc" id="L277" title="All 2 branches covered.">			if (ev instanceof GroupingGraphicalElementHeader) {</span>
<span class="fc" id="L278">				final GroupingGraphicalElementHeader gh = (GroupingGraphicalElementHeader) ev;</span>
<span class="pc bpc" id="L279" title="1 of 2 branches missed.">				if (width &lt; gh.getActualWidth(stringBounder))</span>
<span class="fc" id="L280">					width = gh.getActualWidth(stringBounder);</span>

			}
<span class="fc" id="L283">			final double endX = startX + width;</span>
<span class="fc" id="L284">			final double delta2 = endX - freeX;</span>
<span class="fc bfc" id="L285" title="All 2 branches covered.">			if (delta2 &gt; missingSpace2)</span>
<span class="fc" id="L286">				missingSpace2 = delta2;</span>
<span class="fc" id="L287">		}</span>

<span class="fc bfc" id="L289" title="All 2 branches covered.">		if (missingSpace1 &gt; 0)</span>
<span class="fc" id="L290">			constraintSet.pushToLeft(missingSpace1);</span>

<span class="fc" id="L292">		freeX = constraintSet.getMaxX() + missingSpace2;</span>
<span class="fc" id="L293">	}</span>

	private void prepareNewpage(StringBounder stringBounder, Newpage newpage, ParticipantRange range) {
<span class="fc" id="L296">		final GraphicalNewpage graphicalNewpage = new GraphicalNewpage(freeY2.getFreeY(range),</span>
<span class="fc" id="L297">				drawableSet.getSkin().createComponentNewPage(newpage.getUsedStyles(), drawableSet.getSkinParam()));</span>
<span class="fc" id="L298">		this.lastFreeY2 = freeY2;</span>
<span class="fc" id="L299">		freeY2 = freeY2.add(graphicalNewpage.getPreferredHeight(stringBounder), range);</span>
<span class="fc" id="L300">		drawableSet.addEvent(newpage, graphicalNewpage);</span>
<span class="fc" id="L301">	}</span>

	private void prepareNewpageSpecial(StringBounder stringBounder, Newpage newpage, Event justBefore,
			ParticipantRange range) {
<span class="nc" id="L305">		final GraphicalNewpage graphicalNewpage = new GraphicalNewpage(freeY2.getFreeY(range),</span>
<span class="nc" id="L306">				drawableSet.getSkin().createComponentNewPage(newpage.getUsedStyles(), drawableSet.getSkinParam()));</span>
<span class="nc" id="L307">		this.lastFreeY2 = freeY2;</span>
<span class="nc" id="L308">		freeY2 = freeY2.add(graphicalNewpage.getPreferredHeight(stringBounder), range);</span>
<span class="nc" id="L309">		drawableSet.addEvent(newpage, graphicalNewpage, justBefore);</span>
<span class="nc" id="L310">	}</span>

	private void prepareDivider(StringBounder stringBounder, Divider divider, ParticipantRange range) {
<span class="nc" id="L313">		final GraphicalDivider graphicalDivider = new GraphicalDivider(freeY2.getFreeY(range),</span>
<span class="nc" id="L314">				drawableSet.getSkin().createComponent(divider.getUsedStyles(), ComponentType.DIVIDER, null,</span>
<span class="nc" id="L315">						drawableSet.getSkinParam(), divider.getText()));</span>
<span class="nc" id="L316">		freeY2 = freeY2.add(graphicalDivider.getPreferredHeight(stringBounder), range);</span>
<span class="nc" id="L317">		drawableSet.addEvent(divider, graphicalDivider);</span>
<span class="nc" id="L318">	}</span>

	private void prepareHSpace(StringBounder stringBounder, HSpace hspace, ParticipantRange range) {
<span class="nc" id="L321">		final GraphicalHSpace graphicalHSpace = new GraphicalHSpace(freeY2.getFreeY(range), hspace.getPixel());</span>
<span class="nc" id="L322">		freeY2 = freeY2.add(graphicalHSpace.getPreferredHeight(stringBounder), range);</span>
<span class="nc" id="L323">		drawableSet.addEvent(hspace, graphicalHSpace);</span>
<span class="nc" id="L324">	}</span>

	private void prepareDelay(StringBounder stringBounder, Delay delay, List&lt;ParticipantBox&gt; participants,
			ParticipantRange range) {
<span class="nc" id="L328">		final Component compText = drawableSet.getSkin().createComponent(delay.getUsedStyles(),</span>
<span class="nc" id="L329">				ComponentType.DELAY_TEXT, null, drawableSet.getSkinParam(), delay.getText());</span>
<span class="nc" id="L330">		final ParticipantBox first = participants.get(0);</span>
<span class="nc" id="L331">		final ParticipantBox last = participants.get(participants.size() - 1);</span>
<span class="nc" id="L332">		final GraphicalDelayText graphicalDivider = new GraphicalDelayText(freeY2.getFreeY(range), compText, first,</span>
				last);
<span class="nc bnc" id="L334" title="All 2 branches missed.">		for (ParticipantBox p : participants)</span>
<span class="nc" id="L335">			p.addDelay(graphicalDivider);</span>

<span class="nc" id="L337">		freeY2 = freeY2.add(graphicalDivider.getPreferredHeight(stringBounder), range);</span>
<span class="nc" id="L338">		drawableSet.addEvent(delay, graphicalDivider);</span>
<span class="nc" id="L339">	}</span>

<span class="fc" id="L341">	final private InGroupablesStack inGroupableStack = new InGroupablesStack();</span>

	private void prepareGroupingStart(StringBounder stringBounder, GroupingStart start, ParticipantRange range) {
<span class="pc bpc" id="L344" title="1 of 2 branches missed.">		if (start.getType().isStart() == false)</span>
<span class="nc" id="L345">			throw new IllegalStateException();</span>

<span class="fc" id="L347">		final ISkinParam skinParam = new SkinParamBackcolored(drawableSet.getSkinParam(), start.getBackColorElement(),</span>
<span class="fc" id="L348">				start.getBackColorGeneral());</span>

<span class="fc" id="L350">		final Component comp = drawableSet.getSkin().createComponent(null, ComponentType.GROUPING_SPACE, null,</span>
<span class="fc" id="L351">				skinParam, Display.create(start.getComment()));</span>
<span class="fc" id="L352">		final double preferredHeight = comp.getPreferredHeight(stringBounder);</span>
<span class="fc" id="L353">		freeY2 = freeY2.add(preferredHeight, range);</span>

<span class="pc bpc" id="L355" title="1 of 2 branches missed.">		final Display strings = start.getTitle().equals(&quot;group&quot;) ? Display.create(start.getComment())</span>
<span class="pc" id="L356">				: Display.create(start.getTitle(), start.getComment());</span>
<span class="fc" id="L357">		final Component header = drawableSet.getSkin().createComponent(start.getUsedStyles(),</span>
				ComponentType.GROUPING_HEADER_LEGACY, null, skinParam, strings);
<span class="fc" id="L359">		final ParticipantBox veryfirst = drawableSet.getVeryfirst();</span>
<span class="fc" id="L360">		final InGroupableList inGroupableList = new InGroupableList(veryfirst, start, freeY2.getFreeY(range));</span>
<span class="fc" id="L361">		inGroupableStack.addList(inGroupableList);</span>

<span class="fc" id="L363">		final GraphicalElement element = new GroupingGraphicalElementHeader(freeY2.getFreeY(range), header,</span>
<span class="fc" id="L364">				inGroupableList, start.isParallel());</span>
<span class="fc" id="L365">		inGroupableList.setMinWidth(element.getPreferredWidth(stringBounder));</span>
<span class="fc" id="L366">		freeY2 = freeY2.add(element.getPreferredHeight(stringBounder), range);</span>
<span class="fc" id="L367">		drawableSet.addEvent(start, element);</span>
<span class="pc bpc" id="L368" title="1 of 2 branches missed.">		if (start.isParallel())</span>
<span class="nc" id="L369">			freeY2 = ((FrontierStack) freeY2).openBar();</span>

<span class="fc" id="L371">	}</span>

	private void prepareGroupingLeaf(StringBounder stringBounder, final GroupingLeaf m, ParticipantRange range) {
		final GraphicalElement element;
<span class="fc" id="L375">		final ISkinParam skinParam = new SkinParamBackcolored(drawableSet.getSkinParam(), null,</span>
<span class="fc" id="L376">				m.getBackColorGeneral());</span>
<span class="pc bpc" id="L377" title="1 of 2 branches missed.">		if (m.getType() == GroupingType.ELSE) {</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">			if (m.isParallel())</span>
<span class="nc" id="L379">				freeY2 = ((FrontierStack) freeY2).restore();</span>

<span class="nc" id="L381">			final Component compElse = drawableSet.getSkin().createComponent(m.getUsedStyles(),</span>
<span class="nc" id="L382">					ComponentType.GROUPING_ELSE_LEGACY, null, skinParam, Display.create(m.getComment()));</span>
<span class="nc" id="L383">			final Lazy lazy = new Lazy() {</span>
				public double getNow() {
<span class="nc" id="L385">					final GraphicalElement after = drawableSet.getEvent(m.getJustAfter());</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">					if (after == null)</span>
<span class="nc" id="L387">						return 0;</span>

<span class="nc" id="L389">					return after.getStartingY();</span>
				}
			};
<span class="nc" id="L392">			element = new GroupingGraphicalElementElse(freeY2.getFreeY(range), compElse,</span>
<span class="nc" id="L393">					inGroupableStack.getTopGroupingStructure(), m.isParallel(), lazy);</span>
<span class="nc" id="L394">			final double preferredHeight = element.getPreferredHeight(stringBounder);</span>
<span class="nc" id="L395">			freeY2 = freeY2.add(preferredHeight, range);</span>
			// MODIF42
<span class="nc" id="L397">			inGroupableStack.addElement((GroupingGraphicalElementElse) element);</span>
<span class="pc bpc" id="L398" title="1 of 2 branches missed.">		} else if (m.getType() == GroupingType.END) {</span>
<span class="fc" id="L399">			final List&lt;Component&gt; notes = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L400" title="1 of 2 branches missed.">			for (Note noteOnMessage : m.getNoteOnMessages()) {</span>
<span class="nc" id="L401">				final ISkinParam sk = noteOnMessage.getSkinParamBackcolored(drawableSet.getSkinParam());</span>
<span class="nc" id="L402">				final Component note = drawableSet.getSkin().createComponentNote(noteOnMessage.getUsedStyles(),</span>
<span class="nc" id="L403">						noteOnMessage.getNoteStyle().getNoteComponentType(), sk, noteOnMessage.getDisplay(),</span>
<span class="nc" id="L404">						noteOnMessage.getColors());</span>
<span class="nc" id="L405">				notes.add(note);</span>
<span class="nc" id="L406">			}</span>
<span class="pc bpc" id="L407" title="1 of 2 branches missed.">			if (m.isParallel())</span>
<span class="nc" id="L408">				freeY2 = ((FrontierStack) freeY2).closeBar();</span>

<span class="fc" id="L410">			final GroupingGraphicalElementHeader groupingHeaderStart = (GroupingGraphicalElementHeader) drawableSet</span>
<span class="fc" id="L411">					.getEvent(m.getGroupingStart());</span>
<span class="pc bpc" id="L412" title="1 of 2 branches missed.">			if (groupingHeaderStart != null) {</span>
<span class="fc" id="L413">				groupingHeaderStart.setEndY(freeY2.getFreeY(range));</span>
<span class="fc" id="L414">				groupingHeaderStart.addNotes(stringBounder, notes);</span>
			}
<span class="fc" id="L416">			element = new GroupingGraphicalElementTail(freeY2.getFreeY(range),</span>
<span class="fc" id="L417">					inGroupableStack.getTopGroupingStructure(), m.isParallel());</span>
<span class="fc" id="L418">			final Component comp = drawableSet.getSkin().createComponent(null, ComponentType.GROUPING_SPACE, null,</span>
<span class="fc" id="L419">					skinParam, Display.create(m.getComment()));</span>
<span class="fc" id="L420">			final double preferredHeight = comp.getPreferredHeight(stringBounder);</span>
<span class="fc" id="L421">			freeY2 = freeY2.add(preferredHeight, range);</span>
<span class="fc" id="L422">			inGroupableStack.pop();</span>
<span class="fc" id="L423">		} else</span>
<span class="nc" id="L424">			throw new IllegalStateException();</span>

<span class="fc" id="L426">		drawableSet.addEvent(m, element);</span>

<span class="fc" id="L428">	}</span>

	private void prepareNote(StringBounder stringBounder, Note n, ParticipantRange range) {
<span class="nc" id="L431">		final NoteBox noteBox = createNoteBox(stringBounder, n, range);</span>
<span class="nc" id="L432">		inGroupableStack.addElement(noteBox);</span>

<span class="nc" id="L434">		drawableSet.addEvent(n, noteBox);</span>
<span class="nc" id="L435">		freeY2 = freeY2.add(noteBox.getPreferredHeight(stringBounder), range);</span>
<span class="nc" id="L436">	}</span>

	private NoteBox createNoteBox(StringBounder stringBounder, Note n, ParticipantRange range) {
<span class="nc" id="L439">		LivingParticipantBox p1 = drawableSet.getLivingParticipantBox(n.getParticipant());</span>
		LivingParticipantBox p2;
<span class="nc bnc" id="L441" title="All 2 branches missed.">		if (n.getParticipant2() == null)</span>
<span class="nc" id="L442">			p2 = null;</span>
		else {
<span class="nc" id="L444">			p2 = drawableSet.getLivingParticipantBox(n.getParticipant2());</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">			if (p1.getParticipantBox().getCenterX(stringBounder) &gt; p2.getParticipantBox().getCenterX(stringBounder)) {</span>
<span class="nc" id="L446">				final LivingParticipantBox tmp = p1;</span>
<span class="nc" id="L447">				p1 = p2;</span>
<span class="nc" id="L448">				p2 = tmp;</span>
			}
		}
<span class="nc" id="L451">		final ISkinParam skinParam = n.getSkinParamBackcolored(drawableSet.getSkinParam());</span>
<span class="nc" id="L452">		final ComponentType type = n.getNoteStyle().getNoteComponentType();</span>
<span class="nc bnc" id="L453" title="All 4 branches missed.">		if (p1 == null &amp;&amp; p2 == null)</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">			for (LivingParticipantBox p : drawableSet.getAllLivingParticipantBox()) {</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">				if (p1 == null)</span>
<span class="nc" id="L456">					p1 = p;</span>

<span class="nc" id="L458">				p2 = p;</span>
<span class="nc" id="L459">			}</span>

<span class="nc" id="L461">		final Component component = drawableSet.getSkin().createComponentNote(n.getUsedStyles(), type, skinParam,</span>
<span class="nc" id="L462">				n.getDisplay(), n.getColors(), n.getPosition());</span>
<span class="nc" id="L463">		final NoteBox noteBox = new NoteBox(freeY2.getFreeY(range), component, p1, p2, n.getPosition(), n.getUrl());</span>
<span class="nc" id="L464">		return noteBox;</span>
	}

	private void prepareNotes(StringBounder stringBounder, Notes notes, ParticipantRange range) {
<span class="nc" id="L468">		final NotesBoxes notesBoxes = new NotesBoxes(freeY2.getFreeY(range));</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">		for (Note n : notes) {</span>
<span class="nc" id="L470">			final NoteBox noteBox = createNoteBox(stringBounder, n, range);</span>
<span class="nc" id="L471">			final ParticipantBox p1 = drawableSet.getLivingParticipantBox(n.getParticipant()).getParticipantBox();</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">			final ParticipantBox p2 = n.getParticipant2() == null ? null</span>
<span class="nc" id="L473">					: drawableSet.getLivingParticipantBox(n.getParticipant2()).getParticipantBox();</span>
<span class="nc" id="L474">			notesBoxes.add(noteBox, p1, p2);</span>
<span class="nc" id="L475">		}</span>
<span class="nc" id="L476">		notesBoxes.ensureConstraints(stringBounder, constraintSet);</span>
<span class="nc" id="L477">		inGroupableStack.addElement(notesBoxes);</span>

<span class="nc" id="L479">		drawableSet.addEvent(notes, notesBoxes);</span>
<span class="nc" id="L480">		freeY2 = freeY2.add(notesBoxes.getPreferredHeight(stringBounder), range);</span>
<span class="nc" id="L481">	}</span>

	private void prepareLiveEvent(StringBounder stringBounder, LifeEvent lifeEvent, ParticipantRange range) {
<span class="fc" id="L484">		final double y = freeY2.getFreeY(range);</span>
<span class="fc" id="L485">		final AbstractMessage message = lifeEvent.getMessage();</span>
<span class="fc bfc" id="L486" title="All 2 branches covered.">		if (lifeEvent.getType() == LifeEventType.ACTIVATE) {</span>
<span class="fc" id="L487">			double pos = 0;</span>
<span class="pc bpc" id="L488" title="1 of 2 branches missed.">			if (message != null) {</span>
<span class="fc" id="L489">				int delta1 = 0;</span>
<span class="pc bpc" id="L490" title="1 of 2 branches missed.">				if (message.isCreate())</span>
<span class="nc" id="L491">					delta1 += 10;</span>
<span class="fc bfc" id="L492" title="All 2 branches covered.">				else if (GlobalConfig.STRICT_SELFMESSAGE_POSITION &amp;&amp; message.isSelfMessage())</span>
<span class="fc" id="L493">					delta1 += 8;</span>

<span class="fc" id="L495">				pos = message.getPosYstartLevel() + delta1;</span>
			}
<span class="fc" id="L497">			final LifeLine line1 = drawableSet.getLivingParticipantBox(lifeEvent.getParticipant()).getLifeLine();</span>
<span class="fc" id="L498">			line1.addSegmentVariation(LifeSegmentVariation.LARGER, pos, lifeEvent.getSpecificColors(),</span>
<span class="pc bpc" id="L499" title="1 of 2 branches missed.">					message == null ? null : message.getStyleBuilder());</span>
<span class="pc bpc" id="L500" title="1 of 4 branches missed.">		} else if (lifeEvent.getType() == LifeEventType.DESTROY || lifeEvent.getType() == LifeEventType.DEACTIVATE) {</span>
<span class="fc" id="L501">			double delta = 0;</span>
<span class="pc bpc" id="L502" title="1 of 4 branches missed.">			if (GlobalConfig.STRICT_SELFMESSAGE_POSITION &amp;&amp; message != null &amp;&amp; message.isSelfMessage())</span>
<span class="fc" id="L503">				delta += 7;</span>

<span class="fc" id="L505">			final Participant p = lifeEvent.getParticipant();</span>
<span class="fc" id="L506">			final LifeLine line = drawableSet.getLivingParticipantBox(p).getLifeLine();</span>
<span class="fc" id="L507">			double pos2 = y;</span>
<span class="pc bpc" id="L508" title="1 of 2 branches missed.">			if (message != null)</span>
<span class="fc" id="L509">				pos2 = message.getPosYendLevel() - delta;</span>

<span class="fc" id="L511">			line.addSegmentVariation(LifeSegmentVariation.SMALLER, pos2, lifeEvent.getSpecificColors(),</span>
<span class="pc bpc" id="L512" title="1 of 2 branches missed.">					message == null ? null : message.getStyleBuilder());</span>
		}

<span class="fc bfc" id="L515" title="All 2 branches covered.">		if (lifeEvent.getType() == LifeEventType.DESTROY) {</span>
<span class="fc" id="L516">			final Style[] style = lifeEvent.getUsedStyle();</span>
<span class="fc" id="L517">			final Component comp = drawableSet.getSkin().createComponent(style, ComponentType.DESTROY, null,</span>
<span class="fc" id="L518">					drawableSet.getSkinParam(), null);</span>
<span class="fc" id="L519">			final double delta = comp.getPreferredHeight(stringBounder) / 2;</span>
<span class="fc" id="L520">			final LivingParticipantBox livingParticipantBox = drawableSet</span>
<span class="fc" id="L521">					.getLivingParticipantBox(lifeEvent.getParticipant());</span>
<span class="fc" id="L522">			double pos2 = y;</span>
<span class="pc bpc" id="L523" title="1 of 2 branches missed.">			if (message == null) {</span>
<span class="nc" id="L524">				pos2 = y;</span>
<span class="nc" id="L525">				freeY2 = freeY2.add(comp.getPreferredHeight(stringBounder), range);</span>
			} else
<span class="fc" id="L527">				pos2 = message.getPosYendLevel() - delta;</span>

<span class="fc" id="L529">			final LifeDestroy destroy = new LifeDestroy(pos2, livingParticipantBox.getParticipantBox(), comp);</span>
<span class="fc" id="L530">			drawableSet.addEvent(lifeEvent, destroy);</span>
<span class="fc" id="L531">		} else</span>
<span class="fc" id="L532">			drawableSet.addEvent(lifeEvent, new GraphicalElementLiveEvent(y));</span>

<span class="fc" id="L534">	}</span>

	private void prepareMessageExo(StringBounder stringBounder, MessageExo m, ParticipantRange range) {
<span class="nc" id="L537">		final Step1MessageExo step1Message = new Step1MessageExo(range, stringBounder, m, drawableSet, freeY2);</span>
<span class="nc" id="L538">		freeY2 = step1Message.prepareMessage(constraintSet, inGroupableStack);</span>
<span class="nc" id="L539">	}</span>

	private void prepareMessage(StringBounder stringBounder, Message m, ParticipantRange range) {
<span class="fc" id="L542">		final Step1Message step1Message = new Step1Message(range, stringBounder, m, drawableSet, freeY2);</span>
<span class="fc" id="L543">		freeY2 = step1Message.prepareMessage(constraintSet, inGroupableStack);</span>
<span class="fc" id="L544">	}</span>

	private void prepareReference(StringBounder stringBounder, Reference reference, ParticipantRange range) {
<span class="nc" id="L547">		final LivingParticipantBox p1 = drawableSet</span>
<span class="nc" id="L548">				.getLivingParticipantBox(drawableSet.getFirst(reference.getParticipant()));</span>
<span class="nc" id="L549">		final LivingParticipantBox p2 = drawableSet</span>
<span class="nc" id="L550">				.getLivingParticipantBox(drawableSet.getLast(reference.getParticipant()));</span>
<span class="nc" id="L551">		final ISkinParam skinParam = new SkinParamBackcoloredReference(drawableSet.getSkinParam(),</span>
<span class="nc" id="L552">				reference.getBackColorElement(), reference.getBackColorGeneral());</span>

<span class="nc" id="L554">		Display strings = Display.empty();</span>
<span class="nc" id="L555">		strings = strings.add(&quot;ref&quot;);</span>
<span class="nc" id="L556">		strings = strings.addAll(reference.getStrings());</span>

<span class="nc" id="L558">		Component noteLeft = null;</span>
<span class="nc" id="L559">		Component noteRight = null;</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">		for (Note noteOnMessage : reference.getNoteOnMessages()) {</span>
<span class="nc" id="L561">			final ISkinParam skinParam2 = noteOnMessage.getSkinParamBackcolored(drawableSet.getSkinParam());</span>
<span class="nc" id="L562">			final Component note = drawableSet.getSkin().createComponentNote(noteOnMessage.getUsedStyles(),</span>
<span class="nc" id="L563">					noteOnMessage.getNoteStyle().getNoteComponentType(), skinParam2, noteOnMessage.getDisplay(),</span>
<span class="nc" id="L564">					noteOnMessage.getColors());</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">			if (noteOnMessage.getPosition() == NotePosition.RIGHT)</span>
<span class="nc" id="L566">				noteRight = note;</span>
			else
<span class="nc" id="L568">				noteLeft = note;</span>
<span class="nc" id="L569">		}</span>

<span class="nc" id="L571">		final Component comp = drawableSet.getSkin().createComponent(reference.getUsedStyles(), ComponentType.REFERENCE,</span>
				null, skinParam, strings);
<span class="nc" id="L573">		final GraphicalReference graphicalReference = new GraphicalReference(freeY2.getFreeY(range), comp, p1, p2,</span>
<span class="nc" id="L574">				reference.getUrl(), noteLeft, noteRight);</span>

<span class="nc" id="L576">		final ParticipantBox pbox1 = p1.getParticipantBox();</span>
<span class="nc" id="L577">		final ParticipantBox pbox2 = p2.getParticipantBox();</span>
<span class="nc" id="L578">		final double width = graphicalReference.getPreferredWidth(stringBounder)</span>
<span class="nc" id="L579">				- pbox1.getPreferredWidth(stringBounder) / 2 - pbox2.getPreferredWidth(stringBounder) / 2;</span>

		final Constraint constraint;
<span class="nc bnc" id="L582" title="All 2 branches missed.">		if (p1 == p2)</span>
<span class="nc" id="L583">			constraint = constraintSet.getConstraintAfter(pbox1);</span>
		else
<span class="nc" id="L585">			constraint = constraintSet.getConstraint(pbox1, pbox2);</span>

<span class="nc" id="L587">		constraint.ensureValue(width);</span>

<span class="nc" id="L589">		inGroupableStack.addElement(graphicalReference);</span>
<span class="nc" id="L590">		inGroupableStack.addElement(p1);</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">		if (p1 != p2)</span>
<span class="nc" id="L592">			inGroupableStack.addElement(p2);</span>

<span class="nc" id="L594">		freeY2 = freeY2.add(graphicalReference.getPreferredHeight(stringBounder), range);</span>
<span class="nc" id="L595">		drawableSet.addEvent(reference, graphicalReference);</span>
<span class="nc" id="L596">	}</span>

	private void prepareParticipant(StringBounder stringBounder, Participant p) {
		final ComponentType headType;
		final ComponentType tailType;
<span class="fc bfc" id="L601" title="All 2 branches covered.">		if (p.getType() == ParticipantType.PARTICIPANT) {</span>
<span class="fc" id="L602">			headType = ComponentType.PARTICIPANT_HEAD;</span>
<span class="fc" id="L603">			tailType = ComponentType.PARTICIPANT_TAIL;</span>
<span class="pc bpc" id="L604" title="1 of 2 branches missed.">		} else if (p.getType() == ParticipantType.ACTOR) {</span>
<span class="fc" id="L605">			headType = ComponentType.ACTOR_HEAD;</span>
<span class="fc" id="L606">			tailType = ComponentType.ACTOR_TAIL;</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">		} else if (p.getType() == ParticipantType.BOUNDARY) {</span>
<span class="nc" id="L608">			headType = ComponentType.BOUNDARY_HEAD;</span>
<span class="nc" id="L609">			tailType = ComponentType.BOUNDARY_TAIL;</span>
<span class="nc bnc" id="L610" title="All 2 branches missed.">		} else if (p.getType() == ParticipantType.CONTROL) {</span>
<span class="nc" id="L611">			headType = ComponentType.CONTROL_HEAD;</span>
<span class="nc" id="L612">			tailType = ComponentType.CONTROL_TAIL;</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">		} else if (p.getType() == ParticipantType.ENTITY) {</span>
<span class="nc" id="L614">			headType = ComponentType.ENTITY_HEAD;</span>
<span class="nc" id="L615">			tailType = ComponentType.ENTITY_TAIL;</span>
<span class="nc bnc" id="L616" title="All 2 branches missed.">		} else if (p.getType() == ParticipantType.QUEUE) {</span>
<span class="nc" id="L617">			headType = ComponentType.QUEUE_HEAD;</span>
<span class="nc" id="L618">			tailType = ComponentType.QUEUE_TAIL;</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">		} else if (p.getType() == ParticipantType.DATABASE) {</span>
<span class="nc" id="L620">			headType = ComponentType.DATABASE_HEAD;</span>
<span class="nc" id="L621">			tailType = ComponentType.DATABASE_TAIL;</span>
<span class="nc bnc" id="L622" title="All 2 branches missed.">		} else if (p.getType() == ParticipantType.COLLECTIONS) {</span>
<span class="nc" id="L623">			headType = ComponentType.COLLECTIONS_HEAD;</span>
<span class="nc" id="L624">			tailType = ComponentType.COLLECTIONS_TAIL;</span>
		} else {
<span class="nc" id="L626">			throw new IllegalArgumentException();</span>
		}

<span class="fc" id="L629">		final ISkinParam skinParam = drawableSet.getSkinParam();</span>
<span class="fc" id="L630">		final Display participantDisplay = p.getDisplay(skinParam.forceSequenceParticipantUnderlined());</span>
<span class="fc" id="L631">		final Component head = drawableSet.getSkin().createComponentParticipant(p, headType, null, skinParam,</span>
				participantDisplay);
<span class="fc" id="L633">		final Component tail = drawableSet.getSkin().createComponentParticipant(p, tailType, null, skinParam,</span>
				participantDisplay);
<span class="fc" id="L635">		final Style style = ComponentType.PARTICIPANT_LINE.getStyleSignature().withTOBECHANGED(p.getStereotype())</span>
<span class="fc" id="L636">				.getMergedStyle(skinParam.getCurrentStyleBuilder());</span>
<span class="fc" id="L637">		final Component line = drawableSet.getSkin().createComponent(new Style[] { style },</span>
<span class="fc" id="L638">				ComponentType.PARTICIPANT_LINE, null, drawableSet.getSkinParam(), participantDisplay);</span>
<span class="fc" id="L639">		final Style styleDelay = ComponentType.DELAY_LINE.getStyleSignature().withTOBECHANGED(p.getStereotype())</span>
<span class="fc" id="L640">				.getMergedStyle(skinParam.getCurrentStyleBuilder());</span>
<span class="fc" id="L641">		final Component delayLine = drawableSet.getSkin().createComponent(new Style[] { styleDelay },</span>
<span class="fc" id="L642">				ComponentType.DELAY_LINE, null, drawableSet.getSkinParam(), participantDisplay);</span>
<span class="fc" id="L643">		final ParticipantBox box = new ParticipantBox(skinParam.getPragma(), p.getLocation(), head, line, tail,</span>
<span class="pc bpc" id="L644" title="1 of 2 branches missed.">				delayLine, this.freeX, skinParam.maxAsciiMessageLength() &gt; 0 ? 1 : 5, p);</span>

<span class="fc" id="L646">		final Style activationBoxStyle = ComponentType.ACTIVATION_BOX_CLOSE_CLOSE.getStyleSignature()</span>
<span class="fc" id="L647">				.getMergedStyle(drawableSet.getSkinParam().getCurrentStyleBuilder());</span>

<span class="fc" id="L649">		final Component comp = drawableSet.getSkin().createComponent(new Style[] { activationBoxStyle },</span>
<span class="fc" id="L650">				ComponentType.ACTIVATION_BOX_CLOSE_CLOSE, null, drawableSet.getSkinParam(), participantDisplay);</span>

<span class="fc" id="L652">		final LifeLine lifeLine = new LifeLine(box, comp.getPreferredWidth(stringBounder),</span>
<span class="fc" id="L653">				drawableSet.getSkinParam().shadowing(p.getStereotype()), participantDisplay);</span>
<span class="fc" id="L654">		drawableSet.setLivingParticipantBox(p, new LivingParticipantBox(box, lifeLine));</span>

<span class="fc" id="L656">		this.freeX = box.getMaxX(stringBounder);</span>
<span class="fc" id="L657">	}</span>

	public void addParticipant(Participant p, ParticipantEnglober participantEnglober) {
<span class="fc" id="L660">		drawableSet.addParticipant(p, participantEnglober);</span>
<span class="fc" id="L661">	}</span>

	public void addEvent(Event event) {
<span class="fc" id="L664">		drawableSet.addEvent(event, null);</span>
<span class="fc" id="L665">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>