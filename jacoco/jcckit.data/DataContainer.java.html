<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataContainer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">plantuml</a> &gt; <a href="index.source.html" class="el_package">jcckit.data</a> &gt; <span class="el_source">DataContainer.java</span></div><h1>DataContainer.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2003-2004, Franz-Josef Elmer, All rights reserved
 *
 * This library is free software; you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation; either version 2.1 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details
 * (http://www.gnu.org/copyleft/lesser.html).
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
package jcckit.data;

import java.text.MessageFormat;
import java.util.Vector;

/**
 * Abstract superclass of all data containers. A data container holds an
 * ordered list of {@link DataElement DataElements} of the same type.
 * &lt;p&gt;
 * Data elements can be added, inserted, removed, or replaced.
 * Such an action leads to a {@link DataEvent} which will be delivered to
 * all {@link DataListener DataListeners} observing this 
 * &lt;code&gt;DataContainer&lt;/code&gt;. If this data container also implements 
 * {@link DataEvent} (as {@link DataCurve} does) also the listeners
 * registrated at the data container containg this container will be notified.
 * As a consequence a &lt;tt&gt;DataListener&lt;/tt&gt; must only be registered at the
 * {@link DataPlot} instance and it will automatically also received events
 * caused by manipulating one of its &lt;tt&gt;DataCurves&lt;/tt&gt;.
 * &lt;p&gt;
 * Concrete subclasses have to implement {@link #isValid} which
 * checks whether the added or inserted &lt;tt&gt;DataElement&lt;/tt&gt; is of the right
 * type. This is an application of the Template Method Design Pattern.
 *
 * @author Franz-Josef Elmer
 */
<span class="nc" id="L44">public abstract class DataContainer {</span>
  private final static String TEMPLATE
      = &quot;Invalid operation: {0}, Element: {1}, Container: {2}&quot;;
  final static String ADD = &quot;add&quot;,
                      REPLACE = &quot;replace&quot;,
                      INSERT = &quot;insert&quot;;

<span class="nc" id="L51">  private final Vector _listeners = new Vector();</span>
<span class="nc" id="L52">  private final Vector _container = new Vector();</span>

  /** Adds a {@link DataListener}. Does nothing if already added. */
  public void addDataListener(DataListener listener) {
<span class="nc bnc" id="L56" title="All 2 branches missed.">    if (!_listeners.contains(listener)) {</span>
<span class="nc" id="L57">      _listeners.addElement(listener);</span>
    }
<span class="nc" id="L59">  }</span>

  /** Removes a {@link DataListener}. Does nothing if already removed. */
  public void removeDataListener(DataListener listener) {
<span class="nc" id="L63">    _listeners.removeElement(listener);</span>
<span class="nc" id="L64">  }</span>

  private void notifyListeners(DataEvent event) {
<span class="nc bnc" id="L67" title="All 2 branches missed.">    for (int i = 0, n = _listeners.size(); i &lt; n; i++) {</span>
<span class="nc" id="L68">      ((DataListener) _listeners.elementAt(i)).dataChanged(event);</span>
    }
    // Notifies also parent container
<span class="nc bnc" id="L71" title="All 2 branches missed.">    if (this instanceof DataElement) {</span>
<span class="nc" id="L72">      DataContainer container = ((DataElement) this).getContainer();</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">      if (container != null) {</span>
<span class="nc" id="L74">        container.notifyListeners(event);</span>
      }
    }
<span class="nc" id="L77">  }</span>

  /** Returns the number of elements of this container. */
  public int getNumberOfElements() {
<span class="nc" id="L81">    return _container.size();</span>
  }

  /** Returns the element for the specified index. */
  public DataElement getElement(int index) {
<span class="nc" id="L86">    return (DataElement) _container.elementAt(index);</span>
  }
  
  /**
   * Returns the index of the specified element.
   * @param element Element to be looked for.
   * @return -1 if not found.
   */
  public int getIndexOf(DataElement element) {
<span class="nc" id="L95">    return _container.indexOf(element);</span>
  }

  /**
   * Adds a {@link DataElement}. After the element has been successfully
   * added all {@link DataListener DataListeners} will be informed.
   * @param element DataElement to be added.
   * @throws IllegalArgumentException if &lt;tt&gt;element&lt;/tt&gt; is not of the correct
   *         type which will be checked by the method {@link #isValid}.
   */
  public void addElement(DataElement element) {
<span class="nc bnc" id="L106" title="All 2 branches missed.">    if (isValid(element)) {</span>
<span class="nc" id="L107">      _container.addElement(element);</span>
<span class="nc" id="L108">      element.setContainer(this);</span>
<span class="nc" id="L109">      notifyListeners(DataEvent.createAddEvent(this));</span>
    } else {
<span class="nc" id="L111">      throwException(ADD, element);</span>
    }
<span class="nc" id="L113">  }</span>

  /**
   * Inserts a {@link DataElement} at the specified index. 
   * After the element has been successfully inserted
   * all {@link DataListener DataListeners} will be informed.
   * @param index Index at which &lt;tt&gt;element&lt;/tt&gt; will be inserted.
   *        All elements with an index &amp;gt;= &lt;tt&gt;index&lt;/tt&gt; will be shifted.
   * @param element DataElement to be added.
   * @throws IllegalArgumentException if &lt;tt&gt;element&lt;/tt&gt; is not of the correct
   *         type which will be checked by the method {@link #isValid}.
   */
  public void insertElementAt(int index, DataElement element) {
<span class="nc bnc" id="L126" title="All 2 branches missed.">    if (isValid(element)) {</span>
<span class="nc" id="L127">      _container.insertElementAt(element, index);</span>
<span class="nc" id="L128">      element.setContainer(this);</span>
<span class="nc" id="L129">      notifyListeners(DataEvent.createInsertEvent(this, index));</span>
    } else {
<span class="nc" id="L131">      throwException(INSERT, element);</span>
    }
<span class="nc" id="L133">  }</span>

  /**
   * Removes a {@link DataElement} at the specified index. 
   * After the element has been successfully removed
   * all {@link DataListener DataListeners} will be informed.
   * @param index Index of the element which will be removed.
   *        All elements with an index &amp;gt; &lt;tt&gt;index&lt;/tt&gt; will be shifted.
   */
  public void removeElementAt(int index) {
<span class="nc" id="L143">    DataElement element = (DataElement) _container.elementAt(index);</span>
<span class="nc" id="L144">    element.setContainer(null);</span>
<span class="nc" id="L145">    _container.removeElementAt(index);</span>
<span class="nc" id="L146">    notifyListeners(DataEvent.createRemoveEvent(this, index, element));</span>
<span class="nc" id="L147">  }</span>

  /**
   * Replaces the {@link DataElement} at the specified index. 
   * After the element has been successfully replaced
   * all {@link DataListener DataListeners} will be informed.
   * @param index Index of the element which will be replaced by 
   *        &lt;tt&gt;element&lt;/tt&gt;.
   * @param element The new &lt;tt&gt;DataElement&lt;/tt&gt;.
   * @throws IllegalArgumentException if &lt;tt&gt;element&lt;/tt&gt; is not of the correct
   *         type which will be checked by the method {@link #isValid}.
   */
  public void replaceElementAt(int index, DataElement element) {
<span class="nc bnc" id="L160" title="All 2 branches missed.">    if (isValid(element)) {</span>
<span class="nc" id="L161">      DataElement oldElement = (DataElement) _container.elementAt(index);</span>
<span class="nc" id="L162">      oldElement.setContainer(null);</span>
<span class="nc" id="L163">      _container.setElementAt(element, index);</span>
<span class="nc" id="L164">      element.setContainer(this);</span>
<span class="nc" id="L165">      notifyListeners(DataEvent.createReplaceEvent(this, index, oldElement));</span>
<span class="nc" id="L166">    } else {</span>
<span class="nc" id="L167">      throwException(REPLACE, element);</span>
    }
<span class="nc" id="L169">  }</span>

  private void throwException(String operation, DataElement element) {
<span class="nc" id="L172">    throw new IllegalArgumentException(MessageFormat.format(TEMPLATE,</span>
<span class="nc" id="L173">                new Object[] {operation, element, this.getClass().getName()}));</span>
  }

  /**
   * Returns &lt;tt&gt;true&lt;/tt&gt; if the specified {@link DataElement} has the
   * correct type. Concrete subclasses have to implement this method.
   * @param element &lt;tt&gt;DataElement&lt;/tt&gt; to be checked.
   */
  protected abstract boolean isValid(DataElement element);
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>