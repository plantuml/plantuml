<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GraphicsSudoku.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">plantuml</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.plantuml.sudoku</a> &gt; <span class="el_source">GraphicsSudoku.java</span></div><h1>GraphicsSudoku.java</h1><pre class="source lang-java linenums">/* ========================================================================
 * PlantUML : a free UML diagram generator
 * ========================================================================
 *
 * (C) Copyright 2009-2024, Arnaud Roques
 *
 * Project Info:  https://plantuml.com
 *
 * If you like this project or if you find it useful, you can support us at:
 *
 * https://plantuml.com/patreon (only 1$ per month!)
 * https://plantuml.com/paypal
 *
 * This file is part of PlantUML.
 *
 * PlantUML is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * PlantUML distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
 * License for more details.
 *
 * You should have received a copy of the GNU General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
 * USA.
 *
 *
 * Original Author:  Arnaud Roques
 *
 *
 */
package net.sourceforge.plantuml.sudoku;

import java.awt.Color;
import java.awt.Graphics2D;
import java.io.IOException;
import java.io.OutputStream;
import java.util.ArrayList;
import java.util.List;

import net.atmp.SvgOption;
import net.sourceforge.plantuml.EmptyImageBuilder;
import net.sourceforge.plantuml.FileFormat;
import net.sourceforge.plantuml.api.ImageDataSimple;
import net.sourceforge.plantuml.core.ImageData;
import net.sourceforge.plantuml.klimt.UTranslate;
import net.sourceforge.plantuml.klimt.awt.PortableImage;
import net.sourceforge.plantuml.klimt.color.ColorMapper;
import net.sourceforge.plantuml.klimt.color.HColors;
import net.sourceforge.plantuml.klimt.creole.Display;
import net.sourceforge.plantuml.klimt.drawing.UGraphic;
import net.sourceforge.plantuml.klimt.drawing.eps.EpsStrategy;
import net.sourceforge.plantuml.klimt.drawing.eps.UGraphicEps;
import net.sourceforge.plantuml.klimt.drawing.g2d.UGraphicG2d;
import net.sourceforge.plantuml.klimt.drawing.svg.UGraphicSvg;
import net.sourceforge.plantuml.klimt.drawing.tikz.UGraphicTikz;
import net.sourceforge.plantuml.klimt.font.FontConfiguration;
import net.sourceforge.plantuml.klimt.font.StringBounder;
import net.sourceforge.plantuml.klimt.font.UFont;
import net.sourceforge.plantuml.klimt.font.UFontFactory;
import net.sourceforge.plantuml.klimt.geom.HorizontalAlignment;
import net.sourceforge.plantuml.klimt.shape.TextBlock;
import net.sourceforge.plantuml.klimt.shape.URectangle;
import net.sourceforge.plantuml.klimt.sprite.SpriteContainerEmpty;
import net.sourceforge.plantuml.png.PngIO;

public class GraphicsSudoku {
	// ::remove folder when __MIT__ or __EPL__ or __BSD__ or __ASL__ or __LGPL__

	private final ISudoku sudoku;
<span class="nc" id="L75">	private final UFont numberFont = UFontFactory.sansSerif(20).bold();</span>
<span class="nc" id="L76">	private final UFont font = UFontFactory.sansSerif(11);</span>

<span class="nc" id="L78">	public GraphicsSudoku(ISudoku sudoku) {</span>
<span class="nc" id="L79">		this.sudoku = sudoku;</span>
<span class="nc" id="L80">	}</span>

	// ::uncomment when __TEAVM__
//	public ImageData writeImageSvg(OutputStream os) throws IOException {
//		throw new UnsupportedOperationException(&quot;TEAVM&quot;);
//	}
	// ::done

	// ::comment when __CORE__ or __TEAVM__
	public ImageData writeImageEps(OutputStream os) throws IOException {
<span class="nc" id="L90">		final UGraphicEps ug = new UGraphicEps(HColors.WHITE, ColorMapper.IDENTITY,</span>
<span class="nc" id="L91">				FileFormat.EPS_TEXT.getDefaultStringBounder(), EpsStrategy.WITH_MACRO_AND_TEXT);</span>
<span class="nc" id="L92">		drawInternal(ug);</span>
<span class="nc" id="L93">		os.write(ug.getEPSCode().getBytes());</span>
<span class="nc" id="L94">		return ImageDataSimple.ok();</span>
	}

	public ImageData writeImageLatex(OutputStream os, FileFormat fileFormat) throws IOException {
<span class="nc" id="L98">		final UGraphicTikz ug = new UGraphicTikz(HColors.WHITE, ColorMapper.IDENTITY,</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">				FileFormat.LATEX.getDefaultStringBounder(), 1, fileFormat == FileFormat.LATEX, null);</span>
<span class="nc" id="L100">		drawInternal(ug);</span>
<span class="nc" id="L101">		ug.writeToStream(os, null, -1); // dpi param is not used</span>
<span class="nc" id="L102">		return ImageDataSimple.ok();</span>
	}

	public ImageData writeImageSvg(OutputStream os) throws IOException {
<span class="nc" id="L106">		final SvgOption option = SvgOption.basic().withBackcolor(HColors.WHITE);</span>
<span class="nc" id="L107">		final UGraphicSvg ug = UGraphicSvg.build(option, false, 0, FileFormat.SVG.getDefaultStringBounder());</span>
<span class="nc" id="L108">		drawInternal(ug);</span>
<span class="nc" id="L109">		ug.writeToStream(os, null, -1); // dpi param is not used</span>
<span class="nc" id="L110">		return ImageDataSimple.ok();</span>
	}

<span class="nc" id="L113">	final StringBounder stringBounder = FileFormat.PNG.getDefaultStringBounder();</span>

	public ImageData writeImagePng(OutputStream os) throws IOException {
<span class="nc" id="L116">		final EmptyImageBuilder builder = new EmptyImageBuilder(null, sudoWidth, sudoHeight + textTotalHeight,</span>
				Color.WHITE, stringBounder);
<span class="nc" id="L118">		final PortableImage im = builder.getPortableImage();</span>
<span class="nc" id="L119">		final Graphics2D g3d = builder.getGraphics2D();</span>

<span class="nc" id="L121">		final UGraphic ug = new UGraphicG2d(HColors.WHITE, ColorMapper.IDENTITY, stringBounder, g3d, 1.0,</span>
				FileFormat.PNG);

<span class="nc" id="L124">		drawInternal(ug);</span>
<span class="nc" id="L125">		g3d.dispose();</span>
<span class="nc" id="L126">		PngIO.write(im, ColorMapper.IDENTITY, os, null, 96);</span>
<span class="nc" id="L127">		return new ImageDataSimple(im.getWidth(), im.getHeight());</span>
	}
	// ::done

<span class="nc" id="L131">	final private int xOffset = 5;</span>
<span class="nc" id="L132">	final private int yOffset = 5;</span>

<span class="nc" id="L134">	final private int cellWidth = 30;</span>
<span class="nc" id="L135">	final private int cellHeight = 32;</span>

<span class="nc" id="L137">	final private int numberxOffset = 10;</span>
<span class="nc" id="L138">	final private int numberyOffset = 5;</span>

<span class="nc" id="L140">	final private int textTotalHeight = 50;</span>

<span class="nc" id="L142">	final private int boldWidth = 3;</span>
<span class="nc" id="L143">	final private int sudoHeight = 9 * cellHeight + 2 * yOffset + boldWidth;</span>
<span class="nc" id="L144">	final private int sudoWidth = 9 * cellWidth + 2 * xOffset + boldWidth;</span>

	public void drawInternal(UGraphic ug) {
<span class="nc" id="L147">		ug = ug.apply(new UTranslate(xOffset, yOffset));</span>

<span class="nc bnc" id="L149" title="All 2 branches missed.">		for (int x = 0; x &lt; 9; x++) {</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">			for (int y = 0; y &lt; 9; y++) {</span>
<span class="nc" id="L151">				final int num = sudoku.getGiven(x, y);</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">				if (num &gt; 0) {</span>
<span class="nc" id="L153">					final TextBlock text = Display.create(&quot;&quot; + num).create(FontConfiguration.blackBlueTrue(numberFont),</span>
							HorizontalAlignment.CENTER, new SpriteContainerEmpty());
<span class="nc" id="L155">					text.drawU(ug</span>
<span class="nc" id="L156">							.apply(new UTranslate((numberxOffset + x * cellWidth), (numberyOffset + y * cellHeight))));</span>
				}
			}
		}

<span class="nc" id="L161">		ug = ug.apply(HColors.BLACK.bg()).apply(HColors.none());</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">		for (int i = 0; i &lt; 10; i++) {</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">			final boolean bold = i % boldWidth == 0;</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">			final int w = bold ? boldWidth : 1;</span>
<span class="nc" id="L165">			ug.apply(UTranslate.dy(i * cellHeight)).draw(URectangle.build(9 * cellWidth + boldWidth, w));</span>
		}
<span class="nc bnc" id="L167" title="All 2 branches missed.">		for (int i = 0; i &lt; 10; i++) {</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">			final boolean bold = i % boldWidth == 0;</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">			final int w = bold ? boldWidth : 1;</span>
<span class="nc" id="L170">			ug.apply(UTranslate.dx(i * cellWidth)).draw(URectangle.build(w, 9 * cellHeight + boldWidth));</span>
		}

<span class="nc" id="L173">		ug = ug.apply(UTranslate.dy(sudoHeight));</span>
<span class="nc" id="L174">		final List&lt;String&gt; texts = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L175">		texts.add(&quot;https://plantuml.com&quot;);</span>
<span class="nc" id="L176">		texts.add(&quot;Seed &quot; + Long.toString(sudoku.getSeed(), 36));</span>
<span class="nc" id="L177">		texts.add(&quot;Difficulty &quot; + sudoku.getRatting());</span>
<span class="nc" id="L178">		final TextBlock textBlock = Display.create(texts).create(FontConfiguration.blackBlueTrue(font),</span>
				HorizontalAlignment.LEFT, new SpriteContainerEmpty());
<span class="nc" id="L180">		textBlock.drawU(ug);</span>
<span class="nc" id="L181">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>