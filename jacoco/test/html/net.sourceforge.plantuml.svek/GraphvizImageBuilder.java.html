<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GraphvizImageBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">plantuml</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.plantuml.svek</a> &gt; <span class="el_source">GraphvizImageBuilder.java</span></div><h1>GraphvizImageBuilder.java</h1><pre class="source lang-java linenums">/* ========================================================================
 * PlantUML : a free UML diagram generator
 * ========================================================================
 *
 * (C) Copyright 2009-2024, Arnaud Roques
 *
 * Project Info:  https://plantuml.com
 * 
 * If you like this project or if you find it useful, you can support us at:
 * 
 * https://plantuml.com/patreon (only 1$ per month!)
 * https://plantuml.com/paypal
 * 
 * This file is part of PlantUML.
 *
 * PlantUML is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * PlantUML distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
 * License for more details.
 *
 * You should have received a copy of the GNU General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
 * USA.
 *
 *
 * Original Author:  Arnaud Roques
 * Contribution :  Hisashi Miyashita
 * Contribution :  Serge Wenger
 * 
 *
 */
package net.sourceforge.plantuml.svek;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;
import java.util.Map;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import net.sourceforge.plantuml.StringUtils;
import net.sourceforge.plantuml.abel.Entity;
import net.sourceforge.plantuml.abel.GroupType;
import net.sourceforge.plantuml.abel.LeafType;
import net.sourceforge.plantuml.abel.Link;
import net.sourceforge.plantuml.core.UmlSource;
import net.sourceforge.plantuml.crash.GraphvizCrash;
import net.sourceforge.plantuml.decoration.symbol.USymbolHexagon;
import net.sourceforge.plantuml.dot.DotData;
import net.sourceforge.plantuml.dot.ExeState;
import net.sourceforge.plantuml.dot.UnparsableGraphvizException;
import net.sourceforge.plantuml.klimt.color.HColor;
import net.sourceforge.plantuml.klimt.drawing.UGraphic;
import net.sourceforge.plantuml.klimt.font.FontConfiguration;
import net.sourceforge.plantuml.klimt.font.StringBounder;
import net.sourceforge.plantuml.klimt.geom.MagneticBorder;
import net.sourceforge.plantuml.klimt.geom.MagneticBorderNone;
import net.sourceforge.plantuml.klimt.geom.MinMax;
import net.sourceforge.plantuml.klimt.geom.XDimension2D;
import net.sourceforge.plantuml.klimt.geom.XRectangle2D;
import net.sourceforge.plantuml.klimt.shape.GraphicStrings;
import net.sourceforge.plantuml.log.Logme;
import net.sourceforge.plantuml.security.SecurityProfile;
import net.sourceforge.plantuml.security.SecurityUtils;
import net.sourceforge.plantuml.skin.Pragma;
import net.sourceforge.plantuml.skin.PragmaKey;
import net.sourceforge.plantuml.skin.SkinParam;
import net.sourceforge.plantuml.skin.UmlDiagramType;
import net.sourceforge.plantuml.stereo.Stereotype;
import net.sourceforge.plantuml.style.ISkinParam;
import net.sourceforge.plantuml.style.PName;
import net.sourceforge.plantuml.style.SName;
import net.sourceforge.plantuml.style.Style;
import net.sourceforge.plantuml.style.StyleSignature;
import net.sourceforge.plantuml.style.StyleSignatureBasic;
import net.sourceforge.plantuml.svek.image.EntityImageClass;
import net.sourceforge.plantuml.svek.image.EntityImageNote;
import net.sourceforge.plantuml.text.BackSlash;
import net.sourceforge.plantuml.utils.Log;

public final class GraphvizImageBuilder {

	private final DotData dotData;
	private final DotMode dotMode;

	private final UmlSource source;
	private final Pragma pragma;
	private Map&lt;String, Double&gt; maxX;

	private final SName styleName;
	private final DotStringFactory dotStringFactory;
	private final ClusterManager clusterManager;

	public GraphvizImageBuilder(DotData dotData, UmlSource source, Pragma pragma, SName styleName, DotMode dotMode,
<span class="fc" id="L103">			DotStringFactory dotStringFactory, ClusterManager clusterManager) {</span>
<span class="fc" id="L104">		this.dotData = dotData;</span>
<span class="fc" id="L105">		this.dotMode = dotMode;</span>
<span class="fc" id="L106">		this.styleName = styleName;</span>
<span class="fc" id="L107">		this.source = source;</span>
<span class="fc" id="L108">		this.pragma = pragma;</span>
<span class="fc" id="L109">		this.dotStringFactory = dotStringFactory;</span>
<span class="fc" id="L110">		this.clusterManager = clusterManager;</span>

<span class="fc" id="L112">	}</span>

	final public StyleSignature getDefaultStyleDefinitionArrow(Stereotype stereotype) {
<span class="nc" id="L115">		StyleSignature result = StyleSignatureBasic.of(SName.root, SName.element, styleName, SName.arrow);</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">		if (stereotype != null)</span>
<span class="nc" id="L117">			result = result.withTOBECHANGED(stereotype);</span>

<span class="nc" id="L119">		return result;</span>
	}

	final public StyleSignature getStyleArrowCardinality(Stereotype stereotype) {
<span class="nc" id="L123">		StyleSignature result = StyleSignatureBasic.of(SName.root, SName.element, styleName, SName.arrow,</span>
				SName.cardinality);
<span class="nc bnc" id="L125" title="All 2 branches missed.">		if (stereotype != null)</span>
<span class="nc" id="L126">			result = result.withTOBECHANGED(stereotype);</span>

<span class="nc" id="L128">		return result;</span>
	}

	private boolean isOpalisable(Entity entity) {
<span class="nc bnc" id="L132" title="All 2 branches missed.">		if (dotData.getSkinParam().strictUmlStyle())</span>
<span class="nc" id="L133">			return false;</span>

<span class="nc bnc" id="L135" title="All 2 branches missed.">		if (entity.isGroup())</span>
<span class="nc" id="L136">			return false;</span>

<span class="nc bnc" id="L138" title="All 2 branches missed.">		if (entity.getLeafType() != LeafType.NOTE)</span>
<span class="nc" id="L139">			return false;</span>

<span class="nc" id="L141">		final Link single = onlyOneLink(entity);</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">		if (single == null)</span>
<span class="nc" id="L143">			return false;</span>

<span class="nc bnc" id="L145" title="All 2 branches missed.">		return single.getOther(entity).getLeafType() != LeafType.NOTE;</span>
	}

	static class EntityImageSimpleEmpty implements IEntityImage {

		private final HColor backColor;

<span class="nc" id="L152">		EntityImageSimpleEmpty(HColor backColor) {</span>
<span class="nc" id="L153">			this.backColor = backColor;</span>
<span class="nc" id="L154">		}</span>

		public boolean isHidden() {
<span class="nc" id="L157">			return false;</span>
		}

		public HColor getBackcolor() {
<span class="nc" id="L161">			return backColor;</span>
		}

		public XDimension2D calculateDimension(StringBounder stringBounder) {
<span class="nc" id="L165">			return new XDimension2D(10, 10);</span>
		}

		public MinMax getMinMax(StringBounder stringBounder) {
<span class="nc" id="L169">			return MinMax.fromDim(calculateDimension(stringBounder));</span>
		}

		public XRectangle2D getInnerPosition(CharSequence member, StringBounder stringBounder) {
<span class="nc" id="L173">			return null;</span>
		}

		public void drawU(UGraphic ug) {
<span class="nc" id="L177">		}</span>

		public ShapeType getShapeType() {
<span class="nc" id="L180">			return ShapeType.RECTANGLE;</span>
		}

		public Margins getShield(StringBounder stringBounder) {
<span class="nc" id="L184">			return Margins.NONE;</span>
		}

		public double getOverscanX(StringBounder stringBounder) {
<span class="nc" id="L188">			return 0;</span>
		}

		@Override
		public MagneticBorder getMagneticBorder() {
<span class="nc" id="L193">			return new MagneticBorderNone();</span>
		}

	}

	// Duplicate SvekResult / GeneralImageBuilder
	private HColor getBackcolor() {
<span class="fc" id="L200">		final Style style = StyleSignatureBasic.of(SName.root, SName.document)</span>
<span class="fc" id="L201">				.getMergedStyle(dotData.getSkinParam().getCurrentStyleBuilder());</span>
<span class="fc" id="L202">		return style.value(PName.BackGroundColor).asColor(dotData.getSkinParam().getIHtmlColorSet());</span>
	}

	public IEntityImage buildImage(StringBounder stringBounder, BaseFile basefile, String dotStrings[],
			boolean fileFormatOptionIsDebugSvek) {
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">		if (dotData.isDegeneratedWithFewEntities(0))</span>
<span class="nc" id="L208">			return new EntityImageSimpleEmpty(dotData.getSkinParam().getBackgroundColor());</span>

<span class="pc bpc" id="L210" title="1 of 4 branches missed.">		if (dotData.isDegeneratedWithFewEntities(1) &amp;&amp; dotData.getUmlDiagramType() != UmlDiagramType.STATE) {</span>
<span class="fc" id="L211">			final Entity single = dotData.getLeafs().iterator().next();</span>
<span class="fc" id="L212">			final Entity group = single.getParentContainer();</span>
<span class="pc bpc" id="L213" title="2 of 4 branches missed.">			if (group.isRoot() &amp;&amp; single.getUSymbol() instanceof USymbolHexagon == false) {</span>
<span class="fc" id="L214">				final IEntityImage tmp = GeneralImageBuilder.createEntityImageBlock(single,</span>
<span class="fc" id="L215">						dotData.isHideEmptyDescriptionForState(), dotData.getPortionShower(), null, null,</span>
<span class="fc" id="L216">						dotData.getLinks());</span>
<span class="fc" id="L217">				return new EntityImageDegenerated(tmp, getBackcolor());</span>
			}
		}
<span class="fc" id="L220">		dotData.removeIrrelevantSametail();</span>

<span class="fc" id="L222">		printGroups(stringBounder, dotData.getRootGroup());</span>
<span class="fc" id="L223">		printEntities(stringBounder, getUnpackagedEntities());</span>

<span class="pc bpc" id="L225" title="1 of 2 branches missed.">		for (Link link : dotData.getLinks()) {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">			if (link.isRemoved())</span>
<span class="nc" id="L227">				continue;</span>

			try {
<span class="nc" id="L230">				final ISkinParam skinParam = dotData.getSkinParam();</span>
<span class="nc" id="L231">				final FontConfiguration labelFont = getDefaultStyleDefinitionArrow(link.getStereotype())</span>
<span class="nc" id="L232">						.getMergedStyle(link.getStyleBuilder()).getFontConfiguration(skinParam.getIHtmlColorSet());</span>
<span class="nc" id="L233">				final FontConfiguration cardinalityFont = getStyleArrowCardinality(link.getStereotype())</span>
<span class="nc" id="L234">						.getMergedStyle(link.getStyleBuilder()).getFontConfiguration(skinParam.getIHtmlColorSet());</span>

<span class="nc" id="L236">				final SvekEdge line = new SvekEdge(link, skinParam, stringBounder, labelFont, cardinalityFont,</span>
<span class="nc" id="L237">						dotStringFactory.getBibliotekon(), pragma, dotStringFactory.getGraphvizVersion());</span>

<span class="nc" id="L239">				dotStringFactory.getBibliotekon().addLine(line);</span>

<span class="nc bnc" id="L241" title="All 2 branches missed.">				if (isOpalisable(link.getEntity1())) {</span>
<span class="nc" id="L242">					final SvekNode node = dotStringFactory.getBibliotekon().getNode(link.getEntity1());</span>
<span class="nc" id="L243">					final SvekNode other = dotStringFactory.getBibliotekon().getNode(link.getEntity2());</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">					if (other != null) {</span>
<span class="nc" id="L245">						((EntityImageNote) node.getImage()).setOpaleLine(line, node, other);</span>
<span class="nc" id="L246">						line.setOpale(true);</span>
					}
<span class="nc bnc" id="L248" title="All 2 branches missed.">				} else if (isOpalisable(link.getEntity2())) {</span>
<span class="nc" id="L249">					final SvekNode node = dotStringFactory.getBibliotekon().getNode(link.getEntity2());</span>
<span class="nc" id="L250">					final SvekNode other = dotStringFactory.getBibliotekon().getNode(link.getEntity1());</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">					if (other != null) {</span>
<span class="nc" id="L252">						((EntityImageNote) node.getImage()).setOpaleLine(line, node, other);</span>
<span class="nc" id="L253">						line.setOpale(true);</span>
					}
				}
<span class="nc" id="L256">			} catch (IllegalStateException e) {</span>
<span class="nc" id="L257">				Logme.error(e);</span>
<span class="nc" id="L258">			}</span>
<span class="nc" id="L259">		}</span>

		// ::comment when __TEAVM__
<span class="pc bpc" id="L262" title="1 of 2 branches missed.">		if (dotStringFactory.illegalDotExe())</span>
<span class="fc" id="L263">			return error(dotStringFactory.getDotExe());</span>
		// ::done

<span class="nc bnc" id="L266" title="All 6 branches missed.">		if (basefile == null &amp;&amp; (fileFormatOptionIsDebugSvek || isSvekTrace())</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">				&amp;&amp; (SecurityUtils.getSecurityProfile() == SecurityProfile.UNSECURE</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">						|| SecurityUtils.getSecurityProfile() == SecurityProfile.LEGACY</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">						|| SecurityUtils.getSecurityProfile() == SecurityProfile.SANDBOX))</span>
<span class="nc" id="L270">			basefile = new BaseFile(null);</span>

		final String svg;
		try {
<span class="nc" id="L274">			svg = dotStringFactory.getSvg(stringBounder, dotMode, basefile, dotStrings);</span>
<span class="nc" id="L275">		} catch (IOException e) {</span>
<span class="nc" id="L276">			return GraphvizCrash.build(source.getPlainString(BackSlash.lineSeparator()), false, e);</span>
<span class="nc" id="L277">		}</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (svg.length() == 0)</span>
<span class="nc" id="L279">			return GraphvizCrash.build(source.getPlainString(BackSlash.lineSeparator()), false,</span>
					new EmptySvgException());

<span class="nc" id="L282">		final String graphvizVersion = extractGraphvizVersion(svg);</span>
		try {
<span class="nc" id="L284">			dotStringFactory.solve(svg);</span>
<span class="nc" id="L285">			final SvekResult result = new SvekResult(dotData, dotStringFactory);</span>
<span class="nc" id="L286">			this.maxX = dotStringFactory.getBibliotekon().getMaxX();</span>
<span class="nc" id="L287">			return result;</span>
<span class="nc" id="L288">		} catch (Exception e) {</span>
<span class="nc" id="L289">			Log.error(&quot;Exception &quot; + e);</span>
<span class="nc" id="L290">			throw new UnparsableGraphvizException(e, graphvizVersion, svg,</span>
<span class="nc" id="L291">					source.getPlainString(BackSlash.lineSeparator()));</span>
		}

	}

	private boolean isSvekTrace() {
<span class="nc" id="L297">		final String value = pragma.getValue(PragmaKey.SVEK_TRACE);</span>
<span class="nc bnc" id="L298" title="All 4 branches missed.">		return &quot;true&quot;.equalsIgnoreCase(value) || &quot;on&quot;.equalsIgnoreCase(value);</span>
	}

	private String extractGraphvizVersion(String svg) {
<span class="nc" id="L302">		final Pattern pGraph = Pattern.compile(&quot;(?mi)!-- generated by graphviz(.*)&quot;);</span>
<span class="nc" id="L303">		final Matcher mGraph = pGraph.matcher(svg);</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">		if (mGraph.find())</span>
<span class="nc" id="L305">			return StringUtils.trin(mGraph.group(1));</span>

<span class="nc" id="L307">		return null;</span>
	}

	private Link onlyOneLink(Entity ent) {
<span class="nc" id="L311">		Link single = null;</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">		for (Link link : dotData.getLinks()) {</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">			if (link.isInvis())</span>
<span class="nc" id="L314">				continue;</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">			if (link.contains(ent) == false)</span>
<span class="nc" id="L316">				continue;</span>

<span class="nc bnc" id="L318" title="All 2 branches missed.">			if (single != null)</span>
<span class="nc" id="L319">				return null;</span>
<span class="nc" id="L320">			single = link;</span>
<span class="nc" id="L321">		}</span>
<span class="nc" id="L322">		return single;</span>
	}

	// ::comment when __CORE__ or __TEAVM__
	private IEntityImage error(File dotExe) {
<span class="fc" id="L327">		final List&lt;String&gt; msg = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L328">		msg.add(&quot;Dot Executable: &quot; + dotExe);</span>
<span class="fc" id="L329">		final ExeState exeState = ExeState.checkFile(dotExe);</span>
<span class="fc" id="L330">		msg.add(exeState.getTextMessage());</span>
<span class="fc" id="L331">		msg.add(&quot;Cannot find Graphviz. You should try&quot;);</span>
<span class="fc" id="L332">		msg.add(&quot; &quot;);</span>
<span class="fc" id="L333">		msg.add(&quot;@startuml&quot;);</span>
<span class="fc" id="L334">		msg.add(&quot;testdot&quot;);</span>
<span class="fc" id="L335">		msg.add(&quot;@enduml&quot;);</span>
<span class="fc" id="L336">		msg.add(&quot; &quot;);</span>
<span class="fc" id="L337">		msg.add(&quot; or &quot;);</span>
<span class="fc" id="L338">		msg.add(&quot; &quot;);</span>
<span class="fc" id="L339">		msg.add(&quot;java -jar plantuml.jar -testdot&quot;);</span>
<span class="fc" id="L340">		msg.add(&quot; &quot;);</span>
<span class="fc" id="L341">		return GraphicStrings.createForError(msg, false);</span>
	}
	// ::done

	private void printEntities(StringBounder stringBounder, Collection&lt;Entity&gt; entities2) {
<span class="fc bfc" id="L346" title="All 2 branches covered.">		for (Entity ent : entities2) {</span>
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">			if (ent.isRemoved())</span>
<span class="nc" id="L348">				continue;</span>

<span class="fc" id="L350">			printEntity(stringBounder, ent);</span>
<span class="fc" id="L351">		}</span>
<span class="fc" id="L352">	}</span>

	private void printEntity(StringBounder stringBounder, Entity ent) {
<span class="pc bpc" id="L355" title="1 of 2 branches missed.">		if (ent.isRemoved())</span>
<span class="nc" id="L356">			throw new IllegalStateException(ent.toString());</span>

<span class="fc" id="L358">		final IEntityImage image = printEntityInternal(stringBounder, ent);</span>
<span class="fc" id="L359">		final SvekNode node = dotStringFactory.getBibliotekon().createNode(ent, image, stringBounder);</span>
<span class="fc" id="L360">		clusterManager.addNode(node);</span>
<span class="fc" id="L361">	}</span>

	private IEntityImage printEntityInternal(StringBounder stringBounder, Entity ent) {
<span class="pc bpc" id="L364" title="1 of 2 branches missed.">		if (ent.isRemoved())</span>
<span class="nc" id="L365">			throw new IllegalStateException();</span>

<span class="pc bpc" id="L367" title="1 of 2 branches missed.">		if (ent.getSvekImage() == null) {</span>
<span class="fc" id="L368">			ISkinParam skinParam = dotData.getSkinParam();</span>
<span class="pc bpc" id="L369" title="1 of 2 branches missed.">			if (skinParam.sameClassWidth()) {</span>
<span class="nc" id="L370">				final double width = getMaxWidth(stringBounder);</span>
<span class="nc" id="L371">				((SkinParam) skinParam).setParamSameClassWidth(width);</span>
			}

<span class="fc" id="L374">			return GeneralImageBuilder.createEntityImageBlock(ent, dotData.isHideEmptyDescriptionForState(),</span>
<span class="fc" id="L375">					dotData.getPortionShower(), dotStringFactory.getBibliotekon(),</span>
<span class="fc" id="L376">					dotStringFactory.getGraphvizVersion(), dotData.getLinks());</span>
		}
<span class="nc" id="L378">		return ent.getSvekImage();</span>
	}

	private double getMaxWidth(StringBounder stringBounder) {
<span class="nc" id="L382">		double result = 0;</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">		for (Entity ent : dotData.getLeafs()) {</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">			if (ent.getLeafType().isLikeClass() == false)</span>
<span class="nc" id="L385">				continue;</span>

<span class="nc" id="L387">			final IEntityImage im = new EntityImageClass(ent, dotData.getPortionShower());</span>
<span class="nc" id="L388">			final double w = im.calculateDimension(stringBounder).getWidth();</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">			if (w &gt; result)</span>
<span class="nc" id="L390">				result = w;</span>

<span class="nc" id="L392">		}</span>
<span class="nc" id="L393">		return result;</span>
	}

	private Collection&lt;Entity&gt; getUnpackagedEntities() {
<span class="fc" id="L397">		final List&lt;Entity&gt; result = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L398" title="All 2 branches covered.">		for (Entity ent : dotData.getLeafs())</span>
<span class="pc bpc" id="L399" title="1 of 2 branches missed.">			if (dotData.getTopParent() == ent.getParentContainer())</span>
<span class="fc" id="L400">				result.add(ent);</span>

<span class="fc" id="L402">		return result;</span>
	}

	private void printGroups(StringBounder stringBounder, Entity parent) {
		// System.err.println(&quot;PARENT=&quot; + parent);
<span class="fc" id="L407">		final Collection&lt;Entity&gt; groups = dotData.getGroupHierarchy().getChildrenGroups(parent);</span>
		// System.err.println(&quot;groups=&quot; + groups);
<span class="pc bpc" id="L409" title="1 of 2 branches missed.">		for (Entity g : groups) {</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">			if (g.isRemoved())</span>
<span class="nc" id="L411">				continue;</span>

<span class="nc bnc" id="L413" title="All 4 branches missed.">			if (dotData.isEmpty(g) &amp;&amp; g.getGroupType() == GroupType.PACKAGE) {</span>
<span class="nc" id="L414">				g.muteToType(LeafType.EMPTY_PACKAGE);</span>
<span class="nc" id="L415">				printEntity(stringBounder, g);</span>
			} else {
<span class="nc" id="L417">				printGroup(stringBounder, g);</span>
			}
<span class="nc" id="L419">		}</span>
<span class="fc" id="L420">	}</span>

	private void printGroup(StringBounder stringBounder, Entity g) {
<span class="nc bnc" id="L423" title="All 2 branches missed.">		if (g.getGroupType() == GroupType.CONCURRENT_STATE)</span>
<span class="nc" id="L424">			return;</span>

<span class="nc" id="L426">		final ClusterHeader clusterHeader = new ClusterHeader(g, dotData.getPortionShower(), stringBounder);</span>
<span class="nc" id="L427">		clusterManager.openCluster(g, clusterHeader);</span>
<span class="nc" id="L428">		this.printEntities(stringBounder, g.leafs());</span>

<span class="nc" id="L430">		printGroups(stringBounder, g);</span>

<span class="nc" id="L432">		clusterManager.closeCluster();</span>
<span class="nc" id="L433">	}</span>

	public String getWarningOrError(int warningOrError) {
<span class="nc bnc" id="L436" title="All 2 branches missed.">		if (maxX == null)</span>
<span class="nc" id="L437">			return &quot;&quot;;</span>

<span class="nc" id="L439">		final StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">		for (Map.Entry&lt;String, Double&gt; ent : maxX.entrySet())</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">			if (ent.getValue() &gt; warningOrError) {</span>
<span class="nc" id="L442">				sb.append(ent.getKey() + &quot; is overpassing the width limit.&quot;);</span>
<span class="nc" id="L443">				sb.append(&quot;\n&quot;);</span>
			}

<span class="nc bnc" id="L446" title="All 2 branches missed.">		return sb.length() == 0 ? &quot;&quot; : sb.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>